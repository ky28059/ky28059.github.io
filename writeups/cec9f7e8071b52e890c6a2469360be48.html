<!DOCTYPE html><html class="dark scroll-smooth"><head><meta charSet="utf-8"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/da257a7bf05e11ce.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-50d183473e3f8178.js"/><script src="/_next/static/chunks/4bd1b696-12b3d90ac4ed3802.js" async=""></script><script src="/_next/static/chunks/684-d3c2077e7b7fefb9.js" async=""></script><script src="/_next/static/chunks/main-app-99381da9a4c58049.js" async=""></script><script src="/_next/static/chunks/874-c62c375efd21db20.js" async=""></script><script src="/_next/static/chunks/app/writeups/%5Bid%5D/layout-0f792473045deceb.js" async=""></script><script src="/_next/static/chunks/325-8cc74193b249521f.js" async=""></script><script src="/_next/static/chunks/app/writeups/%5Bid%5D/page-d2275216898ea7fa.js" async=""></script><meta name="next-size-adjust" content=""/><title>0xL4ugh CTF 2024 — MyVault | kevin.fish</title><meta name="description" content="Welcome to our secure vault !"/><meta property="og:title" content="0xL4ugh CTF 2024 — MyVault"/><meta property="og:description" content="Welcome to our secure vault !"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="0xL4ugh CTF 2024 — MyVault"/><meta name="twitter:description" content="Welcome to our secure vault !"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="text-dark dark:text-white dark:bg-midnight" style="font-family:&#x27;Inter&#x27;, &#x27;Inter Fallback&#x27;;font-style:normal"><main class="container pt-20 pb-24"><a class="text-secondary text-sm mb-10 -ml-5 block w-max" href="/writeups">← Back to writeups</a><div><main class="text-pretty max-w-5xl mx-auto text-sm [&amp;_h1]:text-5xl [&amp;_h1]:font-semibold [&amp;_h1]:mb-8 [&amp;_blockquote]:text-secondary [&amp;_blockquote]:space-y-3 [&amp;_blockquote]:border-l-4 [&amp;_blockquote]:border-secondary [&amp;_blockquote]:pl-5 [&amp;_blockquote]:mb-5 [&amp;&gt;_p]:my-3 [&amp;_img]:my-5 [&amp;_ul]:list-disc [&amp;_ul]:pl-6 [&amp;_ol]:list-decimal [&amp;_ol]:pl-6 [&amp;_img]:rounded [&amp;_li]:my-2"><h1>0xL4ugh CTF 2024 — MyVault</h1>
<blockquote>
<p>Welcome to our secure vault !</p>
</blockquote>
<p>We&#x27;re given an APK file that decompiles to, among other things,</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (java)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">    </span><span class="token keyword">package</span><span class=""> </span><span class="token namespace">com</span><span class="token namespace punctuation">.</span><span class="token namespace">tarek</span><span class="token namespace punctuation">.</span><span class="token namespace">myvault</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">android</span><span class="token namespace punctuation">.</span><span class="token namespace">os</span><span class="token namespace punctuation">.</span><span class="token class-name">Bundle</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">android</span><span class="token namespace punctuation">.</span><span class="token namespace">widget</span><span class="token namespace punctuation">.</span><span class="token class-name">Button</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">android</span><span class="token namespace punctuation">.</span><span class="token namespace">widget</span><span class="token namespace punctuation">.</span><span class="token class-name">EditText</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">d</span><span class="token namespace punctuation">.</span><span class="token namespace">m</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">i</span><span class="token namespace punctuation">.</span><span class="token namespace">c</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token class-name">FileOutputStream</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token class-name">InputStream</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class=""></span><span class="token keyword">public</span><span class=""> </span><span class="token keyword">class</span><span class=""> </span><span class="token class-name">MainActivity</span><span class=""> </span><span class="token keyword">extends</span><span class=""> m </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="">    </span><span class="token keyword">public</span><span class=""> </span><span class="token keyword">final</span><span class=""> </span><span class="token keyword">void</span><span class=""> </span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span><span class=""> bundle</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="">        </span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="">bundle</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">        </span><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class=""> </span><span class="token class-name">R</span><span class="token punctuation">.</span><span class="">layout</span><span class="token punctuation">.</span><span class="">activity_main</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">        </span><span class="token class-name">File</span><span class=""> file </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">File</span><span class="token punctuation">(</span><span class="token function">getCacheDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">+</span><span class=""> </span><span class="token string">&quot;/vault.enc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">        </span><span class="token keyword">if</span><span class=""> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">file</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="">            </span><span class="token keyword">try</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="">                </span><span class="token class-name">InputStream</span><span class=""> </span><span class="token keyword">open</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token function">getAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token string">&quot;vault.enc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">                </span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class=""> bArr </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token keyword">open</span><span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="">                </span><span class="token keyword">open</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="">bArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">                </span><span class="token keyword">open</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">                </span><span class="token class-name">FileOutputStream</span><span class=""> fileOutputStream </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="">file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">                fileOutputStream</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="">bArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">                fileOutputStream</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span><span class="">                </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span><span class=""> </span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span><span class="">id</span><span class="token punctuation">.</span><span class="">btnSubmit</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class=""> </span><span class="token function">c</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span><span class=""> </span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span><span class="">id</span><span class="token punctuation">.</span><span class="">editTextOTP</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="">            </span><span class="token punctuation">}</span><span class=""> </span><span class="token keyword">catch</span><span class=""> </span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class=""> e3</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">                </span><span class="token keyword">throw</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="">e3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="">            </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span class="">        </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="">    </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span><span class=""></span><span class="token punctuation">}</span></code></pre></div></div>
<p>The main activity reads bytes from the encoded <code class="opacity-75 bg-black/30 rounded p-1">vault.enc</code> file, then sets up a click listener via <code class="opacity-75 bg-black/30 rounded p-1">new c()</code>.</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">kevin@ky28059:/mnt/c/users/kevin/Downloads$ xxd vault.enc
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span>00000000: 3797 080e c05e 8e05 90f0 9c57 bf4e d622  7....^.....W.N.&quot;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span>00000010: 6c56 fd13 e3c9 52b3 21ec 1871 fb08 b3a2  lV....R.!..q....
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span>00000020: 23de 50c3 a027 4a15 0fd9 2251 0703 c3e2  #.P..&#x27;J...&quot;Q....
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span>00000030: 37c6 7ce3 0414 2328 cb24 ca12 1520 6d1e  7.|...#(.$... m.
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span>00000040: ba4d 692a b1e3 cacb 847b a957 df74 9896  .Mi*.....{.W.t..
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span>00000050: 578c 67b8 b837 cf6c 4993 df21 3728 e001  W.g..7.lI..!7(..
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span>00000060: e357 9a89 b1a5 2624 57e9 d093 0242 c0e9  .W....&amp;$W....B..
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span>00000070: dd42 4cb7 4c77 7c8f 1c93 17c4 184a 1cb9  .BL.Lw|......J..
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span>00000080: cb02 d559 b5db d990 6c73 7ae0 7e50 3b6b  ...Y....lsz.~P;k
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span>00000090: 7255 8c0b fe25 3c08 39e9 205a bb09 3531  rU...%&lt;.9. Z..51
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span>000000a0: 00cc 6330 d44e f54c 4d8d 44f7 18c7 cdad  ..c0.N.LM.D.....
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span>000000b0: 370d 48ed 2635 7b00 e492 2354 474e e616  7.H.&amp;5{...#TGN..
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span>000000c0: 35dc 780c 9e21 f756 0bcb 451e 7b64 cbd4  5.x..!.V..E.{d..
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span>000000d0: fe95 bab6 fda9 9c26 08b5 c17c dd85 c421  .......&amp;...|...!
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span>000000e0: 0eaa 5e78 7512 8829 2331 8fd0 2be6 7401  ..^xu..)#1..+.t.</code></pre></div></div>
<p>Looking in <code class="opacity-75 bg-black/30 rounded p-1">i.c</code>,</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (java)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">    </span><span class="token keyword">package</span><span class=""> </span><span class="token namespace">i</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">android</span><span class="token namespace punctuation">.</span><span class="token namespace">view</span><span class="token namespace punctuation">.</span><span class="token class-name">KeyEvent</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">android</span><span class="token namespace punctuation">.</span><span class="token namespace">view</span><span class="token namespace punctuation">.</span><span class="token class-name">View</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">android</span><span class="token namespace punctuation">.</span><span class="token namespace">view</span><span class="token namespace punctuation">.</span><span class="token class-name">Window</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">android</span><span class="token namespace punctuation">.</span><span class="token namespace">widget</span><span class="token namespace punctuation">.</span><span class="token class-name">EditText</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">android</span><span class="token namespace punctuation">.</span><span class="token namespace">widget</span><span class="token namespace punctuation">.</span><span class="token class-name">Toast</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">com</span><span class="token namespace punctuation">.</span><span class="token namespace">tarek</span><span class="token namespace punctuation">.</span><span class="token namespace">myvault</span><span class="token namespace punctuation">.</span><span class="token class-name">MainActivity</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">h</span><span class="token namespace punctuation">.</span><span class="token namespace">a</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token class-name">FileOutputStream</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">javax</span><span class="token namespace punctuation">.</span><span class="token namespace">crypto</span><span class="token namespace punctuation">.</span><span class="token class-name">Cipher</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token namespace">javax</span><span class="token namespace punctuation">.</span><span class="token namespace">crypto</span><span class="token namespace punctuation">.</span><span class="token namespace">spec</span><span class="token namespace punctuation">.</span><span class="token class-name">SecretKeySpec</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class=""></span><span class="token keyword">public</span><span class=""> </span><span class="token keyword">final</span><span class=""> </span><span class="token keyword">class</span><span class=""> c </span><span class="token keyword">implements</span><span class=""> </span><span class="token class-name">View</span><span class="token class-name punctuation">.</span><span class="token class-name">OnClickListener</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="">    </span><span class="token comment">// ...</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">    </span><span class="token keyword">public</span><span class=""> </span><span class="token keyword">final</span><span class=""> </span><span class="token keyword">void</span><span class=""> </span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class=""> view</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="">        </span><span class="token comment">// ...</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">        </span><span class="token keyword">switch</span><span class=""> </span><span class="token punctuation">(</span><span class="">i3</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">            </span><span class="token comment">// ...</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">            </span><span class="token keyword">default</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">                </span><span class="token class-name">String</span><span class=""> obj3 </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span><span class=""> obj2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span><span class="">                </span><span class="token class-name">MainActivity</span><span class=""> mainActivity </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">)</span><span class=""> obj</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="">                mainActivity</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">                </span><span class="token keyword">try</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="">                    </span><span class="token class-name">String</span><span class=""> sb </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="">obj3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span class="">                    </span><span class="token class-name">File</span><span class=""> file </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">File</span><span class="token punctuation">(</span><span class="">mainActivity</span><span class="token punctuation">.</span><span class="token function">getCacheDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;vault.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="">                    </span><span class="token class-name">File</span><span class=""> file2 </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">File</span><span class="token punctuation">(</span><span class="">mainActivity</span><span class="token punctuation">.</span><span class="token function">getCacheDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;vault.enc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span><span class="">                    </span><span class="token class-name">SecretKeySpec</span><span class=""> secretKeySpec </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">obj3 </span><span class="token operator">+</span><span class=""> sb </span><span class="token operator">+</span><span class=""> obj3 </span><span class="token operator">+</span><span class=""> sb</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class="">                    </span><span class="token class-name">Cipher</span><span class=""> instance </span><span class="token operator">=</span><span class=""> </span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="">                    instance</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class=""> secretKeySpec</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span><span class="">                    </span><span class="token class-name">FileInputStream</span><span class=""> fileInputStream </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="">file2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">36</span><span class="">                    </span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class=""> bArr </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class=""> file2</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class="">                    fileInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="">bArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">38</span><span class="">                    </span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class=""> doFinal </span><span class="token operator">=</span><span class=""> instance</span><span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span><span class="">bArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">39</span><span class="">                    </span><span class="token class-name">FileOutputStream</span><span class=""> fileOutputStream </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="">file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">40</span><span class="">                    fileOutputStream</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="">doFinal</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">41</span><span class="">                    fileInputStream</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class="">                    fileOutputStream</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">43</span><span class="">                    str </span><span class="token operator">=</span><span class=""> </span><span class="token string">&quot;Congrats!&quot;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">44</span><span class="">                </span><span class="token punctuation">}</span><span class=""> </span><span class="token keyword">catch</span><span class=""> </span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class=""> unused</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">45</span><span class="">                    str </span><span class="token operator">=</span><span class=""> </span><span class="token string">&quot;Incorrect OTP&quot;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">46</span><span class="">                </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">47</span><span class="">                </span><span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="">mainActivity</span><span class="token punctuation">,</span><span class=""> str</span><span class="token punctuation">,</span><span class=""> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">48</span><span class="">                </span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">49</span><span class="">        </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">50</span><span class="">    </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">51</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">52</span><span class="">    </span><span class="token comment">// ...</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">53</span><span class=""></span><span class="token punctuation">}</span></code></pre></div></div>
<p>On click, the handler pulls a string from a text input, creating an AES key equal to</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">{string}{reversed string}{string}{reversed string}</span></code></pre></div></div>
<p>and uses it to attempt to decrypt the vault. On success, it writes the result to <code class="opacity-75 bg-black/30 rounded p-1">vault.txt</code>.</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (java)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token class-name">String</span><span class=""> obj3 </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span><span class=""> obj2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class=""></span><span class="token class-name">String</span><span class=""> sb </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="">obj3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class=""></span><span class="token comment">// ...</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class=""></span><span class="token class-name">SecretKeySpec</span><span class=""> secretKeySpec </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">obj3 </span><span class="token operator">+</span><span class=""> sb </span><span class="token operator">+</span><span class=""> obj3 </span><span class="token operator">+</span><span class=""> sb</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class=""></span><span class="token class-name">Cipher</span><span class=""> instance </span><span class="token operator">=</span><span class=""> </span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="">instance</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class=""> secretKeySpec</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class=""></span><span class="token comment">// ...</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class=""></span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class=""> doFinal </span><span class="token operator">=</span><span class=""> instance</span><span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span><span class="">bArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div></div>
<p>Because we know the key is the same string repeated (and reversed) 4 times, we only need to find the first fourth of the key to get the flag.</p>
<p>Unfortunately, there doesn&#x27;t appear to be any other path forward than sheer brute force. AES accepts keys of <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#Cipher">128, 192, and 256 bits</a> — 16, 24, and 32 bytes, or 4, 6, and 8 bytes for us to guess. Assuming the smallest key size, here&#x27;s a Kotlin script that brute forces just that:</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (kt)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword">import</span><span class=""> java</span><span class="token punctuation">.</span><span class="">io</span><span class="token punctuation">.</span><span class="">File
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class=""></span><span class="token keyword">import</span><span class=""> java</span><span class="token punctuation">.</span><span class="">nio</span><span class="token punctuation">.</span><span class="">ByteBuffer
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">import</span><span class=""> javax</span><span class="token punctuation">.</span><span class="">crypto</span><span class="token punctuation">.</span><span class="">Cipher
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class=""></span><span class="token keyword">import</span><span class=""> javax</span><span class="token punctuation">.</span><span class="">crypto</span><span class="token punctuation">.</span><span class="">spec</span><span class="token punctuation">.</span><span class="">SecretKeySpec
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class=""></span><span class="token keyword">fun</span><span class=""> </span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="">    </span><span class="token keyword">val</span><span class=""> encBytes </span><span class="token operator">=</span><span class=""> </span><span class="token function">File</span><span class="token punctuation">(</span><span class="token string-literal singleline string">&quot;./vault.enc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class="">    </span><span class="token keyword">for</span><span class=""> </span><span class="token punctuation">(</span><span class="">i </span><span class="token keyword">in</span><span class=""> 0u</span><span class="token operator">..</span><span class="">UInt</span><span class="token punctuation">.</span><span class="">MAX_VALUE</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="">        </span><span class="token keyword">val</span><span class=""> bytes </span><span class="token operator">=</span><span class=""> i</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">        </span><span class="token keyword">val</span><span class=""> key </span><span class="token operator">=</span><span class=""> bytes </span><span class="token operator">+</span><span class=""> bytes</span><span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">+</span><span class=""> bytes </span><span class="token operator">+</span><span class=""> bytes</span><span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="">        </span><span class="token keyword">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">i </span><span class="token operator">%</span><span class=""> 100000u </span><span class="token operator">==</span><span class=""> 0u</span><span class="token punctuation">)</span><span class=""> </span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline string">&quot;key (</span><span class="token string-literal singleline interpolation interpolation-punctuation punctuation">${</span><span class="token string-literal singleline interpolation expression">key</span><span class="token string-literal singleline interpolation expression punctuation">.</span><span class="token string-literal singleline interpolation expression">size</span><span class="token string-literal singleline interpolation interpolation-punctuation punctuation">}</span><span class="token string-literal singleline string"> bytes): </span><span class="token string-literal singleline interpolation interpolation-punctuation punctuation">${</span><span class="token string-literal singleline interpolation expression">key</span><span class="token string-literal singleline interpolation expression punctuation">.</span><span class="token string-literal singleline interpolation expression function">toList</span><span class="token string-literal singleline interpolation expression punctuation">(</span><span class="token string-literal singleline interpolation expression punctuation">)</span><span class="token string-literal singleline interpolation interpolation-punctuation punctuation">}</span><span class="token string-literal singleline string">&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">        </span><span class="token keyword">val</span><span class=""> spec </span><span class="token operator">=</span><span class=""> </span><span class="token function">SecretKeySpec</span><span class="token punctuation">(</span><span class="">key</span><span class="token punctuation">,</span><span class=""> </span><span class="token string-literal singleline string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">        </span><span class="token keyword">val</span><span class=""> cipher </span><span class="token operator">=</span><span class=""> Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string-literal singleline string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">        cipher</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class=""> spec</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="">        </span><span class="token keyword">try</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">            </span><span class="token keyword">val</span><span class=""> res </span><span class="token operator">=</span><span class=""> cipher</span><span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span><span class="">encBytes</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="">Charsets</span><span class="token punctuation">.</span><span class="">UTF_8</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="">            </span><span class="token keyword">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">res</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string-literal singleline string">&quot;0xL4ugh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">                </span><span class="token function">println</span><span class="token punctuation">(</span><span class="">res</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">                </span><span class="token keyword">break</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">            </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">        </span><span class="token punctuation">}</span><span class=""> </span><span class="token keyword">catch</span><span class=""> </span><span class="token punctuation">(</span><span class="">e</span><span class="token operator">:</span><span class=""> Exception</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span><span class="">            </span><span class="token comment">// println(&quot;Decryption failed&quot;)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="">        </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">    </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class=""></span><span class="token keyword">fun</span><span class=""> Int</span><span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class=""> ByteArray </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span><span class="">    </span><span class="token keyword">val</span><span class=""> buffer </span><span class="token operator">=</span><span class=""> ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="">Int</span><span class="token punctuation">.</span><span class="">SIZE_BYTES</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class="">    buffer</span><span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="">    </span><span class="token keyword">return</span><span class=""> buffer</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span><span class=""></span><span class="token punctuation">}</span></code></pre></div></div>
<p>After a few hours, we get the flag:</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">key (16 bytes): [55, 46, -106, 64, 64, -106, 46, 55, 55, 46, -106, 64, 64, -106, 46, 55]
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span>key (16 bytes): [55, 48, 28, -32, -32, 28, 48, 55, 55, 48, 28, -32, -32, 28, 48, 55]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span>key (16 bytes): [55, 49, -93, -128, -128, -93, 49, 55, 55, 49, -93, -128, -128, -93, 49, 55]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span>key (16 bytes): [55, 51, 42, 32, 32, 42, 51, 55, 55, 51, 42, 32, 32, 42, 51, 55]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span>{
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span>  &quot;vault&quot;: [
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span>    {
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span>      &quot;id&quot;: 0,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span>      &quot;name&quot;: &quot;Mohamed Tarek&quot;,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span>      &quot;content&quot;: &quot;I hope You enjoyed with me!&quot;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span>    },
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span>    {
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span>      &quot;id&quot;: 1337,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span>      &quot;name&quot;: &quot;flag&quot;,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span>      &quot;content&quot;: &quot;0xL4ugh{Y0u_Ar3_FoRceR_Like_A_H0uRc3}&quot;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">17</span>  ]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">18</span>}</code></pre></div></div></main></div><!--$--><!--/$--><!--$--><!--/$--></main><script src="/_next/static/chunks/webpack-50d183473e3f8178.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[87555,[],\"\"]\n3:I[31295,[],\"\"]\n4:I[6874,[\"874\",\"static/chunks/874-c62c375efd21db20.js\",\"633\",\"static/chunks/app/writeups/%5Bid%5D/layout-0f792473045deceb.js\"],\"\"]\n6:I[59665,[],\"MetadataBoundary\"]\n8:I[59665,[],\"OutletBoundary\"]\nb:I[74911,[],\"AsyncMetadataOutlet\"]\nd:I[59665,[],\"ViewportBoundary\"]\nf:I[26614,[],\"\"]\n:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/da257a7bf05e11ce.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"4_bAk8K-NXO9_BWRG47Kd\",\"p\":\"\",\"c\":[\"\",\"writeups\",\"cec9f7e8071b52e890c6a2469360be48\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"writeups\",{\"children\":[[\"id\",\"cec9f7e8071b52e890c6a2469360be48\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/da257a7bf05e11ce.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"className\":\"dark scroll-smooth\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}]}],[\"$\",\"body\",null,{\"className\":\"text-dark dark:text-white dark:bg-midnight\",\"style\":{\"fontFamily\":\"'Inter', 'Inter Fallback'\",\"fontStyle\":\"normal\"},\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"h-screen flex items-center justify-center\",\"children\":[\"$\",\"main\",null,{\"className\":\"relative pl-14\",\"children\":[[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"absolute left-0 top-2 text-5xl text-grapefruit\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M256 48C140.559 48 48 140.559 48 256c0 115.436 92.559 208 208 208 115.435 0 208-92.564 208-208 0-115.441-92.564-208-208-208zm104.002 282.881l-29.12 29.117L256 285.117l-74.881 74.881-29.121-29.117L226.881 256l-74.883-74.881 29.121-29.116L256 226.881l74.881-74.878 29.12 29.116L285.119 256l74.883 74.881z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":\"1em\",\"width\":\"1em\",\"xmlns\":\"http://www.w3.org/2000/svg\"}],[\"$\",\"h1\",null,{\"className\":\"font-bold text-7xl underline decoration-grapefruit mb-5\",\"children\":\"404.\"}],[\"$\",\"p\",null,{\"children\":\"Your requested page was not found.\"}],[\"$\",\"$L4\",null,{\"href\":\"/\",\"className\":\"font-medium text-inherit\",\"children\":\"Return to home →\"}]]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[\"writeups\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"main\",null,{\"className\":\"container pt-20 pb-24\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],{\"children\":[[\"id\",\"cec9f7e8071b52e890c6a2469360be48\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[[\"$\",\"$L4\",null,{\"href\":\"/writeups\",\"className\":\"text-secondary text-sm mb-10 -ml-5 block w-max\",\"children\":\"← Back to writeups\"}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",[\"$\",\"$L6\",null,{\"children\":\"$L7\"}],null,[\"$\",\"$L8\",null,{\"children\":[\"$L9\",\"$La\",[\"$\",\"$Lb\",null,{\"promise\":\"$@c\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"qG-vjQdbn3_gOeBbESYSe\",{\"children\":[[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:\"$Sreact.suspense\"\n11:I[74911,[],\"AsyncMetadata\"]\n7:[\"$\",\"$10\",null,{\"fallback\":null,\"children\":[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]}]\n"])</script><script>self.__next_f.push([1,"a:null\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n9:null\n"])</script><script>self.__next_f.push([1,"13:I[50674,[\"325\",\"static/chunks/325-8cc74193b249521f.js\",\"134\",\"static/chunks/app/writeups/%5Bid%5D/page-d2275216898ea7fa.js\"],\"default\"]\n14:T459,    package com.tarek.myvault;\n\nimport android.os.Bundle;\nimport android.widget.Button;\nimport android.widget.EditText;\nimport d.m;\nimport i.c;\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.InputStream;\n\npublic class MainActivity extends m {\n    public final void onCreate(Bundle bundle) {\n        super.onCreate(bundle);\n        setContentView((int) R.layout.activity_main);\n        File file = new File(getCacheDir() + \"/vault.enc\");\n        if (!file.exists()) {\n            try {\n                InputStream open = getAssets().open(\"vault.enc\");\n                byte[] bArr = new byte[open.available()];\n                open.read(bArr);\n                open.close();\n                FileOutputStream fileOutputStream = new FileOutputStream(file);\n                fileOutputStream.write(bArr);\n                fileOutputStream.close();\n                ((Button) findViewById(R.id.btnSubmit)).setOnClickListener(new c(this, (EditText) findViewById(R.id.editTextOTP), 2));\n            } catch (Exception e3) {\n                throw new RuntimeException(e3);\n            }\n        }\n    }\n}15:T435,kevin@ky28059:/mnt/c/users/kevin/Downloads$ xxd vault.enc\n00000000: 3797 080e c05e 8e05 90f0 9c57 bf4e d622  7....^.....W.N.\"\n00000010: 6c56 fd13 e3c9 52b3 21ec 1871 fb08 b3a2  lV....R.!..q....\n00000020: 23de 50c3 a027 4a15 0fd9 2251 0703 c3e2  #.P..'J...\"Q....\n00000030: 37c6 7ce3 0414 2328 cb24 ca12 1520 6d1e  7.|...#(.$... m.\n00000040: ba4d 692a b1e3 cacb 847b a957 df74 9896  .Mi*.....{.W.t..\n00000050: 578c 67b8 b837 cf6c 4993 df21 3728 e001  W.g..7.lI..!7(..\n00000060: e357 9a89 b1a5 2624 57e9 d093 0242 c0e9  .W....\u0026$W....B..\n00000070: dd42 4cb7 4c77 7c8f 1c93 17c4 184a 1cb9  .BL.Lw|......J..\n00000080: cb02 d559 b5db d990 6c73 7ae0 7e50 3b6b  ...Y....lsz.~P;k\n00000090: 7255 8c0b fe25 3c08 39e9 205a bb09 3531  rU...%\u003c.9. Z..51\n000000a0: 00cc 6330 d44e f54c 4d8d 44f7 18"])</script><script>self.__next_f.push([1,"c7 cdad  ..c0.N.LM.D.....\n000000b0: 370d 48ed 2635 7b00 e492 2354 474e e616  7.H.\u00265{...#TGN..\n000000c0: 35dc 780c 9e21 f756 0bcb 451e 7b64 cbd4  5.x..!.V..E.{d..\n000000d0: fe95 bab6 fda9 9c26 08b5 c17c dd85 c421  .......\u0026...|...!\n000000e0: 0eaa 5e78 7512 8829 2331 8fd0 2be6 7401  ..^xu..)#1..+.t.16:T7b5,    package i;\n\nimport android.view.KeyEvent;\nimport android.view.View;\nimport android.view.Window;\nimport android.widget.EditText;\nimport android.widget.Toast;\nimport com.tarek.myvault.MainActivity;\nimport h.a;\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport javax.crypto.Cipher;\nimport javax.crypto.spec.SecretKeySpec;\n\npublic final class c implements View.OnClickListener {\n\n    // ...\n\n    public final void onClick(View view) {\n        // ...\n        switch (i3) {\n            // ...\n            default:\n                String obj3 = ((EditText) obj2).getText().toString();\n                MainActivity mainActivity = (MainActivity) obj;\n                mainActivity.getClass();\n                try {\n                    String sb = new StringBuilder(obj3).reverse().toString();\n                    File file = new File(mainActivity.getCacheDir(), \"vault.txt\");\n                    File file2 = new File(mainActivity.getCacheDir(), \"vault.enc\");\n                    SecretKeySpec secretKeySpec = new SecretKeySpec((obj3 + sb + obj3 + sb).getBytes(), \"AES\");\n                    Cipher instance = Cipher.getInstance(\"AES\");\n                    instance.init(2, secretKeySpec);\n                    FileInputStream fileInputStream = new FileInputStream(file2);\n                    byte[] bArr = new byte[((int) file2.length())];\n                    fileInputStream.read(bArr);\n                    byte[] doFinal = instance.doFinal(bArr);\n                    FileOutputStream fileOutputStream = new FileOutputStream(file);\n                    fileOutputStream.write(doFinal);\n                    fileInputStream.close();\n                    fileOutputStream.close();\n                    str = \"Co"])</script><script>self.__next_f.push([1,"ngrats!\";\n                } catch (Exception unused) {\n                    str = \"Incorrect OTP\";\n                }\n                Toast.makeText(mainActivity, str, 0).show();\n                return;\n        }\n    }\n\n    // ...\n}"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"children\":[\"$\",\"main\",null,{\"className\":\"text-pretty max-w-5xl mx-auto text-sm [\u0026_h1]:text-5xl [\u0026_h1]:font-semibold [\u0026_h1]:mb-8 [\u0026_blockquote]:text-secondary [\u0026_blockquote]:space-y-3 [\u0026_blockquote]:border-l-4 [\u0026_blockquote]:border-secondary [\u0026_blockquote]:pl-5 [\u0026_blockquote]:mb-5 [\u0026\u003e_p]:my-3 [\u0026_img]:my-5 [\u0026_ul]:list-disc [\u0026_ul]:pl-6 [\u0026_ol]:list-decimal [\u0026_ol]:pl-6 [\u0026_img]:rounded [\u0026_li]:my-2\",\"children\":[[\"$\",\"h1\",\"h1-0\",{\"children\":\"0xL4ugh CTF 2024 — MyVault\"}],\"\\n\",[\"$\",\"blockquote\",\"blockquote-0\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"Welcome to our secure vault !\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"We're given an APK file that decompiles to, among other things,\"}],\"\\n\",[\"$\",\"$L13\",\"pre-0\",{\"className\":\"my-4\",\"children\":\"$14\",\"language\":\"java\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"The main activity reads bytes from the encoded \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"vault.enc\"}],\" file, then sets up a click listener via \",[\"$\",\"code\",\"code-1\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"new c()\"}],\".\"]}],\"\\n\",[\"$\",\"$L13\",\"pre-1\",{\"className\":\"my-4\",\"children\":\"$15\",\"language\":\"$undefined\"}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":[\"Looking in \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"i.c\"}],\",\"]}],\"\\n\",[\"$\",\"$L13\",\"pre-2\",{\"className\":\"my-4\",\"children\":\"$16\",\"language\":\"java\"}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":\"On click, the handler pulls a string from a text input, creating an AES key equal to\"}],\"\\n\",[\"$\",\"$L13\",\"pre-3\",{\"className\":\"my-4\",\"children\":\"{string}{reversed string}{string}{reversed string}\",\"language\":\"$undefined\"}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":[\"and uses it to attempt to decrypt the vault. On success, it writes the result to \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"vault.txt\"}],\".\"]}],\"\\n\",[\"$\",\"$L13\",\"pre-4\",{\"className\":\"my-4\",\"children\":\"String obj3 = ((EditText) obj2).getText().toString();\\nString sb = new StringBuilder(obj3).reverse().toString();\\n\\n// ...\\n\\nSecretKeySpec secretKeySpec = new SecretKeySpec((obj3 + sb + obj3 + sb).getBytes(), \\\"AES\\\");\\nCipher instance = Cipher.getInstance(\\\"AES\\\");\\ninstance.init(2, secretKeySpec);\\n\\n// ...\\n\\nbyte[] doFinal = instance.doFinal(bArr);\",\"language\":\"java\"}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":\"Because we know the key is the same string repeated (and reversed) 4 times, we only need to find the first fourth of the key to get the flag.\"}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":[\"Unfortunately, there doesn't appear to be any other path forward than sheer brute force. AES accepts keys of \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#Cipher\",\"children\":\"128, 192, and 256 bits\"}],\" — 16, 24, and 32 bytes, or 4, 6, and 8 bytes for us to guess. Assuming the smallest key size, here's a Kotlin script that brute forces just that:\"]}],\"\\n\",[\"$\",\"$L13\",\"pre-5\",{\"className\":\"my-4\",\"children\":\"import java.io.File\\nimport java.nio.ByteBuffer\\nimport javax.crypto.Cipher\\nimport javax.crypto.spec.SecretKeySpec\\n\\nfun main() {\\n    val encBytes = File(\\\"./vault.enc\\\").readBytes()\\n\\n    for (i in 0u..UInt.MAX_VALUE) {\\n        val bytes = i.toInt().toByteArray()\\n\\n        val key = bytes + bytes.reversed() + bytes + bytes.reversed()\\n        if (i % 100000u == 0u) println(\\\"key (${key.size} bytes): ${key.toList()}\\\")\\n\\n        val spec = SecretKeySpec(key, \\\"AES\\\")\\n        val cipher = Cipher.getInstance(\\\"AES\\\")\\n        cipher.init(2, spec)\\n\\n        try {\\n            val res = cipher.doFinal(encBytes).toString(Charsets.UTF_8)\\n            if (res.contains(\\\"0xL4ugh\\\")) {\\n                println(res)\\n                break\\n            }\\n        } catch (e: Exception) {\\n            // println(\\\"Decryption failed\\\")\\n        }\\n    }\\n}\\n\\nfun Int.toByteArray(): ByteArray {\\n    val buffer = ByteBuffer.allocate(Int.SIZE_BYTES)\\n    buffer.putInt(this)\\n    return buffer.array()\\n}\",\"language\":\"kt\"}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":\"After a few hours, we get the flag:\"}],\"\\n\",[\"$\",\"$L13\",\"pre-6\",{\"className\":\"my-4\",\"children\":\"key (16 bytes): [55, 46, -106, 64, 64, -106, 46, 55, 55, 46, -106, 64, 64, -106, 46, 55]\\nkey (16 bytes): [55, 48, 28, -32, -32, 28, 48, 55, 55, 48, 28, -32, -32, 28, 48, 55]\\nkey (16 bytes): [55, 49, -93, -128, -128, -93, 49, 55, 55, 49, -93, -128, -128, -93, 49, 55]\\nkey (16 bytes): [55, 51, 42, 32, 32, 42, 51, 55, 55, 51, 42, 32, 32, 42, 51, 55]\\n{\\n  \\\"vault\\\": [\\n    {\\n      \\\"id\\\": 0,\\n      \\\"name\\\": \\\"Mohamed Tarek\\\",\\n      \\\"content\\\": \\\"I hope You enjoyed with me!\\\"\\n    },\\n    {\\n      \\\"id\\\": 1337,\\n      \\\"name\\\": \\\"flag\\\",\\n      \\\"content\\\": \\\"0xL4ugh{Y0u_Ar3_FoRceR_Like_A_H0uRc3}\\\"\\n    }\\n  ]\\n}\",\"language\":\"$undefined\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"12:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"0xL4ugh CTF 2024 — MyVault | kevin.fish\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Welcome to our secure vault !\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"0xL4ugh CTF 2024 — MyVault\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"Welcome to our secure vault !\"}],[\"$\",\"meta\",\"4\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"5\",{\"name\":\"twitter:title\",\"content\":\"0xL4ugh CTF 2024 — MyVault\"}],[\"$\",\"meta\",\"6\",{\"name\":\"twitter:description\",\"content\":\"Welcome to our secure vault !\"}]],\"error\":null,\"digest\":\"$undefined\"}\nc:{\"metadata\":\"$12:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>