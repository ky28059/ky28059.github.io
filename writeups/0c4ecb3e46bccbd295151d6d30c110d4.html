<!DOCTYPE html><!--scCeJOABsuN_qPV3g5t_H--><html class="dark scroll-smooth"><head><meta charSet="utf-8"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="https://gist.github.com/assets/60120929/6ec32800-c9c9-4060-8925-c4cf550fbd5b"/><link rel="preload" as="image" href="https://gist.github.com/assets/60120929/baae2b59-e268-4aaa-af1e-fcfb460a0537"/><link rel="preload" as="image" href="https://gist.github.com/assets/60120929/ceaafc72-0440-4017-9d59-c2189679c084"/><link rel="preload" as="image" href="https://gist.github.com/assets/60120929/e194b998-5ae2-4fa8-b41f-fd13851c147e"/><link rel="stylesheet" href="/_next/static/css/b7a1bece15a86168.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-7cc99edc1a50fd44.js"/><script src="/_next/static/chunks/4bd1b696-9911af18dede28aa.js" async=""></script><script src="/_next/static/chunks/964-2bcac1827bbf29c7.js" async=""></script><script src="/_next/static/chunks/main-app-771e5b53791411ad.js" async=""></script><script src="/_next/static/chunks/874-3e820bd666038662.js" async=""></script><script src="/_next/static/chunks/app/writeups/%5Bid%5D/layout-2577bd3482649595.js" async=""></script><script src="/_next/static/chunks/bc9c3264-6371ca03223855d4.js" async=""></script><script src="/_next/static/chunks/48507feb-8452885980bba250.js" async=""></script><script src="/_next/static/chunks/08ffe114-f47006c90e36a3eb.js" async=""></script><script src="/_next/static/chunks/800-bd0deb6e7b7e903a.js" async=""></script><script src="/_next/static/chunks/app/writeups/%5Bid%5D/page-54fe20cc7a9d3224.js" async=""></script><meta name="next-size-adjust" content=""/><title>GPN CTF 2024 — Letter to the editor | kevin.fish</title><meta name="description" content="Old software, good software:"/><meta property="og:title" content="GPN CTF 2024 — Letter to the editor"/><meta property="og:description" content="Old software, good software:"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="GPN CTF 2024 — Letter to the editor"/><meta name="twitter:description" content="Old software, good software:"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="text-dark dark:text-white dark:bg-midnight" style="font-family:&#x27;Inter&#x27;, &#x27;Inter Fallback&#x27;;font-style:normal"><div hidden=""><!--$--><!--/$--></div><main class="container pt-20 pb-24"><a class="text-secondary text-sm mb-10 -ml-5 block w-max" href="/writeups">← Back to writeups</a><div><main class="text-pretty max-w-5xl mx-auto text-sm [&amp;_h1]:text-5xl [&amp;_h1]:font-semibold [&amp;_h1]:mb-8 [&amp;_blockquote]:text-secondary [&amp;_blockquote]:space-y-3 [&amp;_blockquote]:border-l-4 [&amp;_blockquote]:border-secondary [&amp;_blockquote]:pl-5 [&amp;_blockquote]:mb-5 [&amp;&gt;_p]:my-4 [&amp;_img]:my-5 [&amp;_ul]:list-disc [&amp;_ul]:pl-6 [&amp;_ol]:list-decimal [&amp;_ol]:pl-6 [&amp;_img]:rounded [&amp;_li]:my-2"><h1>GPN CTF 2024 — Letter to the editor</h1>
<blockquote>
<p>Old software, good software:</p>
<p>Clone and pwn: <a href="https://github.com/FirebaseExtended/firepad">https://github.com/FirebaseExtended/firepad</a></p>
</blockquote>
<p>We&#x27;re given a very minimal admin bot launcher page that gives us a URL to a demo Firepad.</p>
<p><img src="https://gist.github.com/assets/60120929/6ec32800-c9c9-4060-8925-c4cf550fbd5b" alt="image"/></p>
<p>Without any further details, it looks like we&#x27;re meant to find a (likely XSS) vulnerability in the Firepad source code we can use on the admin to get the flag.</p>
<p>Looking at the Firepad source code, we can find a <a href="https://github.com/FirebaseExtended/firepad/blob/master/lib/firepad.js#L287-L294">function that lets us insert HTML strings into our pad</a>:</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">  </span><span class="token class-name">Firepad</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">insertHtml</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">function</span><span class=""> </span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token parameter punctuation">,</span><span class="token parameter"> html</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="">    </span><span class="token keyword">var</span><span class=""> lines </span><span class="token operator">=</span><span class=""> firepad</span><span class="token punctuation">.</span><span class="token method function property-access maybe-class-name">ParseHtml</span><span class="token punctuation">(</span><span class="">html</span><span class="token punctuation">,</span><span class=""> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">entityManager_</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">insertText</span><span class="token punctuation">(</span><span class="">index</span><span class="token punctuation">,</span><span class=""> lines</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="">  </span><span class="token class-name">Firepad</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">insertHtmlAtCursor</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">function</span><span class=""> </span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">insertHtml</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">codeMirror_</span><span class="token punctuation">.</span><span class="token method function property-access">indexFromPos</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">codeMirror_</span><span class="token punctuation">.</span><span class="token method function property-access">getCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> html</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div></div>
<p>Looking at <a href="https://github.com/FirebaseExtended/firepad/blob/master/lib/parse-html.js#L104-L215">how this HTML is parsed</a>,</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">  </span><span class="token keyword">var</span><span class=""> entityManager_</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="">  </span><span class="token keyword">function</span><span class=""> </span><span class="token function">parseHtml</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token parameter punctuation">,</span><span class="token parameter"> entityManager</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="">    </span><span class="token comment">// Create DIV with HTML (as a convenient way to parse it).</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">    </span><span class="token keyword">var</span><span class=""> div </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">(</span><span class="">firepad</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class=""> </span><span class="token operator">||</span><span class=""> </span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="">    div</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span><span class=""> </span><span class="token operator">=</span><span class=""> html</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="">    </span><span class="token comment">// HACK until I refactor this.</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="">    entityManager_ </span><span class="token operator">=</span><span class=""> entityManager</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="">    </span><span class="token keyword">var</span><span class=""> output </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">ParseOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="">    </span><span class="token keyword">var</span><span class=""> state </span><span class="token operator">=</span><span class=""> </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">ParseState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">    </span><span class="token function">parseNode</span><span class="token punctuation">(</span><span class="">div</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="">    </span><span class="token keyword control-flow">return</span><span class=""> output</span><span class="token punctuation">.</span><span class="token property-access">lines</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">  </span><span class="token punctuation">}</span></code></pre></div></div>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class=""> </span><span class="token keyword">function</span><span class=""> </span><span class="token function">parseNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token parameter punctuation">,</span><span class="token parameter"> state</span><span class="token parameter punctuation">,</span><span class="token parameter"> output</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="">    </span><span class="token comment">// Give entity manager first crack at it.</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="">    </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">.</span><span class="token property-access">nodeType</span><span class=""> </span><span class="token operator">===</span><span class=""> </span><span class="token maybe-class-name">Node</span><span class="token punctuation">.</span><span class="token constant">ELEMENT_NODE</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">      </span><span class="token keyword">var</span><span class=""> entity </span><span class="token operator">=</span><span class=""> entityManager_</span><span class="token punctuation">.</span><span class="token method function property-access">fromElement</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="">      </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">entity</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="">        output</span><span class="token punctuation">.</span><span class="token property-access">currentLine</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">firepad</span><span class="token class-name punctuation">.</span><span class="token class-name">Text</span><span class="token punctuation">(</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="">            firepad</span><span class="token punctuation">.</span><span class="token property-access">sentinelConstants</span><span class="token punctuation">.</span><span class="token constant">ENTITY_SENTINEL_CHARACTER</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="">            </span><span class="token keyword">new</span><span class=""> </span><span class="token class-name">firepad</span><span class="token class-name punctuation">.</span><span class="token class-name">Formatting</span><span class="token punctuation">(</span><span class="">entity</span><span class="token punctuation">.</span><span class="token method function property-access">toAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class="">        </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="">        </span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="">      </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">    </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="">    </span><span class="token keyword control-flow">switch</span><span class=""> </span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">.</span><span class="token property-access">nodeType</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">      </span><span class="token keyword">case</span><span class=""> </span><span class="token maybe-class-name">Node</span><span class="token punctuation">.</span><span class="token constant">TEXT_NODE</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">        </span><span class="token comment">// This probably isn&#x27;t exactly right, but mostly works...</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">        </span><span class="token keyword">var</span><span class=""> text </span><span class="token operator">=</span><span class=""> node</span><span class="token punctuation">.</span><span class="token property-access">nodeValue</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">[ \n\t]+</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">g</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27; &#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="">        output</span><span class="token punctuation">.</span><span class="token property-access">currentLine</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="">firepad</span><span class="token punctuation">.</span><span class="token method function property-access maybe-class-name">Text</span><span class="token punctuation">(</span><span class="">text</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">.</span><span class="token property-access">textFormatting</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="">        </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">      </span><span class="token keyword">case</span><span class=""> </span><span class="token maybe-class-name">Node</span><span class="token punctuation">.</span><span class="token constant">ELEMENT_NODE</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="">        </span><span class="token keyword">var</span><span class=""> style </span><span class="token operator">=</span><span class=""> node</span><span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;style&#x27;</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">||</span><span class=""> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">        state </span><span class="token operator">=</span><span class=""> </span><span class="token function">parseStyle</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">,</span><span class=""> style</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">        </span><span class="token keyword control-flow">switch</span><span class=""> </span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">.</span><span class="token property-access">nodeName</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;div&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;h1&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;h2&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;h3&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;p&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="">            output</span><span class="token punctuation">.</span><span class="token method function property-access">newlineIfNonEmpty</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="">            output</span><span class="token punctuation">.</span><span class="token method function property-access">newlineIfNonEmpty</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;center&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="">            state </span><span class="token operator">=</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withAlign</span><span class="token punctuation">(</span><span class="token string">&#x27;center&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span><span class="">            output</span><span class="token punctuation">.</span><span class="token method function property-access">newlineIfNonEmpty</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">36</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withAlign</span><span class="token punctuation">(</span><span class="token string">&#x27;center&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class="">            output</span><span class="token punctuation">.</span><span class="token method function property-access">newlineIfNonEmpty</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">38</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">39</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;b&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">40</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;strong&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">41</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withTextFormatting</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">.</span><span class="token property-access">textFormatting</span><span class="token punctuation">.</span><span class="token method function property-access">bold</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">43</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;u&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">44</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withTextFormatting</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">.</span><span class="token property-access">textFormatting</span><span class="token punctuation">.</span><span class="token method function property-access">underline</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">45</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">46</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;i&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">47</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;em&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">48</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withTextFormatting</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">.</span><span class="token property-access">textFormatting</span><span class="token punctuation">.</span><span class="token method function property-access">italic</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">49</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">50</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;s&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">51</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withTextFormatting</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">.</span><span class="token property-access">textFormatting</span><span class="token punctuation">.</span><span class="token method function property-access">strike</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">52</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">53</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;font&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">54</span><span class="">            </span><span class="token keyword">var</span><span class=""> face </span><span class="token operator">=</span><span class=""> node</span><span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;face&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">55</span><span class="">            </span><span class="token keyword">var</span><span class=""> color </span><span class="token operator">=</span><span class=""> node</span><span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;color&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">56</span><span class="">            </span><span class="token keyword">var</span><span class=""> size </span><span class="token operator">=</span><span class=""> </span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;size&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">57</span><span class="">            </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">face</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class=""> state </span><span class="token operator">=</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withTextFormatting</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">.</span><span class="token property-access">textFormatting</span><span class="token punctuation">.</span><span class="token method function property-access">font</span><span class="token punctuation">(</span><span class="">face</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class=""> </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">58</span><span class="">            </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">color</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class=""> state </span><span class="token operator">=</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withTextFormatting</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">.</span><span class="token property-access">textFormatting</span><span class="token punctuation">.</span><span class="token method function property-access">color</span><span class="token punctuation">(</span><span class="">color</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class=""> </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">59</span><span class="">            </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">size</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class=""> state </span><span class="token operator">=</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withTextFormatting</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">.</span><span class="token property-access">textFormatting</span><span class="token punctuation">.</span><span class="token method function property-access">fontSize</span><span class="token punctuation">(</span><span class="">size</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class=""> </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">60</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">61</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">62</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;br&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">63</span><span class="">            output</span><span class="token punctuation">.</span><span class="token method function property-access">newline</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">64</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">65</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;ul&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">66</span><span class="">            output</span><span class="token punctuation">.</span><span class="token method function property-access">newlineIfNonEmptyOrListItem</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">67</span><span class="">            </span><span class="token keyword">var</span><span class=""> listType </span><span class="token operator">=</span><span class=""> node</span><span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;class&#x27;</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">===</span><span class=""> </span><span class="token string">&#x27;firepad-todo&#x27;</span><span class=""> </span><span class="token operator">?</span><span class=""> </span><span class="token constant">LIST_TYPE</span><span class="token punctuation">.</span><span class="token constant">TODO</span><span class=""> </span><span class="token operator">:</span><span class=""> </span><span class="token constant">LIST_TYPE</span><span class="token punctuation">.</span><span class="token constant">UNORDERED</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">68</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withListType</span><span class="token punctuation">(</span><span class="">listType</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">withIncreasedIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">69</span><span class="">            output</span><span class="token punctuation">.</span><span class="token method function property-access">newlineIfNonEmpty</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">70</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">71</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;ol&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">72</span><span class="">            output</span><span class="token punctuation">.</span><span class="token method function property-access">newlineIfNonEmptyOrListItem</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">73</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">.</span><span class="token method function property-access">withListType</span><span class="token punctuation">(</span><span class="token constant">LIST_TYPE</span><span class="token punctuation">.</span><span class="token constant">ORDERED</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">withIncreasedIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">74</span><span class="">            output</span><span class="token punctuation">.</span><span class="token method function property-access">newlineIfNonEmpty</span><span class="token punctuation">(</span><span class="">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">75</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">76</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;li&#x27;</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">77</span><span class="">            </span><span class="token function">parseListItem</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">78</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">79</span><span class="">          </span><span class="token keyword">case</span><span class=""> </span><span class="token string">&#x27;style&#x27;</span><span class="token operator">:</span><span class=""> </span><span class="token comment">// ignore.</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">80</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">81</span><span class="">          </span><span class="token keyword module">default</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">82</span><span class="">            </span><span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="">node</span><span class="token punctuation">,</span><span class=""> state</span><span class="token punctuation">,</span><span class=""> output</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">83</span><span class="">            </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">84</span><span class="">        </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">85</span><span class="">        </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">86</span><span class="">      </span><span class="token keyword module">default</span><span class="token operator">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">87</span><span class="">        </span><span class="token comment">// Ignore other nodes (comments, etc.)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">88</span><span class="">        </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">89</span><span class="">    </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">90</span><span class="">  </span><span class="token punctuation">}</span></code></pre></div></div>
<p>the rendering process seems to be as follows:</p>
<ol>
<li>Insert the HTML into a dummy <code class="opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]">div</code> to let the browser parse it as DOM nodes.</li>
<li>If the node is of a type the &quot;entity manager&quot; can support, use that to render it instead.</li>
<li>Otherwise, treat select tags as prompts to enable / disable text formatting options in the parser state, ignoring all other tags and attributes.</li>
</ol>
<p>Looking at the <a href="https://github.com/FirebaseExtended/firepad/blob/master/lib/entity-manager.js#L6-L35">entity manager</a>,</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">  </span><span class="token keyword">function</span><span class=""> </span><span class="token function maybe-class-name">EntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">entities_</span><span class=""> </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="">    </span><span class="token keyword">var</span><span class=""> attrs </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">[</span><span class="token string">&#x27;src&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;alt&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;width&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;height&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;style&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;class&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span><span class="token string">&#x27;img&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="">      </span><span class="token function-variable function">render</span><span class="token operator">:</span><span class=""> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="">        utils</span><span class="token punctuation">.</span><span class="token method function property-access">assert</span><span class="token punctuation">(</span><span class="">info</span><span class="token punctuation">.</span><span class="token property-access">src</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&quot;image entity should have &#x27;src&#x27;!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="">        </span><span class="token keyword">var</span><span class=""> attrs </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">[</span><span class="token string">&#x27;src&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;alt&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;width&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;height&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;style&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token string">&#x27;class&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class="">        </span><span class="token keyword">var</span><span class=""> html </span><span class="token operator">=</span><span class=""> </span><span class="token string">&#x27;&lt;img &#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="">        </span><span class="token keyword control-flow">for</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class=""> i </span><span class="token operator">=</span><span class=""> </span><span class="token number">0</span><span class="token punctuation">;</span><span class=""> i </span><span class="token operator">&lt;</span><span class=""> attrs</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span><span class=""> i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="">          </span><span class="token keyword">var</span><span class=""> attr </span><span class="token operator">=</span><span class=""> attrs</span><span class="token punctuation">[</span><span class="">i</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">          </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">attr </span><span class="token keyword">in</span><span class=""> info</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="">            html </span><span class="token operator">+=</span><span class=""> </span><span class="token string">&#x27; &#x27;</span><span class=""> </span><span class="token operator">+</span><span class=""> attr </span><span class="token operator">+</span><span class=""> </span><span class="token string">&#x27;=&quot;&#x27;</span><span class=""> </span><span class="token operator">+</span><span class=""> info</span><span class="token punctuation">[</span><span class="">attr</span><span class="token punctuation">]</span><span class=""> </span><span class="token operator">+</span><span class=""> </span><span class="token string">&#x27;&quot;&#x27;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="">          </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">        </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">        html </span><span class="token operator">+=</span><span class=""> </span><span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">        </span><span class="token keyword control-flow">return</span><span class=""> html</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="">      </span><span class="token function-variable function">fromElement</span><span class="token operator">:</span><span class=""> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">        </span><span class="token keyword">var</span><span class=""> info </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="">        </span><span class="token keyword control-flow">for</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class=""> i </span><span class="token operator">=</span><span class=""> </span><span class="token number">0</span><span class="token punctuation">;</span><span class=""> i </span><span class="token operator">&lt;</span><span class=""> attrs</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span><span class=""> i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">          </span><span class="token keyword">var</span><span class=""> attr </span><span class="token operator">=</span><span class=""> attrs</span><span class="token punctuation">[</span><span class="">i</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">          </span><span class="token keyword control-flow">if</span><span class=""> </span><span class="token punctuation">(</span><span class="">element</span><span class="token punctuation">.</span><span class="token method function property-access">hasAttribute</span><span class="token punctuation">(</span><span class="">attr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">            info</span><span class="token punctuation">[</span><span class="">attr</span><span class="token punctuation">]</span><span class=""> </span><span class="token operator">=</span><span class=""> element</span><span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="">attr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">          </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span><span class="">        </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="">        </span><span class="token keyword control-flow">return</span><span class=""> info</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">      </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span class="">  </span><span class="token punctuation">}</span></code></pre></div></div>
<p>the only tag its set up to parse are <code class="opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]">img</code> tags. Furthermore, it has an allowlist of attributes that it renders selectively: though trying</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">firepad</span><span class="token punctuation">.</span><span class="token method function property-access">insertHtmlAtCursor</span><span class="token punctuation">(</span><span class="token string">&#x27;&lt;img src=x onerror=&quot;...&quot;&gt;&#x27;</span><span class="token punctuation">)</span></code></pre></div></div>
<p>looks like it works, it only results in self-XSS as the <code class="opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]">onerror</code> attribute is scrubbed when rendered on another screen.</p>
<p><img src="https://gist.github.com/assets/60120929/baae2b59-e268-4aaa-af1e-fcfb460a0537" alt="image"/></p>
<p>Instead, we can get the same general attack to work using attribute injection. Because the entity manager generates the final HTML string using string concatenation, if we construct a payload like</p>
<div class="border border-white/10 rounded-lg my-2"><p class="flex items-center text-xs rounded-t-lg px-3 py-0.5 text-secondary"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="text-sm mr-1.5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"></path></svg> <!-- -->js<button class="ml-auto hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">firepad</span><span class="token punctuation">.</span><span class="token method function property-access">insertHtmlAtCursor</span><span class="token punctuation">(</span><span class="token string">&#x27;&lt;img src=x width=\&#x27;300px&quot; onerror=&quot;...&quot;\&#x27;&gt;&#x27;</span><span class="token punctuation">)</span></code></pre></div></div>
<p>we can get the <code class="opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]">onerror</code> attribute to render by smuggling it inside another attribute, giving us XSS.</p>
<p>Since there&#x27;s no source for the admin bot, it&#x27;s a bit unclear what we&#x27;re meant to exfiltrate from here. However, we can just try both cookies and localStorage to get the flag:</p>
<p><img src="https://gist.github.com/assets/60120929/ceaafc72-0440-4017-9d59-c2189679c084" alt="image"/></p>
<p><img src="https://gist.github.com/assets/60120929/e194b998-5ae2-4fa8-b41f-fd13851c147e" alt="image"/></p></main></div><!--$--><!--/$--></main><script src="/_next/static/chunks/webpack-7cc99edc1a50fd44.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[87555,[],\"\"]\n3:I[31295,[],\"\"]\n4:I[6874,[\"874\",\"static/chunks/874-3e820bd666038662.js\",\"633\",\"static/chunks/app/writeups/%5Bid%5D/layout-2577bd3482649595.js\"],\"\"]\n6:I[59665,[],\"OutletBoundary\"]\n8:I[74911,[],\"AsyncMetadataOutlet\"]\na:I[59665,[],\"ViewportBoundary\"]\nc:I[59665,[],\"MetadataBoundary\"]\nd:\"$Sreact.suspense\"\nf:I[28393,[],\"\"]\n:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/b7a1bece15a86168.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"scCeJOABsuN-qPV3g5t-H\",\"p\":\"\",\"c\":[\"\",\"writeups\",\"0c4ecb3e46bccbd295151d6d30c110d4\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"writeups\",{\"children\":[[\"id\",\"0c4ecb3e46bccbd295151d6d30c110d4\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/b7a1bece15a86168.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"className\":\"dark scroll-smooth\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}]}],[\"$\",\"body\",null,{\"className\":\"text-dark dark:text-white dark:bg-midnight\",\"style\":{\"fontFamily\":\"'Inter', 'Inter Fallback'\",\"fontStyle\":\"normal\"},\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"h-screen flex items-center justify-center\",\"children\":[\"$\",\"main\",null,{\"className\":\"relative pl-14\",\"children\":[[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"absolute left-0 top-2 text-5xl text-grapefruit\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M256 48C140.559 48 48 140.559 48 256c0 115.436 92.559 208 208 208 115.435 0 208-92.564 208-208 0-115.441-92.564-208-208-208zm104.002 282.881l-29.12 29.117L256 285.117l-74.881 74.881-29.121-29.117L226.881 256l-74.883-74.881 29.121-29.116L256 226.881l74.881-74.878 29.12 29.116L285.119 256l74.883 74.881z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":\"1em\",\"width\":\"1em\",\"xmlns\":\"http://www.w3.org/2000/svg\"}],[\"$\",\"h1\",null,{\"className\":\"font-bold text-7xl underline decoration-grapefruit mb-5\",\"children\":\"404.\"}],[\"$\",\"p\",null,{\"children\":\"Your requested page was not found.\"}],[\"$\",\"$L4\",null,{\"href\":\"/\",\"className\":\"font-medium text-inherit\",\"children\":\"Return to home →\"}]]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[\"writeups\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"main\",null,{\"className\":\"container pt-20 pb-24\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],{\"children\":[[\"id\",\"0c4ecb3e46bccbd295151d6d30c110d4\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[[\"$\",\"$L4\",null,{\"href\":\"/writeups\",\"className\":\"text-secondary text-sm mb-10 -ml-5 block w-max\",\"children\":\"← Back to writeups\"}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"promise\":\"$@9\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$d\",null,{\"fallback\":null,\"children\":\"$Le\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"10:I[50674,[\"263\",\"static/chunks/bc9c3264-6371ca03223855d4.js\",\"810\",\"static/chunks/48507feb-8452885980bba250.js\",\"330\",\"static/chunks/08ffe114-f47006c90e36a3eb.js\",\"800\",\"static/chunks/800-bd0deb6e7b7e903a.js\",\"134\",\"static/chunks/app/writeups/%5Bid%5D/page-54fe20cc7a9d3224.js\"],\"default\"]\n11:Tdcd,"])</script><script>self.__next_f.push([1," function parseNode(node, state, output) {\n    // Give entity manager first crack at it.\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      var entity = entityManager_.fromElement(node);\n      if (entity) {\n        output.currentLine.push(new firepad.Text(\n            firepad.sentinelConstants.ENTITY_SENTINEL_CHARACTER,\n            new firepad.Formatting(entity.toAttributes())\n        ));\n        return;\n      }\n    }\n\n    switch (node.nodeType) {\n      case Node.TEXT_NODE:\n        // This probably isn't exactly right, but mostly works...\n        var text = node.nodeValue.replace(/[ \\n\\t]+/g, ' ');\n        output.currentLine.push(firepad.Text(text, state.textFormatting));\n        break;\n      case Node.ELEMENT_NODE:\n        var style = node.getAttribute('style') || '';\n        state = parseStyle(state, style);\n        switch (node.nodeName.toLowerCase()) {\n          case 'div':\n          case 'h1':\n          case 'h2':\n          case 'h3':\n          case 'p':\n            output.newlineIfNonEmpty(state);\n            parseChildren(node, state, output);\n            output.newlineIfNonEmpty(state);\n            break;\n          case 'center':\n            state = state.withAlign('center');\n            output.newlineIfNonEmpty(state);\n            parseChildren(node, state.withAlign('center'), output);\n            output.newlineIfNonEmpty(state);\n            break;\n          case 'b':\n          case 'strong':\n            parseChildren(node, state.withTextFormatting(state.textFormatting.bold(true)), output);\n            break;\n          case 'u':\n            parseChildren(node, state.withTextFormatting(state.textFormatting.underline(true)), output);\n            break;\n          case 'i':\n          case 'em':\n            parseChildren(node, state.withTextFormatting(state.textFormatting.italic(true)), output);\n            break;\n          case 's':\n            parseChildren(node, state.withTextFormatting(state.textFormatting.strike(true)), output);\n            break;\n          case 'font':\n            var face = node.getAttribute('face');\n            var color = node.getAttribute('color');\n            var size = parseInt(node.getAttribute('size'));\n            if (face) { state = state.withTextFormatting(state.textFormatting.font(face)); }\n            if (color) { state = state.withTextFormatting(state.textFormatting.color(color)); }\n            if (size) { state = state.withTextFormatting(state.textFormatting.fontSize(size)); }\n            parseChildren(node, state, output);\n            break;\n          case 'br':\n            output.newline(state);\n            break;\n          case 'ul':\n            output.newlineIfNonEmptyOrListItem(state);\n            var listType = node.getAttribute('class') === 'firepad-todo' ? LIST_TYPE.TODO : LIST_TYPE.UNORDERED;\n            parseChildren(node, state.withListType(listType).withIncreasedIndent(), output);\n            output.newlineIfNonEmpty(state);\n            break;\n          case 'ol':\n            output.newlineIfNonEmptyOrListItem(state);\n            parseChildren(node, state.withListType(LIST_TYPE.ORDERED).withIncreasedIndent(), output);\n            output.newlineIfNonEmpty(state);\n            break;\n          case 'li':\n            parseListItem(node, state, output);\n            break;\n          case 'style': // ignore.\n            break;\n          default:\n            parseChildren(node, state, output);\n            break;\n        }\n        break;\n      default:\n        // Ignore other nodes (comments, etc.)\n        break;\n    }\n  }"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"children\":[\"$\",\"main\",null,{\"className\":\"text-pretty max-w-5xl mx-auto text-sm [\u0026_h1]:text-5xl [\u0026_h1]:font-semibold [\u0026_h1]:mb-8 [\u0026_blockquote]:text-secondary [\u0026_blockquote]:space-y-3 [\u0026_blockquote]:border-l-4 [\u0026_blockquote]:border-secondary [\u0026_blockquote]:pl-5 [\u0026_blockquote]:mb-5 [\u0026\u003e_p]:my-4 [\u0026_img]:my-5 [\u0026_ul]:list-disc [\u0026_ul]:pl-6 [\u0026_ol]:list-decimal [\u0026_ol]:pl-6 [\u0026_img]:rounded [\u0026_li]:my-2\",\"children\":[[\"$\",\"h1\",\"h1-0\",{\"children\":\"GPN CTF 2024 — Letter to the editor\"}],\"\\n\",[\"$\",\"blockquote\",\"blockquote-0\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"Old software, good software:\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"Clone and pwn: \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://github.com/FirebaseExtended/firepad\",\"children\":\"https://github.com/FirebaseExtended/firepad\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"We're given a very minimal admin bot launcher page that gives us a URL to a demo Firepad.\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/assets/60120929/6ec32800-c9c9-4060-8925-c4cf550fbd5b\",\"alt\":\"image\"}]}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":\"Without any further details, it looks like we're meant to find a (likely XSS) vulnerability in the Firepad source code we can use on the admin to get the flag.\"}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":[\"Looking at the Firepad source code, we can find a \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://github.com/FirebaseExtended/firepad/blob/master/lib/firepad.js#L287-L294\",\"children\":\"function that lets us insert HTML strings into our pad\"}],\":\"]}],\"\\n\",[\"$\",\"$L10\",\"pre-0\",{\"className\":\"my-2\",\"children\":\"  Firepad.prototype.insertHtml = function (index, html) {\\n    var lines = firepad.ParseHtml(html, this.entityManager_);\\n    this.insertText(index, lines);\\n  };\\n\\n  Firepad.prototype.insertHtmlAtCursor = function (html) {\\n    this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()), html);\\n  };\",\"language\":\"js\"}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":[\"Looking at \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://github.com/FirebaseExtended/firepad/blob/master/lib/parse-html.js#L104-L215\",\"children\":\"how this HTML is parsed\"}],\",\"]}],\"\\n\",[\"$\",\"$L10\",\"pre-1\",{\"className\":\"my-2\",\"children\":\"  var entityManager_;\\n  function parseHtml(html, entityManager) {\\n    // Create DIV with HTML (as a convenient way to parse it).\\n    var div = (firepad.document || document).createElement('div');\\n    div.innerHTML = html;\\n\\n    // HACK until I refactor this.\\n    entityManager_ = entityManager;\\n\\n    var output = new ParseOutput();\\n    var state = new ParseState();\\n    parseNode(div, state, output);\\n\\n    return output.lines;\\n  }\",\"language\":\"js\"}],\"\\n\",[\"$\",\"$L10\",\"pre-2\",{\"className\":\"my-2\",\"children\":\"$11\",\"language\":\"js\"}],\"\\n\",\"$L12\",\"\\n\",\"$L13\",\"\\n\",\"$L14\",\"\\n\",\"$L15\",\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\"]}]}]\n"])</script><script>self.__next_f.push([1,"12:[\"$\",\"p\",\"p-5\",{\"children\":\"the rendering process seems to be as follows:\"}]\n13:[\"$\",\"ol\",\"ol-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"Insert the HTML into a dummy \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"div\"}],\" to let the browser parse it as DOM nodes.\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"If the node is of a type the \\\"entity manager\\\" can support, use that to render it instead.\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"Otherwise, treat select tags as prompts to enable / disable text formatting options in the parser state, ignoring all other tags and attributes.\"}],\"\\n\"]}]\n14:[\"$\",\"p\",\"p-6\",{\"children\":[\"Looking at the \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://github.com/FirebaseExtended/firepad/blob/master/lib/entity-manager.js#L6-L35\",\"children\":\"entity manager\"}],\",\"]}]\n"])</script><script>self.__next_f.push([1,"15:[\"$\",\"$L10\",\"pre-3\",{\"className\":\"my-2\",\"children\":\"  function EntityManager() {\\n    this.entities_ = {};\\n\\n    var attrs = ['src', 'alt', 'width', 'height', 'style', 'class'];\\n    this.register('img', {\\n      render: function(info) {\\n        utils.assert(info.src, \\\"image entity should have 'src'!\\\");\\n        var attrs = ['src', 'alt', 'width', 'height', 'style', 'class'];\\n        var html = '\u003cimg ';\\n        for(var i = 0; i \u003c attrs.length; i++) {\\n          var attr = attrs[i];\\n          if (attr in info) {\\n            html += ' ' + attr + '=\\\"' + info[attr] + '\\\"';\\n          }\\n        }\\n        html += \\\"\u003e\\\";\\n        return html;\\n      },\\n      fromElement: function(element) {\\n        var info = {};\\n        for(var i = 0; i \u003c attrs.length; i++) {\\n          var attr = attrs[i];\\n          if (element.hasAttribute(attr)) {\\n            info[attr] = element.getAttribute(attr);\\n          }\\n        }\\n        return info;\\n      }\\n    });\\n  }\",\"language\":\"js\"}]\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"p\",\"p-7\",{\"children\":[\"the only tag its set up to parse are \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"img\"}],\" tags. Furthermore, it has an allowlist of attributes that it renders selectively: though trying\"]}]\n17:[\"$\",\"$L10\",\"pre-4\",{\"className\":\"my-2\",\"children\":\"firepad.insertHtmlAtCursor('\u003cimg src=x onerror=\\\"...\\\"\u003e')\",\"language\":\"js\"}]\n18:[\"$\",\"p\",\"p-8\",{\"children\":[\"looks like it works, it only results in self-XSS as the \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"onerror\"}],\" attribute is scrubbed when rendered on another screen.\"]}]\n19:[\"$\",\"p\",\"p-9\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/assets/60120929/baae2b59-e268-4aaa-af1e-fcfb460a0537\",\"alt\":\"image\"}]}]\n1a:[\"$\",\"p\",\"p-10\",{\"children\":\"Instead, we can get the same general attack to work using attribute injection. Because the entity manager generates the final HTML string using string concatenation, if we construct a payload like\"}]\n1b:[\"$\",\"$L10\",\"pre-5\",{\"className\":\"my-2\",\"children\":\"firepad.insertHtmlAtCursor('\u003cimg src=x width=\\\\'300px\\\" onerror=\\\"...\\\"\\\\'\u003e')\",\"language\":\"js\"}]\n1c:[\"$\",\"p\",\"p-11\",{\"children\":[\"we can get the \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]\",\"children\":\"onerror\"}],\" attribute to render by smuggling it inside another attribute, giving us XSS.\"]}]\n1d:[\"$\",\"p\",\"p-12\",{\"children\":\"Since there's no source for the admin bot, it's a bit unclear what we're meant to exfiltrate from here. However, we can just try both cookies and localStorage to get the flag:\"}]\n1e:[\"$\",\"p\",\"p-13\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/assets/60120929/ceaafc72-0440-4017-9d59-c2189679c084\",\"alt\":\"image\"}]}]\n1f:[\"$\",\"p\",\"p-14\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/assets/60120929/e194b998-5ae2-4fa8-b41f-fd13851c147e\",\"alt\":\"image\"}]}]\n"])</script><script>self.__next_f.push([1,"9:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"GPN CTF 2024 — Letter to the editor | kevin.fish\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Old software, good software:\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"GPN CTF 2024 — Letter to the editor\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"Old software, good software:\"}],[\"$\",\"meta\",\"4\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"5\",{\"name\":\"twitter:title\",\"content\":\"GPN CTF 2024 — Letter to the editor\"}],[\"$\",\"meta\",\"6\",{\"name\":\"twitter:description\",\"content\":\"Old software, good software:\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:\"$9:metadata\"\n"])</script></body></html>