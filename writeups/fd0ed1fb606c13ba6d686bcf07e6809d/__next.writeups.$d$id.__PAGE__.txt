1:"$Sreact.fragment"
2:I[10453,["/_next/static/chunks/b9afcb09c56609a6.js","/_next/static/chunks/59d5dd52dd9fcb16.js","/_next/static/chunks/0eb309e820c00a6d.js","/_next/static/chunks/a6b27ecf1b9e9188.js","/_next/static/chunks/39b99946d2be6a43.js"],"default"]
11:I[97367,["/_next/static/chunks/ff1a16fafef87110.js","/_next/static/chunks/b71c1cfea9076b4b.js"],"OutletBoundary"]
12:"$Sreact.suspense"
:HL["https://gist.github.com/assets/60120929/58a78bb3-8459-4bb1-a0cd-68f1e4491451","image"]
3:T4cf,import re

import numpy as np
import pwn

conn = pwn.remote('krusty-katering.ctf.umasscybersec.org', 1337)


def time_match_to_secs(n: str | None, t: str | None) -> int:
    if n is None:
        return 0
    return int(n) * (1 if t == 's' else 60 if t == 'm' else 3600)


def time_str_to_secs(s: str) -> int:
    groups = re.search(r'(\d+)([hms])(?:(\d+)([hms]))?(?:(\d+)([hms]))?', s).groups()
    return sum(time_match_to_secs(groups[i], groups[i + 1]) for i in range(0, 6, 2))


allotted = [0] * 10

try:
    for i in range(7):
        conn.recvuntil(f'Day {i + 1}. Time to beat: '.encode())
        print(f'Time to beat for day {i + 1}:', time_str_to_secs(conn.recvline().decode().rstrip()))

        for _ in range(1000):
            conn.recvuntil(b'Order ')
            print(conn.recvline().decode().rstrip(), allotted)

            conn.recvuntil('└── Estimated time to cook: '.encode())

            time_raw = conn.recvline().decode().rstrip()
            ts = time_str_to_secs(time_raw)

            min_index = np.argmin(allotted)
            allotted[min_index] += ts

            conn.sendline(str(min_index + 1).encode())

        allotted = [0] * 10
except EOFError:
    pass

print(conn.recvall().decode())0:{"buildId":"DfvEc75fs5QFxpmscM4-K","rsc":["$","$1","c",{"children":[["$","div",null,{"children":["$","main",null,{"className":"text-pretty max-w-5xl mx-auto text-sm [&_h1]:text-5xl [&_h1]:font-semibold [&_h1]:mb-8 [&_blockquote]:text-secondary [&_blockquote]:space-y-3 [&_blockquote]:border-l-4 [&_blockquote]:border-secondary [&_blockquote]:pl-5 [&_blockquote]:mb-5 [&>_p]:my-4 [&_img]:my-5 [&_ul]:list-disc [&_ul]:pl-6 [&_ol]:list-decimal [&_ol]:pl-6 [&_img]:rounded [&_li]:my-2","children":[["$","h1","h1-0",{"children":"UMass CTF 2024 — Krusty Katering"}],"\n",["$","blockquote","blockquote-0",{"children":["\n",["$","p","p-0",{"children":"Krusty Katering is hemorrhaging money, and Mr. Krabs has brought you in to fix it. You have 10 line cooks, and while they're okay at making Krabby patties, they can't agree on who cooks what and when. To make matters worse, Squidward (trying to keep his job) refuses to give you the list of orders, and will only tell you them one by one. Each time Squidward tells you a job, you get to add it to a cook's schedule for the day. Cooks cannot trade jobs, once it's on the schedule, it stays there. You want to ensure the last order finishes as soon as possible so that Mr. Krabs can close and count his profits. The competing Plankton's Provisions assigns their jobs randomly. So long as your crew is 20% more efficient than Team Chum Bucket every day this week, you're hired. Can you save Mr. Krabs' business?"}],"\n",["$","p","p-1",{"children":["$","code","code-0",{"className":"font-jetbrains opacity-75 bg-black/10 dark:bg-black/30 rounded px-1.5 py-1 text-[0.9em]","children":"nc krusty-katering.ctf.umasscybersec.org 1337"}]}],"\n"]}],"\n",["$","p","p-0",{"children":"We're given a terminal prompt that looks like this:"}],"\n",["$","p","p-1",{"children":["$","img","img-0",{"src":"https://gist.github.com/assets/60120929/58a78bb3-8459-4bb1-a0cd-68f1e4491451","alt":"image"}]}],"\n",["$","p","p-2",{"children":"The essence of the problem statement is as follows:"}],"\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":"We're given integers one-by-one to store in one of 10 \"buckets\" (e.g. you must add an integer to a bucket before receiving another one)."}],"\n",["$","li","li-1",{"children":"We want to minimize the max value among our buckets."}],"\n"]}],"\n",["$","p","p-3",{"children":"If we can write an algorithm that beats Plankton's randomized approach by 10% for 7 days of 1000 orders each, we get the flag."}],"\n",["$","p","p-4",{"children":"Because of the one-by-one nature of this problem, at first glance it looks like the most optimal algorithm can't do much better than greedy. Writing a script with the simplest greedy algorithm of \"store each integer in the lowest-value bucket\","}],"\n",["$","$L2","pre-0",{"className":"my-2","children":"$3","language":"py"}],"\n","$L4","\n","$L5","\n","$L6","\n","$L7","\n","$L8","\n","$L9"]}]}],["$La","$Lb","$Lc","$Ld"],"$Le"]}],"loading":null,"isPartial":false}
4:["$","p","p-5",{"children":"But this script is a bit inconsistent. If we're being lazy, however, because of the random nature of the problem running this a few times will eventually get us the flag."}]
5:["$","p","p-6",{"children":"We can also optimize the algorithm a little bit by, for each integer:"}]
6:["$","ol","ol-0",{"children":["\n",["$","li","li-0",{"children":"If there exists a bucket that you can add this integer to that does not change the maximum bucket value, add it to the largest bucket that satisfies that."}],"\n",["$","li","li-1",{"children":"Otherwise, revert to the previous greedy algorithm and add the integer to the lowest-value bucket."}],"\n"]}]
f:T67f,import re

import numpy as np
import pwn

conn = pwn.remote('krusty-katering.ctf.umasscybersec.org', 1337)


def time_match_to_secs(n: str | None, t: str | None) -> int:
    if n is None:
        return 0
    return int(n) * (1 if t == 's' else 60 if t == 'm' else 3600)


def time_str_to_secs(s: str) -> int:
    groups = re.search(r'(\d+)([hms])(?:(\d+)([hms]))?(?:(\d+)([hms]))?', s).groups()
    return sum(time_match_to_secs(groups[i], groups[i + 1]) for i in range(0, 6, 2))


allotted = [0] * 10

try:
    for i in range(7):
        conn.recvuntil(f'Day {i + 1}. Time to beat: '.encode())
        print(f'Time to beat for day {i + 1}:', time_str_to_secs(conn.recvline().decode().rstrip()))

        for _ in range(1000):
            conn.recvuntil(b'Order ')
            print(conn.recvline().decode().rstrip(), allotted)

            conn.recvuntil('└── Estimated time to cook: '.encode())

            time_raw = conn.recvline().decode().rstrip()
            ts = time_str_to_secs(time_raw)

            # Semi-greedy algorithm: for some input x, for all buckets find the maximum one that when you add x to it
            # does not change the current answer. If there are none, add to the minimum one, i.e. greedy.
            max_bucket = np.max(allotted)
            for j in range(10):
                if allotted[j] + ts <= max_bucket:
                    min_index = j
                    break
            else:
                min_index = np.argmin(allotted)

            allotted[min_index] += ts

            conn.sendline(str(min_index + 1).encode())

        allotted = [0] * 10
except EOFError:
    pass

print(conn.recvall().decode())7:["$","$L2","pre-1",{"className":"my-2","children":"$f","language":"py"}]
8:["$","p","p-7",{"children":"While there are still cases where this fails, this algorithm is more consistent than the aforementioned greedy approach and reliably gets the flag:"}]
10:T67c,...
#987: Banana [31430, 31700, 31260, 31215, 31230, 31420, 31450, 31440, 31730, 31630]
#988: Holographic Meatloaf [31445, 31700, 31260, 31215, 31230, 31420, 31450, 31440, 31730, 31630]
#989: Holographic Meatloaf [31445, 31700, 31260, 31765, 31230, 31420, 31450, 31440, 31730, 31630]
#990: Pretty Patty Combo [31445, 31700, 31260, 31765, 31780, 31420, 31450, 31440, 31730, 31630]
#991: Krabby Fries [31445, 31700, 31780, 31765, 31780, 31420, 31450, 31440, 31730, 31630]
#992: SpongeBob's Sundae [31445, 31700, 31780, 31765, 31780, 31870, 31450, 31440, 31730, 31630]
#993: Fried Oyster Skins [31815, 31700, 31780, 31765, 31780, 31870, 31450, 31440, 31730, 31630]
#994: Krabby Fries [31815, 31820, 31780, 31765, 31780, 31870, 31450, 31440, 31730, 31630]
#995: SpongeBob's Sundae [31815, 31820, 31780, 31765, 31780, 31870, 31450, 31890, 31730, 31630]
#996: Bran Flakes [31815, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]
#997: Banana [31845, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]
#998: Banana [31860, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]
#999: Holographic Meatloaf [31875, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]
#1000: Aged Patty [31875, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 32180]
[x] Receiving all data
[x] Receiving all data: 208B
[+] Receiving all data: Done (208B)
[*] Closed connection to krusty-katering.ctf.umasscybersec.org port 1337


Which cook should handle this job? [1-10]

Your time: 8h58m50s
You did 17.8% better than Team Chum Bucket.
Good work, come back tomorrow.

You're hired, one could say that you're no UMASS{subst@nd@rd_c00k}9:["$","$L2","pre-2",{"className":"my-2","children":"$10"}]
a:["$","script","script-0",{"src":"/_next/static/chunks/59d5dd52dd9fcb16.js","async":true}]
b:["$","script","script-1",{"src":"/_next/static/chunks/0eb309e820c00a6d.js","async":true}]
c:["$","script","script-2",{"src":"/_next/static/chunks/a6b27ecf1b9e9188.js","async":true}]
d:["$","script","script-3",{"src":"/_next/static/chunks/39b99946d2be6a43.js","async":true}]
e:["$","$L11",null,{"children":["$","$12",null,{"name":"Next.MetadataOutlet","children":"$@13"}]}]
13:null
