<!DOCTYPE html><html class="dark scroll-smooth"><head><meta charSet="utf-8"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="https://gist.github.com/assets/60120929/58a78bb3-8459-4bb1-a0cd-68f1e4491451"/><link rel="stylesheet" href="/_next/static/css/f67679a4dcf042a1.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-50d183473e3f8178.js"/><script src="/_next/static/chunks/4bd1b696-12b3d90ac4ed3802.js" async=""></script><script src="/_next/static/chunks/684-d3c2077e7b7fefb9.js" async=""></script><script src="/_next/static/chunks/main-app-99381da9a4c58049.js" async=""></script><script src="/_next/static/chunks/874-c62c375efd21db20.js" async=""></script><script src="/_next/static/chunks/app/writeups/layout-6eb8da7f54d57912.js" async=""></script><script src="/_next/static/chunks/325-8cc74193b249521f.js" async=""></script><script src="/_next/static/chunks/app/writeups/%5Bid%5D/page-b6fc1eb85fdc5690.js" async=""></script><meta name="next-size-adjust" content=""/><title>kevin.fish</title><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="text-dark dark:text-white dark:bg-midnight" style="font-family:&#x27;Inter&#x27;, &#x27;Inter Fallback&#x27;;font-style:normal"><main class="container pt-20 pb-24"><a class="text-secondary text-sm mb-10 -ml-5 block w-max" href="/">← Back to home</a><div><main class="text-sm [&amp;_h1]:text-5xl [&amp;_h1]:font-semibold [&amp;_h1]:mb-8 [&amp;_blockquote]:text-secondary [&amp;_blockquote]:space-y-3 [&amp;_blockquote]:border-l-4 [&amp;_blockquote]:border-secondary [&amp;_blockquote]:pl-5 [&amp;_blockquote]:mb-5 [&amp;&gt;_p]:my-3 [&amp;_img]:my-5 [&amp;_ul]:list-disc [&amp;_ul]:pl-6 [&amp;&gt;p&gt;code]:bg-black/20 [&amp;&gt;p&gt;code]:text-secondary [&amp;&gt;p&gt;code]:px-2 [&amp;&gt;p&gt;code]:py-1 [&amp;&gt;p&gt;code]:rounded"><h1>UMass CTF 2024 — Krusty Katering</h1>
<blockquote>
<p>Krusty Katering is hemorrhaging money, and Mr. Krabs has brought you in to fix it. You have 10 line cooks, and while they&#x27;re okay at making Krabby patties, they can&#x27;t agree on who cooks what and when. To make matters worse, Squidward (trying to keep his job) refuses to give you the list of orders, and will only tell you them one by one. Each time Squidward tells you a job, you get to add it to a cook&#x27;s schedule for the day. Cooks cannot trade jobs, once it&#x27;s on the schedule, it stays there. You want to ensure the last order finishes as soon as possible so that Mr. Krabs can close and count his profits. The competing Plankton&#x27;s Provisions assigns their jobs randomly. So long as your crew is 20% more efficient than Team Chum Bucket every day this week, you&#x27;re hired. Can you save Mr. Krabs&#x27; business?</p>
<p><code>nc krusty-katering.ctf.umasscybersec.org 1337</code></p>
</blockquote>
<p>We&#x27;re given a terminal prompt that looks like this:</p>
<p><img src="https://gist.github.com/assets/60120929/58a78bb3-8459-4bb1-a0cd-68f1e4491451" alt="image"/></p>
<p>The essence of the problem statement is as follows:</p>
<ul>
<li>We&#x27;re given integers one-by-one to store in one of 10 &quot;buckets&quot; (e.g. you must add an integer to a bucket before receiving another one).</li>
<li>We want to minimize the max value among our buckets.</li>
</ul>
<p>If we can write an algorithm that beats Plankton&#x27;s randomized approach by 10% for 7 days of 1000 orders each, we get the flag.</p>
<p>Because of the one-by-one nature of this problem, at first glance it looks like the most optimal algorithm can&#x27;t do much better than greedy. Writing a script with the simplest greedy algorithm of &quot;store each integer in the lowest-value bucket&quot;,</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (py)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword">import</span><span class=""> re
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">import</span><span class=""> numpy </span><span class="token keyword">as</span><span class=""> np
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class=""></span><span class="token keyword">import</span><span class=""> pwn
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="">conn </span><span class="token operator">=</span><span class=""> pwn</span><span class="token punctuation">.</span><span class="">remote</span><span class="token punctuation">(</span><span class="token string">&#x27;krusty-katering.ctf.umasscybersec.org&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token number">1337</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class=""></span><span class="token keyword">def</span><span class=""> </span><span class="token function">time_match_to_secs</span><span class="token punctuation">(</span><span class="">n</span><span class="token punctuation">:</span><span class=""> </span><span class="token builtin">str</span><span class=""> </span><span class="token operator">|</span><span class=""> </span><span class="token boolean">None</span><span class="token punctuation">,</span><span class=""> t</span><span class="token punctuation">:</span><span class=""> </span><span class="token builtin">str</span><span class=""> </span><span class="token operator">|</span><span class=""> </span><span class="token boolean">None</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class=""> </span><span class="token builtin">int</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="">    </span><span class="token keyword">if</span><span class=""> n </span><span class="token keyword">is</span><span class=""> </span><span class="token boolean">None</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="">        </span><span class="token keyword">return</span><span class=""> </span><span class="token number">0</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">    </span><span class="token keyword">return</span><span class=""> </span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="">n</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">*</span><span class=""> </span><span class="token punctuation">(</span><span class="token number">1</span><span class=""> </span><span class="token keyword">if</span><span class=""> t </span><span class="token operator">==</span><span class=""> </span><span class="token string">&#x27;s&#x27;</span><span class=""> </span><span class="token keyword">else</span><span class=""> </span><span class="token number">60</span><span class=""> </span><span class="token keyword">if</span><span class=""> t </span><span class="token operator">==</span><span class=""> </span><span class="token string">&#x27;m&#x27;</span><span class=""> </span><span class="token keyword">else</span><span class=""> </span><span class="token number">3600</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class=""></span><span class="token keyword">def</span><span class=""> </span><span class="token function">time_str_to_secs</span><span class="token punctuation">(</span><span class="">s</span><span class="token punctuation">:</span><span class=""> </span><span class="token builtin">str</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class=""> </span><span class="token builtin">int</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">    groups </span><span class="token operator">=</span><span class=""> re</span><span class="token punctuation">.</span><span class="">search</span><span class="token punctuation">(</span><span class="token string">r&#x27;(\d+)([hms])(?:(\d+)([hms]))?(?:(\d+)([hms]))?&#x27;</span><span class="token punctuation">,</span><span class=""> s</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">    </span><span class="token keyword">return</span><span class=""> </span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="">time_match_to_secs</span><span class="token punctuation">(</span><span class="">groups</span><span class="token punctuation">[</span><span class="">i</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class=""> groups</span><span class="token punctuation">[</span><span class="">i </span><span class="token operator">+</span><span class=""> </span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class=""> </span><span class="token keyword">for</span><span class=""> i </span><span class="token keyword">in</span><span class=""> </span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class=""> </span><span class="token number">6</span><span class="token punctuation">,</span><span class=""> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">allotted </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class=""> </span><span class="token operator">*</span><span class=""> </span><span class="token number">10</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class=""></span><span class="token keyword">try</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">    </span><span class="token keyword">for</span><span class=""> i </span><span class="token keyword">in</span><span class=""> </span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">        conn</span><span class="token punctuation">.</span><span class="">recvuntil</span><span class="token punctuation">(</span><span class="token string-interpolation string">f&#x27;Day </span><span class="token string-interpolation interpolation punctuation">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number">1</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">. Time to beat: &#x27;</span><span class="token punctuation">.</span><span class="">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">        </span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation string">f&#x27;Time to beat for day </span><span class="token string-interpolation interpolation punctuation">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number">1</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">:&#x27;</span><span class="token punctuation">,</span><span class=""> time_str_to_secs</span><span class="token punctuation">(</span><span class="">conn</span><span class="token punctuation">.</span><span class="">recvline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">rstrip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="">        </span><span class="token keyword">for</span><span class=""> _ </span><span class="token keyword">in</span><span class=""> </span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">            conn</span><span class="token punctuation">.</span><span class="">recvuntil</span><span class="token punctuation">(</span><span class="token string">b&#x27;Order &#x27;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="">            </span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="">conn</span><span class="token punctuation">.</span><span class="">recvline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">rstrip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> allotted</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="">            conn</span><span class="token punctuation">.</span><span class="">recvuntil</span><span class="token punctuation">(</span><span class="token string">&#x27;└── Estimated time to cook: &#x27;</span><span class="token punctuation">.</span><span class="">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class="">            time_raw </span><span class="token operator">=</span><span class=""> conn</span><span class="token punctuation">.</span><span class="">recvline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">rstrip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="">            ts </span><span class="token operator">=</span><span class=""> time_str_to_secs</span><span class="token punctuation">(</span><span class="">time_raw</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">36</span><span class="">            min_index </span><span class="token operator">=</span><span class=""> np</span><span class="token punctuation">.</span><span class="">argmin</span><span class="token punctuation">(</span><span class="">allotted</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class="">            allotted</span><span class="token punctuation">[</span><span class="">min_index</span><span class="token punctuation">]</span><span class=""> </span><span class="token operator">+=</span><span class=""> ts
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">38</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">39</span><span class="">            conn</span><span class="token punctuation">.</span><span class="">sendline</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="">min_index </span><span class="token operator">+</span><span class=""> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">40</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">41</span><span class="">        allotted </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class=""> </span><span class="token operator">*</span><span class=""> </span><span class="token number">10</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class=""></span><span class="token keyword">except</span><span class=""> EOFError</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">43</span><span class="">    </span><span class="token keyword">pass</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">44</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">45</span><span class=""></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="">conn</span><span class="token punctuation">.</span><span class="">recvall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></div>
<p>But this script is a bit inconsistent. If we&#x27;re being lazy, however, because of the random nature of the problem running this a few times will eventually get us the flag.</p>
<p>We can also optimize the algorithm a little bit by, for each integer:</p>
<ol>
<li>If there exists a bucket that you can add this integer to that does not change the maximum bucket value, add it to the largest bucket that satisfies that.</li>
<li>Otherwise, revert to the previous greedy algorithm and add the integer to the lowest-value bucket.</li>
</ol>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- --> (py)<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="token keyword">import</span><span class=""> re
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class=""></span><span class="token keyword">import</span><span class=""> numpy </span><span class="token keyword">as</span><span class=""> np
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class=""></span><span class="token keyword">import</span><span class=""> pwn
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="">conn </span><span class="token operator">=</span><span class=""> pwn</span><span class="token punctuation">.</span><span class="">remote</span><span class="token punctuation">(</span><span class="token string">&#x27;krusty-katering.ctf.umasscybersec.org&#x27;</span><span class="token punctuation">,</span><span class=""> </span><span class="token number">1337</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class=""></span><span class="token keyword">def</span><span class=""> </span><span class="token function">time_match_to_secs</span><span class="token punctuation">(</span><span class="">n</span><span class="token punctuation">:</span><span class=""> </span><span class="token builtin">str</span><span class=""> </span><span class="token operator">|</span><span class=""> </span><span class="token boolean">None</span><span class="token punctuation">,</span><span class=""> t</span><span class="token punctuation">:</span><span class=""> </span><span class="token builtin">str</span><span class=""> </span><span class="token operator">|</span><span class=""> </span><span class="token boolean">None</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class=""> </span><span class="token builtin">int</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="">    </span><span class="token keyword">if</span><span class=""> n </span><span class="token keyword">is</span><span class=""> </span><span class="token boolean">None</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="">        </span><span class="token keyword">return</span><span class=""> </span><span class="token number">0</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="">    </span><span class="token keyword">return</span><span class=""> </span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="">n</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">*</span><span class=""> </span><span class="token punctuation">(</span><span class="token number">1</span><span class=""> </span><span class="token keyword">if</span><span class=""> t </span><span class="token operator">==</span><span class=""> </span><span class="token string">&#x27;s&#x27;</span><span class=""> </span><span class="token keyword">else</span><span class=""> </span><span class="token number">60</span><span class=""> </span><span class="token keyword">if</span><span class=""> t </span><span class="token operator">==</span><span class=""> </span><span class="token string">&#x27;m&#x27;</span><span class=""> </span><span class="token keyword">else</span><span class=""> </span><span class="token number">3600</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class=""></span><span class="token keyword">def</span><span class=""> </span><span class="token function">time_str_to_secs</span><span class="token punctuation">(</span><span class="">s</span><span class="token punctuation">:</span><span class=""> </span><span class="token builtin">str</span><span class="token punctuation">)</span><span class=""> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class=""> </span><span class="token builtin">int</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="">    groups </span><span class="token operator">=</span><span class=""> re</span><span class="token punctuation">.</span><span class="">search</span><span class="token punctuation">(</span><span class="token string">r&#x27;(\d+)([hms])(?:(\d+)([hms]))?(?:(\d+)([hms]))?&#x27;</span><span class="token punctuation">,</span><span class=""> s</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="">    </span><span class="token keyword">return</span><span class=""> </span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="">time_match_to_secs</span><span class="token punctuation">(</span><span class="">groups</span><span class="token punctuation">[</span><span class="">i</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class=""> groups</span><span class="token punctuation">[</span><span class="">i </span><span class="token operator">+</span><span class=""> </span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class=""> </span><span class="token keyword">for</span><span class=""> i </span><span class="token keyword">in</span><span class=""> </span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class=""> </span><span class="token number">6</span><span class="token punctuation">,</span><span class=""> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="">allotted </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class=""> </span><span class="token operator">*</span><span class=""> </span><span class="token number">10</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span class=""></span><span class="token keyword">try</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span class="">    </span><span class="token keyword">for</span><span class=""> i </span><span class="token keyword">in</span><span class=""> </span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span class="">        conn</span><span class="token punctuation">.</span><span class="">recvuntil</span><span class="token punctuation">(</span><span class="token string-interpolation string">f&#x27;Day </span><span class="token string-interpolation interpolation punctuation">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number">1</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">. Time to beat: &#x27;</span><span class="token punctuation">.</span><span class="">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span class="">        </span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation string">f&#x27;Time to beat for day </span><span class="token string-interpolation interpolation punctuation">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number">1</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">:&#x27;</span><span class="token punctuation">,</span><span class=""> time_str_to_secs</span><span class="token punctuation">(</span><span class="">conn</span><span class="token punctuation">.</span><span class="">recvline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">rstrip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span class="">        </span><span class="token keyword">for</span><span class=""> _ </span><span class="token keyword">in</span><span class=""> </span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span class="">            conn</span><span class="token punctuation">.</span><span class="">recvuntil</span><span class="token punctuation">(</span><span class="token string">b&#x27;Order &#x27;</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span><span class="">            </span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="">conn</span><span class="token punctuation">.</span><span class="">recvline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">rstrip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class=""> allotted</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span class="">            conn</span><span class="token punctuation">.</span><span class="">recvuntil</span><span class="token punctuation">(</span><span class="token string">&#x27;└── Estimated time to cook: &#x27;</span><span class="token punctuation">.</span><span class="">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span><span class="">            time_raw </span><span class="token operator">=</span><span class=""> conn</span><span class="token punctuation">.</span><span class="">recvline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">rstrip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span><span class="">            ts </span><span class="token operator">=</span><span class=""> time_str_to_secs</span><span class="token punctuation">(</span><span class="">time_raw</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">36</span><span class="">            </span><span class="token comment"># Semi-greedy algorithm: for some input x, for all buckets find the maximum one that when you add x to it</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">37</span><span class="">            </span><span class="token comment"># does not change the current answer. If there are none, add to the minimum one, i.e. greedy.</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">38</span><span class="">            max_bucket </span><span class="token operator">=</span><span class=""> np</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="">allotted</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">39</span><span class="">            </span><span class="token keyword">for</span><span class=""> j </span><span class="token keyword">in</span><span class=""> </span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">40</span><span class="">                </span><span class="token keyword">if</span><span class=""> allotted</span><span class="token punctuation">[</span><span class="">j</span><span class="token punctuation">]</span><span class=""> </span><span class="token operator">+</span><span class=""> ts </span><span class="token operator">&lt;=</span><span class=""> max_bucket</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">41</span><span class="">                    min_index </span><span class="token operator">=</span><span class=""> j
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">42</span><span class="">                    </span><span class="token keyword">break</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">43</span><span class="">            </span><span class="token keyword">else</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">44</span><span class="">                min_index </span><span class="token operator">=</span><span class=""> np</span><span class="token punctuation">.</span><span class="">argmin</span><span class="token punctuation">(</span><span class="">allotted</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">45</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">46</span><span class="">            allotted</span><span class="token punctuation">[</span><span class="">min_index</span><span class="token punctuation">]</span><span class=""> </span><span class="token operator">+=</span><span class=""> ts
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">47</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">48</span><span class="">            conn</span><span class="token punctuation">.</span><span class="">sendline</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="">min_index </span><span class="token operator">+</span><span class=""> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">49</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">50</span><span class="">        allotted </span><span class="token operator">=</span><span class=""> </span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class=""> </span><span class="token operator">*</span><span class=""> </span><span class="token number">10</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">51</span><span class=""></span><span class="token keyword">except</span><span class=""> EOFError</span><span class="token punctuation">:</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">52</span><span class="">    </span><span class="token keyword">pass</span><span class="">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">53</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">54</span><span class=""></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="">conn</span><span class="token punctuation">.</span><span class="">recvall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></div>
<p>While there are still cases where this fails, this algorithm is more consistent than the aforementioned greedy approach and reliably gets the flag:</p>
<div class="my-4"><p class="text-xs bg-black/10 rounded-t-lg px-4 py-0.5 text-secondary">Code<!-- -->:<!-- --> <button class="hover:underline">(copy)</button></p><div class="rounded-b-lg overflow-hidden text-xs"><pre class="prismjs"><code style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="">...
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span>#987: Banana [31430, 31700, 31260, 31215, 31230, 31420, 31450, 31440, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span>#988: Holographic Meatloaf [31445, 31700, 31260, 31215, 31230, 31420, 31450, 31440, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span>#989: Holographic Meatloaf [31445, 31700, 31260, 31765, 31230, 31420, 31450, 31440, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span>#990: Pretty Patty Combo [31445, 31700, 31260, 31765, 31780, 31420, 31450, 31440, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span>#991: Krabby Fries [31445, 31700, 31780, 31765, 31780, 31420, 31450, 31440, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span>#992: SpongeBob&#x27;s Sundae [31445, 31700, 31780, 31765, 31780, 31870, 31450, 31440, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span>#993: Fried Oyster Skins [31815, 31700, 31780, 31765, 31780, 31870, 31450, 31440, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span>#994: Krabby Fries [31815, 31820, 31780, 31765, 31780, 31870, 31450, 31440, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span>#995: SpongeBob&#x27;s Sundae [31815, 31820, 31780, 31765, 31780, 31870, 31450, 31890, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span>#996: Bran Flakes [31815, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span>#997: Banana [31845, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span>#998: Banana [31860, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span>#999: Holographic Meatloaf [31875, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span>#1000: Aged Patty [31875, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 32180]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span>[x] Receiving all data
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">17</span>[x] Receiving all data: 208B
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">18</span>[+] Receiving all data: Done (208B)
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">19</span>[*] Closed connection to krusty-katering.ctf.umasscybersec.org port 1337
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">20</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">21</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">22</span>Which cook should handle this job? [1-10]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">23</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">24</span>Your time: 8h58m50s
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">25</span>You did 17.8% better than Team Chum Bucket.
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">26</span>Good work, come back tomorrow.
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">27</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">28</span>You&#x27;re hired, one could say that you&#x27;re no UMASS{subst@nd@rd_c00k}</code></pre></div></div></main></div><!--$--><!--/$--><!--$--><!--/$--></main><script src="/_next/static/chunks/webpack-50d183473e3f8178.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[87555,[],\"\"]\n3:I[31295,[],\"\"]\n4:I[6874,[\"874\",\"static/chunks/874-c62c375efd21db20.js\",\"319\",\"static/chunks/app/writeups/layout-6eb8da7f54d57912.js\"],\"\"]\n6:I[59665,[],\"MetadataBoundary\"]\n8:I[59665,[],\"OutletBoundary\"]\nb:I[74911,[],\"AsyncMetadataOutlet\"]\nd:I[59665,[],\"ViewportBoundary\"]\nf:I[26614,[],\"\"]\n:HL[\"/_next/static/media/a34f9d1faa5f3315-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/f67679a4dcf042a1.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"LXc6w6ftcfUymS_FwiDab\",\"p\":\"\",\"c\":[\"\",\"writeups\",\"fd0ed1fb606c13ba6d686bcf07e6809d\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"writeups\",{\"children\":[[\"id\",\"fd0ed1fb606c13ba6d686bcf07e6809d\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f67679a4dcf042a1.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"className\":\"dark scroll-smooth\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}]}],[\"$\",\"body\",null,{\"className\":\"text-dark dark:text-white dark:bg-midnight\",\"style\":{\"fontFamily\":\"'Inter', 'Inter Fallback'\",\"fontStyle\":\"normal\"},\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"h-screen flex items-center justify-center\",\"children\":[\"$\",\"main\",null,{\"className\":\"relative pl-14\",\"children\":[[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"absolute left-0 top-2 text-5xl text-grapefruit\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M256 48C140.559 48 48 140.559 48 256c0 115.436 92.559 208 208 208 115.435 0 208-92.564 208-208 0-115.441-92.564-208-208-208zm104.002 282.881l-29.12 29.117L256 285.117l-74.881 74.881-29.121-29.117L226.881 256l-74.883-74.881 29.121-29.116L256 226.881l74.881-74.878 29.12 29.116L285.119 256l74.883 74.881z\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":\"1em\",\"width\":\"1em\",\"xmlns\":\"http://www.w3.org/2000/svg\"}],[\"$\",\"h1\",null,{\"className\":\"font-bold text-7xl underline decoration-grapefruit mb-5\",\"children\":\"404.\"}],[\"$\",\"p\",null,{\"children\":\"Your requested page was not found.\"}],[\"$\",\"$L4\",null,{\"href\":\"/\",\"className\":\"font-medium text-inherit\",\"children\":\"Return to home →\"}]]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[\"writeups\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"main\",null,{\"className\":\"container pt-20 pb-24\",\"children\":[[\"$\",\"$L4\",null,{\"href\":\"/\",\"className\":\"text-secondary text-sm mb-10 -ml-5 block w-max\",\"children\":\"← Back to home\"}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]]}],{\"children\":[[\"id\",\"fd0ed1fb606c13ba6d686bcf07e6809d\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",[\"$\",\"$L6\",null,{\"children\":\"$L7\"}],null,[\"$\",\"$L8\",null,{\"children\":[\"$L9\",\"$La\",[\"$\",\"$Lb\",null,{\"promise\":\"$@c\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"TG_Yol2VYZMAqdmJP2CMS\",{\"children\":[[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:\"$Sreact.suspense\"\n11:I[74911,[],\"AsyncMetadata\"]\n7:[\"$\",\"$10\",null,{\"fallback\":null,\"children\":[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]}]\n"])</script><script>self.__next_f.push([1,"a:null\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n9:null\n"])</script><script>self.__next_f.push([1,"12:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"kevin.fish\"}]],\"error\":null,\"digest\":\"$undefined\"}\nc:{\"metadata\":\"$12:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"13:I[50674,[\"325\",\"static/chunks/325-8cc74193b249521f.js\",\"134\",\"static/chunks/app/writeups/%5Bid%5D/page-b6fc1eb85fdc5690.js\"],\"default\"]\n14:T4cf,import re\n\nimport numpy as np\nimport pwn\n\nconn = pwn.remote('krusty-katering.ctf.umasscybersec.org', 1337)\n\n\ndef time_match_to_secs(n: str | None, t: str | None) -\u003e int:\n    if n is None:\n        return 0\n    return int(n) * (1 if t == 's' else 60 if t == 'm' else 3600)\n\n\ndef time_str_to_secs(s: str) -\u003e int:\n    groups = re.search(r'(\\d+)([hms])(?:(\\d+)([hms]))?(?:(\\d+)([hms]))?', s).groups()\n    return sum(time_match_to_secs(groups[i], groups[i + 1]) for i in range(0, 6, 2))\n\n\nallotted = [0] * 10\n\ntry:\n    for i in range(7):\n        conn.recvuntil(f'Day {i + 1}. Time to beat: '.encode())\n        print(f'Time to beat for day {i + 1}:', time_str_to_secs(conn.recvline().decode().rstrip()))\n\n        for _ in range(1000):\n            conn.recvuntil(b'Order ')\n            print(conn.recvline().decode().rstrip(), allotted)\n\n            conn.recvuntil('└── Estimated time to cook: '.encode())\n\n            time_raw = conn.recvline().decode().rstrip()\n            ts = time_str_to_secs(time_raw)\n\n            min_index = np.argmin(allotted)\n            allotted[min_index] += ts\n\n            conn.sendline(str(min_index + 1).encode())\n\n        allotted = [0] * 10\nexcept EOFError:\n    pass\n\nprint(conn.recvall().decode())15:T67f,import re\n\nimport numpy as np\nimport pwn\n\nconn = pwn.remote('krusty-katering.ctf.umasscybersec.org', 1337)\n\n\ndef time_match_to_secs(n: str | None, t: str | None) -\u003e int:\n    if n is None:\n        return 0\n    return int(n) * (1 if t == 's' else 60 if t == 'm' else 3600)\n\n\ndef time_str_to_secs(s: str) -\u003e int:\n    groups = re.search(r'(\\d+)([hms])(?:(\\d+)([hms]))?(?:(\\d+)([hms]))?', s).groups()\n    return sum(time_match_to_secs(groups[i], groups[i + 1]) for i in range(0, 6, 2))\n\n\nallotted = [0] * 10\n\ntry:\n    for i in range(7):\n        conn.recvuntil(f'Day {i + 1}. Time to beat: '.encode())\n        print(f'Time to beat for day {i + 1}:', time_str_to_secs(c"])</script><script>self.__next_f.push([1,"onn.recvline().decode().rstrip()))\n\n        for _ in range(1000):\n            conn.recvuntil(b'Order ')\n            print(conn.recvline().decode().rstrip(), allotted)\n\n            conn.recvuntil('└── Estimated time to cook: '.encode())\n\n            time_raw = conn.recvline().decode().rstrip()\n            ts = time_str_to_secs(time_raw)\n\n            # Semi-greedy algorithm: for some input x, for all buckets find the maximum one that when you add x to it\n            # does not change the current answer. If there are none, add to the minimum one, i.e. greedy.\n            max_bucket = np.max(allotted)\n            for j in range(10):\n                if allotted[j] + ts \u003c= max_bucket:\n                    min_index = j\n                    break\n            else:\n                min_index = np.argmin(allotted)\n\n            allotted[min_index] += ts\n\n            conn.sendline(str(min_index + 1).encode())\n\n        allotted = [0] * 10\nexcept EOFError:\n    pass\n\nprint(conn.recvall().decode())16:T67c,...\n#987: Banana [31430, 31700, 31260, 31215, 31230, 31420, 31450, 31440, 31730, 31630]\n#988: Holographic Meatloaf [31445, 31700, 31260, 31215, 31230, 31420, 31450, 31440, 31730, 31630]\n#989: Holographic Meatloaf [31445, 31700, 31260, 31765, 31230, 31420, 31450, 31440, 31730, 31630]\n#990: Pretty Patty Combo [31445, 31700, 31260, 31765, 31780, 31420, 31450, 31440, 31730, 31630]\n#991: Krabby Fries [31445, 31700, 31780, 31765, 31780, 31420, 31450, 31440, 31730, 31630]\n#992: SpongeBob's Sundae [31445, 31700, 31780, 31765, 31780, 31870, 31450, 31440, 31730, 31630]\n#993: Fried Oyster Skins [31815, 31700, 31780, 31765, 31780, 31870, 31450, 31440, 31730, 31630]\n#994: Krabby Fries [31815, 31820, 31780, 31765, 31780, 31870, 31450, 31440, 31730, 31630]\n#995: SpongeBob's Sundae [31815, 31820, 31780, 31765, 31780, 31870, 31450, 31890, 31730, 31630]\n#996: Bran Flakes [31815, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]\n#997: Banana [31845, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]\n#998: Banana [3186"])</script><script>self.__next_f.push([1,"0, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]\n#999: Holographic Meatloaf [31875, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 31630]\n#1000: Aged Patty [31875, 31820, 31780, 31765, 31780, 31870, 31820, 31890, 31730, 32180]\n[x] Receiving all data\n[x] Receiving all data: 208B\n[+] Receiving all data: Done (208B)\n[*] Closed connection to krusty-katering.ctf.umasscybersec.org port 1337\n\n\nWhich cook should handle this job? [1-10]\n\nYour time: 8h58m50s\nYou did 17.8% better than Team Chum Bucket.\nGood work, come back tomorrow.\n\nYou're hired, one could say that you're no UMASS{subst@nd@rd_c00k}"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"children\":[\"$\",\"main\",null,{\"className\":\"text-sm [\u0026_h1]:text-5xl [\u0026_h1]:font-semibold [\u0026_h1]:mb-8 [\u0026_blockquote]:text-secondary [\u0026_blockquote]:space-y-3 [\u0026_blockquote]:border-l-4 [\u0026_blockquote]:border-secondary [\u0026_blockquote]:pl-5 [\u0026_blockquote]:mb-5 [\u0026\u003e_p]:my-3 [\u0026_img]:my-5 [\u0026_ul]:list-disc [\u0026_ul]:pl-6 [\u0026\u003ep\u003ecode]:bg-black/20 [\u0026\u003ep\u003ecode]:text-secondary [\u0026\u003ep\u003ecode]:px-2 [\u0026\u003ep\u003ecode]:py-1 [\u0026\u003ep\u003ecode]:rounded\",\"children\":[[\"$\",\"h1\",\"h1-0\",{\"children\":\"UMass CTF 2024 — Krusty Katering\"}],\"\\n\",[\"$\",\"blockquote\",\"blockquote-0\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"Krusty Katering is hemorrhaging money, and Mr. Krabs has brought you in to fix it. You have 10 line cooks, and while they're okay at making Krabby patties, they can't agree on who cooks what and when. To make matters worse, Squidward (trying to keep his job) refuses to give you the list of orders, and will only tell you them one by one. Each time Squidward tells you a job, you get to add it to a cook's schedule for the day. Cooks cannot trade jobs, once it's on the schedule, it stays there. You want to ensure the last order finishes as soon as possible so that Mr. Krabs can close and count his profits. The competing Plankton's Provisions assigns their jobs randomly. So long as your crew is 20% more efficient than Team Chum Bucket every day this week, you're hired. Can you save Mr. Krabs' business?\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"nc krusty-katering.ctf.umasscybersec.org 1337\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"We're given a terminal prompt that looks like this:\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"https://gist.github.com/assets/60120929/58a78bb3-8459-4bb1-a0cd-68f1e4491451\",\"alt\":\"image\"}]}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":\"The essence of the problem statement is as follows:\"}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"We're given integers one-by-one to store in one of 10 \\\"buckets\\\" (e.g. you must add an integer to a bucket before receiving another one).\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"We want to minimize the max value among our buckets.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":\"If we can write an algorithm that beats Plankton's randomized approach by 10% for 7 days of 1000 orders each, we get the flag.\"}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":\"Because of the one-by-one nature of this problem, at first glance it looks like the most optimal algorithm can't do much better than greedy. Writing a script with the simplest greedy algorithm of \\\"store each integer in the lowest-value bucket\\\",\"}],\"\\n\",[\"$\",\"$L13\",\"pre-0\",{\"className\":\"my-4\",\"children\":\"$14\",\"language\":\"py\"}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":\"But this script is a bit inconsistent. If we're being lazy, however, because of the random nature of the problem running this a few times will eventually get us the flag.\"}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":\"We can also optimize the algorithm a little bit by, for each integer:\"}],\"\\n\",[\"$\",\"ol\",\"ol-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"If there exists a bucket that you can add this integer to that does not change the maximum bucket value, add it to the largest bucket that satisfies that.\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"Otherwise, revert to the previous greedy algorithm and add the integer to the lowest-value bucket.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"$L13\",\"pre-1\",{\"className\":\"my-4\",\"children\":\"$15\",\"language\":\"py\"}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":\"While there are still cases where this fails, this algorithm is more consistent than the aforementioned greedy approach and reliably gets the flag:\"}],\"\\n\",[\"$\",\"$L13\",\"pre-2\",{\"className\":\"my-4\",\"children\":\"$16\",\"language\":\"$undefined\"}]]}]}]\n"])</script></body></html>