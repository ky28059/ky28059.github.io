1:"$Sreact.fragment"
2:I[87555,[],""]
3:I[31295,[],""]
4:I[6874,["874","static/chunks/874-c62c375efd21db20.js","319","static/chunks/app/writeups/layout-0d6432ad4376bd82.js"],""]
6:I[59665,[],"MetadataBoundary"]
8:I[59665,[],"OutletBoundary"]
b:I[74911,[],"AsyncMetadataOutlet"]
d:I[59665,[],"ViewportBoundary"]
f:I[26614,[],""]
:HL["/_next/static/media/e4af272ccee01ff0-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/cd9eb1f13d7f01c4.css","style"]
0:{"P":null,"b":"szKQotZwTHi_mCbYcI59p","p":"","c":["","writeups","e7fed465703f2943e482cd2d6618ceb4"],"i":false,"f":[[["",{"children":["writeups",{"children":[["id","e7fed465703f2943e482cd2d6618ceb4","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/cd9eb1f13d7f01c4.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"className":"dark scroll-smooth","children":[["$","head",null,{"children":["$","meta",null,{"charSet":"utf-8"}]}],["$","body",null,{"className":"text-dark dark:text-white dark:bg-midnight","style":{"fontFamily":"'Inter', 'Inter Fallback'","fontStyle":"normal"},"children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","div",null,{"className":"h-screen flex items-center justify-center","children":["$","main",null,{"className":"relative pl-14","children":[["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"absolute left-0 top-2 text-5xl text-grapefruit","children":["$undefined",[["$","path","0",{"d":"M256 48C140.559 48 48 140.559 48 256c0 115.436 92.559 208 208 208 115.435 0 208-92.564 208-208 0-115.441-92.564-208-208-208zm104.002 282.881l-29.12 29.117L256 285.117l-74.881 74.881-29.121-29.117L226.881 256l-74.883-74.881 29.121-29.116L256 226.881l74.881-74.878 29.12 29.116L285.119 256l74.883 74.881z","children":"$undefined"}]]],"style":{"color":"$undefined"},"height":"1em","width":"1em","xmlns":"http://www.w3.org/2000/svg"}],["$","h1",null,{"className":"font-bold text-7xl underline decoration-grapefruit mb-5","children":"404."}],["$","p",null,{"children":"Your requested page was not found."}],["$","$L4",null,{"href":"/","className":"font-medium text-inherit","children":"Return to home →"}]]}]}],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]]}],{"children":["writeups",["$","$1","c",{"children":[null,["$","main",null,{"className":"container pt-20 pb-24","children":[["$","$L4",null,{"href":"/","className":"text-secondary text-sm mb-10 -ml-5 block w-max","children":"← Back to home"}],["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}]]}],{"children":[["id","e7fed465703f2943e482cd2d6618ceb4","d"],["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",["$","$L6",null,{"children":"$L7"}],null,["$","$L8",null,{"children":["$L9","$La",["$","$Lb",null,{"promise":"$@c"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","OQlChqFVBuXTckyr2q9bA",{"children":[["$","$Ld",null,{"children":"$Le"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}],null]}],false]],"m":"$undefined","G":["$f","$undefined"],"s":false,"S":true}
10:"$Sreact.suspense"
11:I[74911,[],"AsyncMetadata"]
7:["$","$10",null,{"fallback":null,"children":["$","$L11",null,{"promise":"$@12"}]}]
a:null
e:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
9:null
12:{"metadata":[["$","title","0",{"children":"kevin.fish"}]],"error":null,"digest":"$undefined"}
c:{"metadata":"$12:metadata","error":null,"digest":"$undefined"}
13:I[50674,["325","static/chunks/325-8cc74193b249521f.js","134","static/chunks/app/writeups/%5Bid%5D/page-d2275216898ea7fa.js"],"default"]
14:T489,import cv2
import numpy as np

import matplotlib
import matplotlib.pyplot as plt

matplotlib.use('tkagg')

use_cv2_hist = False


def make_histogram(img: np.ndarray, title: str, n: int, lim: int = 256):
    dims = len(img.shape)
    channel = n - 1 if dims == 3 else 0

    if n != -1:
        plt.subplot(3, 1, n)

    if use_cv2_hist:
        plt.plot(cv2.calcHist([img], [channel], None, [lim], [0, lim]))
    else:
        data = img[:, :, channel].ravel() if dims == 3 else img.ravel()
        plt.hist(data, bins=256, range=(0, 255))

    plt.ylabel('Occurrences')
    plt.xlim([0, lim])
    plt.title(title)


def show_img(img: np.ndarray):
    make_histogram(img, "Reds", 1)
    make_histogram(img, "Greens", 2)
    make_histogram(img, "Blues", 3)
    plt.show()

    img2 = cv2.cvtColor(img, cv2.COLOR_RGB2HSV)

    make_histogram(img2, "Hues", 1, lim=180)
    make_histogram(img2, "Saturations", 2)
    make_histogram(img2, "Values", 3)
    plt.show()

    img3 = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)

    make_histogram(img3, "Intensities", -1)
    plt.show()


img = cv2.imread('invite.bmp')
img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
show_img(img)5:["$","div",null,{"children":["$","main",null,{"className":"max-w-5xl mx-auto text-sm [&_h1]:text-5xl [&_h1]:font-semibold [&_h1]:mb-8 [&_blockquote]:text-secondary [&_blockquote]:space-y-3 [&_blockquote]:border-l-4 [&_blockquote]:border-secondary [&_blockquote]:pl-5 [&_blockquote]:mb-5 [&>_p]:my-3 [&_img]:my-5 [&_ul]:list-disc [&_ul]:pl-6 [&_img]:rounded [&_li]:my-2","children":[["$","h1","h1-0",{"children":"iCTF 2023 — IslandParty"}],"\n",["$","blockquote","blockquote-0",{"children":["\n",["$","p","p-0",{"children":"You open your mailbox and find a strange postcard (invite.bmp). Flipping it around, you squint your eyes and try to decipher the wobbly handwriting:"}],"\n",["$","p","p-1",{"children":"..."}],"\n",["$","p","p-2",{"children":"MYSTERIOUS INVITE: 'Generative AI is all the rage this days, so I couldn't pass up the opportunity to use it for this year's invite. Have you heard models like Google's Imagen will include a hidden watermark on AI generated images? I might not have algorithms quite as fancy as Google's, but I've also encoded a little something into this invite--the address! Decode it, and you'll be more than welcome to attend.'"}],"\n",["$","p","p-3",{"children":"..."}],"\n",["$","p","p-4",{"children":"MYSTERIOUS INVITE: 'One last piece of advice. All great thing come in three. Three sides to a triangle, three wise monkeys, three lights in a stoplight. Let the number three guide you, and you shall find my island.'"}],"\n"]}],"\n",["$","p","p-0",{"children":"We're given the following image, within which is encoded data about the flag:"}],"\n","<p align=\"center\">\n  <img src=\"https://gist.github.com/assets/60120929/498dea08-696d-4f31-ad8c-387738aec7f4\" width=\"600px\">\n</p>","\n",["$","h6","h6-0",{"children":["(the above image has been converted from a ",["$","code","code-0",{"className":"text-primary bg-black/20 rounded p-1","children":".bmp"}]," to a ",["$","code","code-1",{"className":"text-primary bg-black/20 rounded p-1","children":".jpg"}]," for GitHub, and likely won't work with the rest of this writeup)"]}],"\n",["$","p","p-1",{"children":"Examining the histograms for this image yield some interesting results:"}],"\n",["$","$L13","pre-0",{"className":"my-4","children":"$14","language":"py"}],"\n",["$","p","p-2",{"children":[["$","img","img-0",{"src":"https://gist.github.com/assets/60120929/822f3710-b8c1-4986-900f-14902caca46b","alt":"Figure_d3"}],"\n",["$","img","img-1",{"src":"https://gist.github.com/assets/60120929/e4abd511-7cbc-4ed3-ada8-e7b529276d2e","alt":"Figure_d2"}]]}],"\n",["$","p","p-3",{"children":["A clue is that the invite image features the ",["$","a","a-0",{"href":"https://en.m.wikipedia.org/wiki/File:DALL-E_2_Signature.svg","children":"DALL-E 2 signature"}],", telling us what\nit was generated with. Going to the ",["$","a","a-1",{"href":"https://labs.openai.com/","children":"DALL-E 2 website"}]," (you'll need to sign in) and scrolling down the list of examples,\nwe find the original \"otter with pearl earring\" image:"]}],"\n","<img width=\"1248\" alt=\"image (11)\" src=\"https://gist.github.com/assets/60120929/43a907d7-a646-41df-8261-37797dd67963\">","\n","<p align=\"center\">\n  <img src=\"https://gist.github.com/assets/60120929/3476550b-1706-404f-b3f4-a22c015c7ae4\" width=\"600px\">\n</p>","\n",["$","h6","h6-1",{"children":["(the above image has been converted from a ",["$","code","code-0",{"className":"text-primary bg-black/20 rounded p-1","children":".webp"}]," to a ",["$","code","code-1",{"className":"text-primary bg-black/20 rounded p-1","children":".jpg"}]," for GitHub, and might not work with the rest of this writeup)"]}],"\n",["$","p","p-4",{"children":"Now that we have the original, we can compare its histograms to those of our invite; notice how the semi-periodic dips in RGB are gone."}],"\n",["$","p","p-5",{"children":["$","img","img-0",{"src":"https://gist.github.com/assets/60120929/94c2c5a6-439d-46ad-9ab3-9397945cac53","alt":"Figure_g"}]}],"\n",["$","p","p-6",{"children":"This hints that we should taking the diff between the two images. Doing so yields this vibrant mess:"}],"\n",["$","$L13","pre-1",{"className":"my-4","children":"img = cv2.imread('original.webp')\n# img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)\n# show_img(img)\n\nimg2 = cv2.imread('invite.bmp')\n# img2 = cv2.cvtColor(img2, cv2.COLOR_BGR2RGB)\n# show_img(img2)\n\ndiff = img2 - img\ncv2.imwrite('invite_diff.jpg', diff)\n# show_img(diff)","language":"py"}],"\n",["$","p","p-7",{"children":["$","img","img-0",{"src":"https://gist.github.com/assets/60120929/e3ca9bf1-50e2-4746-8e01-7c5e1af23d35","alt":"invite_diff"}]}],"\n",["$","h6","h6-2",{"children":"(can you make out some digits already? :eyes:)"}],"\n",["$","p","p-8",{"children":"The challenge description mentioned groups of 3, which might just be related to the 3 channels of a color image.\nSplitting this diff into its R, G, and B channels gives"}],"\n","<p align=\"center\">\n  <img src=\"https://gist.github.com/assets/60120929/49b0a335-2e33-47ac-aad2-b7a529afa24d\" width=\"290px\"> <img src=\"https://gist.github.com/assets/60120929/8d0bbb81-fdb4-4863-9e90-7e7d52603301\" width=\"290px\"> <img src=\"https://gist.github.com/assets/60120929/1520c457-59a6-4215-95de-5965778692a0\" width=\"290px\">\n</p>","\n",["$","p","p-9",{"children":"and summing these channels with overflow results in the following:"}],"\n",["$","p","p-10",{"children":["$","img","img-0",{"src":"https://gist.github.com/assets/60120929/67a294ce-2880-41e7-a270-30c04085bd70","alt":"invite_diff_combined"}]}],"\n",["$","p","p-11",{"children":"From here, the encoded pattern becomes slightly more discernable. You can make use of the fact that the pattern seems to repeat every\n2 rows and columns to disambiguate noisy characters. Inspecting this pattern carefully gives the coordinates of the island:"}],"\n",["$","$L13","pre-2",{"className":"my-4","children":"22.441N\n74.220W","language":"$undefined"}],"\n","<img width=\"1083\" alt=\"image\" src=\"https://gist.github.com/assets/60120929/2104ef6f-6b84-468a-8f47-7c87a0cdba2b\">"]}]}]
